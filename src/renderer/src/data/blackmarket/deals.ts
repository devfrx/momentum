/**
 * Black Market — Deal definitions
 *
 * Static deal templates used to procedurally generate rotating deals.
 * Each deal has risk/reward, category gating, and consequences.
 *
 * Scaling model (v2 — percentage of wealth):
 *   • `impactTier` + `costWeight` define cost as a % of player wealth.
 *   • `roiRatio`   defines cash_grant rewards relative to scaled cost.
 *   • cash_loss consequence `value` is now a fraction (0–1) of scaled cost.
 *   • Multiplier effects (income_boost etc.) are untouched — they're ratios.
 *   • `baseCost` is kept for early-game fallback / reference only.
 */
import type { BlackMarketDealDef } from './types'

export const DEAL_DEFS: BlackMarketDealDef[] = [
  // ─── Intel Deals (Tier 0+) — minor impact ─────────────────────

  {
    id: 'leaked_earnings',
    nameKey: 'blackmarket.deal_leaked_earnings',
    descKey: 'blackmarket.deal_leaked_earnings_desc',
    category: 'intel',
    icon: 'mdi:file-eye',
    minTier: 0,
    baseCost: 200,
    impactTier: 'minor',
    costWeight: 0.2,
    baseRisk: 10,
    successEffects: [
      { type: 'stock_manipulation', value: 0.15, durationTicks: 1200, target: 'random_stock' },
    ],
    failConsequences: [
      { probability: 0.8, type: 'cash_loss', value: 0.5, durationTicks: 0 },
      { probability: 0.2, type: 'heat_spike', value: 5, durationTicks: 0 },
    ],
    xpReward: 5,
    repReward: 1,
    cooldownTicks: 3000,
    weight: 10,
  },
  {
    id: 'market_whisper',
    nameKey: 'blackmarket.deal_market_whisper',
    descKey: 'blackmarket.deal_market_whisper_desc',
    category: 'intel',
    icon: 'mdi:ear-hearing',
    minTier: 0,
    baseCost: 350,
    impactTier: 'minor',
    costWeight: 0.35,
    baseRisk: 8,
    successEffects: [
      { type: 'income_boost', value: 1.15, durationTicks: 1800 },
    ],
    failConsequences: [
      { probability: 1, type: 'cash_loss', value: 0.6, durationTicks: 0 },
    ],
    xpReward: 3,
    repReward: 1,
    cooldownTicks: 2400,
    weight: 12,
  },
  {
    id: 'crypto_alpha',
    nameKey: 'blackmarket.deal_crypto_alpha',
    descKey: 'blackmarket.deal_crypto_alpha_desc',
    category: 'intel',
    icon: 'mdi:shield-key',
    minTier: 0,
    baseCost: 500,
    impactTier: 'minor',
    costWeight: 0.5,
    baseRisk: 22,
    successEffects: [
      { type: 'crypto_manipulation', value: 0.20, durationTicks: 900, target: 'random_crypto' },
    ],
    failConsequences: [
      { probability: 0.6, type: 'cash_loss', value: 0.6, durationTicks: 0 },
      { probability: 0.4, type: 'heat_spike', value: 8, durationTicks: 0 },
    ],
    xpReward: 8,
    repReward: 1,
    cooldownTicks: 3600,
    weight: 8,
  },

  // ─── Intel (higher tier) ──────────────────────────────────────

  {
    id: 'blackmail_files',
    nameKey: 'blackmarket.deal_blackmail_files',
    descKey: 'blackmarket.deal_blackmail_files_desc',
    category: 'intel',
    icon: 'mdi:folder-lock',
    minTier: 0,
    baseCost: 1200,
    impactTier: 'standard',
    costWeight: 0.3,
    baseRisk: 40,
    successEffects: [
      { type: 'income_boost', value: 1.60, durationTicks: 3600 },
      { type: 'cost_reduction', value: 1.25, durationTicks: 3600 },
    ],
    failConsequences: [
      { probability: 0.4, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 25, durationTicks: 0 },
      { probability: 0.3, type: 'investigation', value: 3, durationTicks: 0 },
    ],
    xpReward: 15,
    repReward: 3,
    cooldownTicks: 6000,
    weight: 4,
  },

  // ─── Goods Deals (Tier 0+) — minor impact ────────────────────

  {
    id: 'fallen_truck',
    nameKey: 'blackmarket.deal_fallen_truck',
    descKey: 'blackmarket.deal_fallen_truck_desc',
    category: 'goods',
    icon: 'mdi:truck',
    minTier: 0,
    baseCost: 300,
    impactTier: 'minor',
    costWeight: 0.3,
    roiRatio: 2.5,
    baseRisk: 18,
    successEffects: [
      { type: 'cash_grant', value: 800, durationTicks: 0 },
    ],
    failConsequences: [
      { probability: 0.7, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 10, durationTicks: 0 },
    ],
    xpReward: 5,
    repReward: 1,
    cooldownTicks: 3000,
    weight: 10,
  },
  {
    id: 'surplus_electronics',
    nameKey: 'blackmarket.deal_surplus_electronics',
    descKey: 'blackmarket.deal_surplus_electronics_desc',
    category: 'goods',
    icon: 'mdi:chip',
    minTier: 0,
    baseCost: 600,
    impactTier: 'minor',
    costWeight: 0.6,
    roiRatio: 2.5,
    baseRisk: 25,
    successEffects: [
      { type: 'cash_grant', value: 1500, durationTicks: 0 },
    ],
    failConsequences: [
      { probability: 0.5, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.5, type: 'heat_spike', value: 12, durationTicks: 0 },
    ],
    xpReward: 8,
    repReward: 1,
    cooldownTicks: 4200,
    weight: 8,
  },
  {
    id: 'storage_tip',
    nameKey: 'blackmarket.deal_storage_tip',
    descKey: 'blackmarket.deal_storage_tip_desc',
    category: 'goods',
    icon: 'mdi:warehouse',
    minTier: 0,
    baseCost: 250,
    impactTier: 'minor',
    costWeight: 0.25,
    baseRisk: 5,
    successEffects: [
      { type: 'storage_insider', value: 1.5, durationTicks: 3600 },
    ],
    failConsequences: [
      { probability: 1, type: 'cash_loss', value: 1.0, durationTicks: 0 },
    ],
    xpReward: 3,
    repReward: 1,
    cooldownTicks: 6000,
    weight: 6,
  },

  {
    id: 'weapons_cache',
    nameKey: 'blackmarket.deal_weapons_cache',
    descKey: 'blackmarket.deal_weapons_cache_desc',
    category: 'goods',
    icon: 'mdi:ammunition',
    minTier: 0,
    baseCost: 2000,
    impactTier: 'standard',
    costWeight: 0.5,
    roiRatio: 4.0,
    baseRisk: 55,
    successEffects: [
      { type: 'cash_grant', value: 8000, durationTicks: 0 },
    ],
    failConsequences: [
      { probability: 0.3, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 35, durationTicks: 0 },
      { probability: 0.4, type: 'investigation', value: 4, durationTicks: 0 },
    ],
    xpReward: 20,
    repReward: 4,
    cooldownTicks: 9000,
    weight: 3,
  },

  // ─── Finance Deals (Tier 0+) — standard impact ───────────────

  {
    id: 'offshore_account',
    nameKey: 'blackmarket.deal_offshore_account',
    descKey: 'blackmarket.deal_offshore_account_desc',
    category: 'finance',
    icon: 'mdi:island',
    minTier: 0,
    baseCost: 2000,
    impactTier: 'standard',
    costWeight: 0.3,
    baseRisk: 20,
    successEffects: [
      { type: 'income_boost', value: 1.25, durationTicks: 3600 },
      { type: 'cost_reduction', value: 1.11, durationTicks: 3600 },
    ],
    failConsequences: [
      { probability: 0.5, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.4, type: 'heat_spike', value: 15, durationTicks: 0 },
      { probability: 0.1, type: 'investigation', value: 3, durationTicks: 0 },
    ],
    xpReward: 15,
    repReward: 2,
    cooldownTicks: 9000,
    weight: 6,
  },
  {
    id: 'money_laundering',
    nameKey: 'blackmarket.deal_money_laundering',
    descKey: 'blackmarket.deal_money_laundering_desc',
    category: 'finance',
    icon: 'mdi:washing-machine',
    minTier: 0,
    baseCost: 5000,
    impactTier: 'standard',
    costWeight: 0.6,
    roiRatio: 1.6,
    baseRisk: 30,
    successEffects: [
      { type: 'cash_grant', value: 8000, durationTicks: 0 },
      { type: 'deposit_launder', value: 1.30, durationTicks: 1800 },
    ],
    failConsequences: [
      { probability: 0.4, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 25, durationTicks: 0 },
      { probability: 0.3, type: 'investigation', value: 4, durationTicks: 0 },
    ],
    xpReward: 20,
    repReward: 3,
    cooldownTicks: 12000,
    weight: 4,
  },
  {
    id: 'loan_forgery',
    nameKey: 'blackmarket.deal_loan_forgery',
    descKey: 'blackmarket.deal_loan_forgery_desc',
    category: 'finance',
    icon: 'mdi:file-document-edit',
    minTier: 0,
    baseCost: 1500,
    impactTier: 'standard',
    costWeight: 0.25,
    baseRisk: 25,
    successEffects: [
      { type: 'loan_forgery', value: 0.70, durationTicks: 6000 },
    ],
    failConsequences: [
      { probability: 0.5, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 20, durationTicks: 0 },
      { probability: 0.2, type: 'investigation', value: 3, durationTicks: 0 },
    ],
    xpReward: 12,
    repReward: 2,
    cooldownTicks: 9000,
    weight: 5,
  },

  // ─── Boost Deals (Tier 1+) — standard impact ─────────────────

  {
    id: 'performance_enhancers',
    nameKey: 'blackmarket.deal_performance_enhancers',
    descKey: 'blackmarket.deal_performance_enhancers_desc',
    category: 'boost',
    icon: 'mdi:lightning-bolt',
    minTier: 1,
    baseCost: 3000,
    impactTier: 'standard',
    costWeight: 0.4,
    baseRisk: 18,
    successEffects: [
      { type: 'income_boost', value: 1.50, durationTicks: 1200 },
      { type: 'xp_boost', value: 1.50, durationTicks: 1200 },
    ],
    failConsequences: [
      { probability: 0.6, type: 'income_penalty', value: 0.80, durationTicks: 1200 },
      { probability: 0.4, type: 'heat_spike', value: 10, durationTicks: 0 },
    ],
    xpReward: 10,
    repReward: 2,
    cooldownTicks: 6000,
    weight: 7,
  },
  {
    id: 'gambling_rig',
    nameKey: 'blackmarket.deal_gambling_rig',
    descKey: 'blackmarket.deal_gambling_rig_desc',
    category: 'boost',
    icon: 'mdi:cards-playing',
    minTier: 1,
    baseCost: 2500,
    impactTier: 'standard',
    costWeight: 0.35,
    baseRisk: 22,
    successEffects: [
      { type: 'gambling_edge', value: 1.40, durationTicks: 1800 },
    ],
    failConsequences: [
      { probability: 0.5, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 15, durationTicks: 0 },
      { probability: 0.2, type: 'reputation_loss', value: 3, durationTicks: 0 },
    ],
    xpReward: 8,
    repReward: 2,
    cooldownTicks: 7200,
    weight: 5,
  },
  {
    id: 'business_accelerator',
    nameKey: 'blackmarket.deal_business_accelerator',
    descKey: 'blackmarket.deal_business_accelerator_desc',
    category: 'boost',
    icon: 'mdi:rocket-launch',
    minTier: 1,
    baseCost: 4000,
    impactTier: 'standard',
    costWeight: 0.5,
    baseRisk: 15,
    successEffects: [
      { type: 'business_boost', value: 2.0, durationTicks: 900 },
    ],
    failConsequences: [
      { probability: 0.7, type: 'cash_loss', value: 0.5, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 8, durationTicks: 0 },
    ],
    xpReward: 12,
    repReward: 2,
    cooldownTicks: 5400,
    weight: 6,
  },

  // ─── Special Deals (Tier 2+) — major impact ──────────────────

  {
    id: 'hostile_takeover',
    nameKey: 'blackmarket.deal_hostile_takeover',
    descKey: 'blackmarket.deal_hostile_takeover_desc',
    category: 'special',
    icon: 'mdi:chess-knight',
    minTier: 2,
    baseCost: 15000,
    impactTier: 'major',
    costWeight: 0.6,
    roiRatio: 1.5,
    baseRisk: 35,
    successEffects: [
      { type: 'business_boost', value: 3.0, durationTicks: 1800 },
      { type: 'cash_grant', value: 10000, durationTicks: 0 },
    ],
    failConsequences: [
      { probability: 0.4, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 30, durationTicks: 0 },
      { probability: 0.3, type: 'investigation', value: 5, durationTicks: 0 },
    ],
    xpReward: 30,
    repReward: 5,
    cooldownTicks: 18000,
    weight: 3,
  },
  {
    id: 'market_manipulation',
    nameKey: 'blackmarket.deal_market_manipulation',
    descKey: 'blackmarket.deal_market_manipulation_desc',
    category: 'special',
    icon: 'mdi:chart-gantt',
    minTier: 2,
    baseCost: 10000,
    impactTier: 'major',
    costWeight: 0.4,
    baseRisk: 40,
    successEffects: [
      { type: 'stock_manipulation', value: 0.30, durationTicks: 1200, target: 'random_stock' },
      { type: 'crypto_manipulation', value: 0.25, durationTicks: 1200, target: 'random_crypto' },
    ],
    failConsequences: [
      { probability: 0.3, type: 'market_crash', value: -0.20, durationTicks: 600 },
      { probability: 0.4, type: 'heat_spike', value: 25, durationTicks: 0 },
      { probability: 0.3, type: 'investigation', value: 5, durationTicks: 0 },
    ],
    xpReward: 25,
    repReward: 4,
    cooldownTicks: 14400,
    weight: 3,
  },
  {
    id: 'dark_web_auction',
    nameKey: 'blackmarket.deal_dark_web_auction',
    descKey: 'blackmarket.deal_dark_web_auction_desc',
    category: 'special',
    icon: 'mdi:web',
    minTier: 2,
    baseCost: 8000,
    impactTier: 'major',
    costWeight: 0.35,
    roiRatio: 3.0,
    baseRisk: 28,
    successEffects: [
      { type: 'cash_grant', value: 25000, durationTicks: 0 },
    ],
    failConsequences: [
      { probability: 0.5, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 20, durationTicks: 0 },
      { probability: 0.2, type: 'investigation', value: 4, durationTicks: 0 },
    ],
    xpReward: 20,
    repReward: 3,
    cooldownTicks: 12000,
    weight: 4,
  },

  // ─── Legendary Deals (Tier 3+) — legendary impact ─────────────

  {
    id: 'golden_heist',
    nameKey: 'blackmarket.deal_golden_heist',
    descKey: 'blackmarket.deal_golden_heist_desc',
    category: 'legendary',
    icon: 'mdi:gold',
    minTier: 3,
    baseCost: 50000,
    impactTier: 'legendary',
    costWeight: 0.3,
    roiRatio: 4.0,
    baseRisk: 45,
    successEffects: [
      { type: 'cash_grant', value: 200000, durationTicks: 0 },
      { type: 'reputation_boost', value: 10, durationTicks: 0 },
    ],
    failConsequences: [
      { probability: 0.4, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'heat_spike', value: 40, durationTicks: 0 },
      { probability: 0.3, type: 'investigation', value: 5, durationTicks: 0 },
    ],
    xpReward: 100,
    repReward: 10,
    cooldownTicks: 36000,
    weight: 1,
  },
  {
    id: 'shadow_empire',
    nameKey: 'blackmarket.deal_shadow_empire',
    descKey: 'blackmarket.deal_shadow_empire_desc',
    category: 'legendary',
    icon: 'mdi:city-variant',
    minTier: 4,
    baseCost: 100000,
    impactTier: 'legendary',
    costWeight: 0.7,
    baseRisk: 50,
    successEffects: [
      { type: 'income_boost', value: 3.0, durationTicks: 3600 },
      { type: 'business_boost', value: 2.5, durationTicks: 3600 },
      { type: 'cost_reduction', value: 1.43, durationTicks: 3600 },
    ],
    failConsequences: [
      { probability: 0.3, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'income_penalty', value: 0.50, durationTicks: 3600 },
      { probability: 0.2, type: 'heat_spike', value: 50, durationTicks: 0 },
      { probability: 0.2, type: 'investigation', value: 5, durationTicks: 0 },
    ],
    xpReward: 200,
    repReward: 15,
    cooldownTicks: 72000,
    weight: 1,
  },
  {
    id: 'phantom_protocol',
    nameKey: 'blackmarket.deal_phantom_protocol',
    descKey: 'blackmarket.deal_phantom_protocol_desc',
    category: 'legendary',
    icon: 'mdi:ghost',
    minTier: 4,
    baseCost: 75000,
    impactTier: 'legendary',
    costWeight: 0.5,
    baseRisk: 35,
    successEffects: [
      { type: 'heat_reduction', value: -80, durationTicks: 0 },
      { type: 'income_boost', value: 2.0, durationTicks: 6000 },
      { type: 'xp_boost', value: 3.0, durationTicks: 6000 },
    ],
    failConsequences: [
      { probability: 0.4, type: 'heat_spike', value: 30, durationTicks: 0 },
      { probability: 0.3, type: 'cash_loss', value: 1.0, durationTicks: 0 },
      { probability: 0.3, type: 'investigation', value: 5, durationTicks: 0 },
    ],
    xpReward: 150,
    repReward: 12,
    cooldownTicks: 54000,
    weight: 1,
  },
]

/** Get a deal definition by id */
export function getDealDef(dealId: string): BlackMarketDealDef | undefined {
  return DEAL_DEFS.find(d => d.id === dealId)
}
