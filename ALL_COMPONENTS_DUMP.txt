=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\BetControls.vue ===
<script setup lang="ts">
import InputNumber from 'primevue/inputnumber'

defineProps<{
    modelValue: number
    maxBet: number
}>()

const emit = defineEmits<{
    'update:modelValue': [value: number]
}>()

function updateBet(value: number): void {
    emit('update:modelValue', value)
}
</script>

<template>
    <div class="bet-controls glass-card-static">
        <label class="bet-label">{{ $t('gambling.bet_amount_label') }}</label>
        <InputNumber :modelValue="modelValue" @update:modelValue="(v: number) => updateBet(v)" :min="1" mode="currency"
            currency="USD" locale="en-US" class="bet-input" />
        <div class="bet-multipliers">
            <button class="btn btn-ghost btn-sm" @click="updateBet(modelValue * 2)">{{ $t('gambling.double') }}</button>
            <button class="btn btn-ghost btn-sm" @click="updateBet(modelValue * 5)">{{ $t('gambling.x5') }}</button>
            <button class="btn btn-ghost btn-sm" @click="updateBet(modelValue * 10)">{{ $t('gambling.x10') }}</button>
            <button class="btn btn-ghost btn-sm" @click="updateBet(maxBet)">{{ $t('gambling.max') }}</button>
        </div>
    </div>
</template>

<style scoped>
.bet-controls {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md) var(--spacing-lg);
    flex-wrap: wrap;
}

.bet-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--color-text-muted);
}

.bet-input {
    width: 150px;
}

.bet-multipliers {
    display: flex;
    gap: 4px;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\BlackjackCard.vue ===
<script setup lang="ts">
/**
 * BlackjackCard â€” A single playing card with flip animation.
 * Shows back face when hidden, front face when revealed.
 */
import { computed } from 'vue'

export interface CardData {
    suit: 'hearts' | 'diamonds' | 'clubs' | 'spades'
    rank: string   // 'A','2'..'10','J','Q','K'
    value: number   // primary value (Ace=11, face=10)
    hidden?: boolean
}

const props = defineProps<{
    card: CardData
    /** Delay before flip animation starts (ms as CSS) */
    delay?: string
    /** Show green lucky glow around this card */
    glow?: boolean
}>()

const SUIT_SYMBOLS: Record<string, string> = {
    hearts: 'â™¥', diamonds: 'â™¦', clubs: 'â™£', spades: 'â™ '
}

const suitSymbol = computed(() => SUIT_SYMBOLS[props.card.suit] ?? '?')
const isRed = computed(() => props.card.suit === 'hearts' || props.card.suit === 'diamonds')
</script>

<template>
    <div class="bj-card" :class="{ flipped: !card.hidden, 'lucky-glow': glow }"
        :style="{ '--deal-delay': delay || '0ms' }">
        <div class="card-inner">
            <!-- Back face -->
            <div class="card-face card-back">
                <div class="card-pattern"></div>
            </div>
            <!-- Front face -->
            <div class="card-face card-front" :class="{ red: isRed }">
                <span class="card-rank top">{{ card.rank }}</span>
                <span class="card-suit-big">{{ suitSymbol }}</span>
                <span class="card-rank bottom">{{ card.rank }}</span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.bj-card {
    width: 80px;
    height: 112px;
    perspective: 600px;
    flex-shrink: 0;
    border-radius: var(--t-radius-xl);
    animation: dealIn 0.4s ease both;
    animation-delay: var(--deal-delay);
}

@keyframes dealIn {
    from {
        opacity: 0;
        transform: translateY(-30px) scale(0.8);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.5s ease;
    transition-delay: var(--deal-delay);
}

.bj-card.flipped .card-inner {
    transform: rotateY(180deg);
}

.card-face {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: var(--t-radius-xl);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

/* Back */
.card-back {
    --_card-back-start: var(--t-blue);
    --_card-back-end: color-mix(in srgb, var(--t-blue) 60%, black);
    background: linear-gradient(135deg, var(--_card-back-start), var(--_card-back-end));
    border: 2px solid var(--t-blue);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.card-pattern {
    --_pattern-line: color-mix(in srgb, var(--t-text) 15%, transparent);
    --_pattern-stripe: color-mix(in srgb, var(--t-text) 4%, transparent);
    width: 60%;
    height: 70%;
    border: 2px solid var(--_pattern-line);
    border-radius: var(--t-radius-sm);
    background: repeating-linear-gradient(45deg,
            transparent,
            transparent 4px,
            var(--_pattern-stripe) 4px,
            var(--_pattern-stripe) 8px);
}

/* Front */
.card-front {
    --_card-face-light: #fafafa;
    --_card-face-dark: #e8e8e8;
    background: linear-gradient(145deg, var(--_card-face-light), var(--_card-face-dark));
    border: 2px solid var(--t-border);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transform: rotateY(180deg);
    color: var(--t-text-inverse);
    padding: 6px;
}

.card-front.red {
    color: var(--t-danger);
}

.card-rank {
    font-size: 0.85rem;
    font-weight: 800;
    line-height: 1;
}

.card-rank.top {
    align-self: flex-start;
}

.card-rank.bottom {
    align-self: flex-end;
    transform: rotate(180deg);
}

.card-suit-big {
    font-size: 2rem;
    line-height: 1;
    flex: 1;
    display: flex;
    align-items: center;
}

/* â”€â”€ Lucky glow â”€â”€ */
/* NOTE: must NOT use filter on .bj-card or .card-inner â€” it flattens
   the 3D context and breaks backface-visibility, leaving the card face-down. */
.lucky-glow {
    animation: cardLuckyGlow 1.5s ease infinite alternate;
}

@keyframes cardLuckyGlow {
    from {
        box-shadow: 0 0 8px 2px color-mix(in srgb, var(--t-success) 35%, transparent);
    }

    to {
        box-shadow: 0 0 18px 6px color-mix(in srgb, var(--t-success) 70%, transparent);
    }
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\BlackjackGame.vue ===
<script setup lang="ts">
/**
 * BlackjackGame â€” Full blackjack sub-game orchestrator.
 *
 * Rules:
 *  - Standard 6-deck shoe (312 cards), reshuffled when < 60 remain
 *  - Dealer stands on soft 17
 *  - Blackjack pays 3:2 (2.5Ã— bet)
 *  - Double down: one extra card, bet doubled
 *  - No split (simplified for incremental tycoon)
 *  - Insurance not offered
 */
import { ref, computed, reactive } from 'vue'
import { useI18n } from 'vue-i18n'
import AppIcon from '@renderer/components/AppIcon.vue'
import BlackjackHand from './BlackjackHand.vue'
import BlackjackCard from './BlackjackCard.vue'
import type { CardData } from './BlackjackCard.vue'
import InfoPanel from '@renderer/components/layout/InfoPanel.vue'
import type { InfoSection } from '@renderer/components/layout/InfoPanel.vue'
import { useFormat } from '@renderer/composables/useFormat'
import { usePlayerStore } from '@renderer/stores/usePlayerStore'
import { useGamblingStore } from '@renderer/stores/useGamblingStore'
import { D, ZERO, mul, add } from '@renderer/core/BigNum'
import type Decimal from 'break_infinity.js'

const emit = defineEmits<{ back: [] }>()

const { t } = useI18n()
const player = usePlayerStore()
const gambling = useGamblingStore()
const { formatCash } = useFormat()

// â”€â”€â”€ Types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
type Phase = 'betting' | 'playing' | 'dealer-turn' | 'result'
type Outcome = 'win' | 'lose' | 'push' | 'blackjack' | 'bust'

const SUITS = ['hearts', 'diamonds', 'clubs', 'spades'] as const
const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'] as const
const RANK_VALUES: Record<string, number> = {
    A: 11, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7,
    '8': 8, '9': 9, '10': 10, J: 10, Q: 10, K: 10,
}

// â”€â”€â”€ Deck (6-deck shoe) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let shoe: CardData[] = []

function buildShoe(): void {
    shoe = []
    for (let d = 0; d < 6; d++) {
        for (const suit of SUITS) {
            for (const rank of RANKS) {
                shoe.push({ suit, rank, value: RANK_VALUES[rank] })
            }
        }
    }
    shuffleArray(shoe)
}

function shuffleArray<T>(arr: T[]): void {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1))
            ;[arr[i], arr[j]] = [arr[j], arr[i]]
    }
}

function drawCard(hidden = false): CardData {
    if (shoe.length < 60) buildShoe()
    const card = shoe.pop()!
    return { ...card, hidden }
}

/**
 * Draw a card with luck - if the card would bust the player, luck gives a chance to redraw.
 * Luck can only trigger once per hand.
 */
function drawCardWithLuck(): CardData {
    const card = drawCard()
    // Check if this card would ACTUALLY bust (accounting for soft aces)
    const wouldBustScore = calcScore([...playerCards, card])
    if (wouldBustScore > 21 && !luckyUsedThisHand.value) {
        const luckBonus = gambling.getLuckBonus()
        if (luckBonus > 0 && Math.random() < luckBonus) {
            // Store the bust card as discarded
            discardedCard.value = { ...card }
            // Redraw - put bad card back and try again
            shoe.push(card)
            shuffleArray(shoe)
            // Mark luck as used this hand
            luckyUsedThisHand.value = true
            // Track which card index will get the glow
            luckyCardIndex.value = playerCards.length
            // Show lucky flash
            luckyTriggered.value = true
            setTimeout(() => { luckyTriggered.value = false }, 1600)
            return drawCard()
        }
    }
    return card
}

// Init shoe
buildShoe()

// â”€â”€â”€ Game state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const phase = ref<Phase>('betting')
const outcome = ref<Outcome | null>(null)
const betAmount = ref(10)
const currentBet = ref(ZERO)
const doubled = ref(false)

const playerCards = reactive<CardData[]>([])
const dealerCards = reactive<CardData[]>([])
/** When luck saves from bust, briefly show clover flash */
const luckyTriggered = ref(false)
/** The card that would have caused bust (shown as discarded) */
const discardedCard = ref<CardData | null>(null)
/** Index of the player card that was drawn by luck (for glow) */
const luckyCardIndex = ref<number | null>(null)
/** Guard: luck can trigger only once per hand */
const luckyUsedThisHand = ref(false)
// â”€â”€â”€ Score calculation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcScore(cards: CardData[]): number {
    let score = 0
    let aces = 0
    for (const c of cards) {
        if (c.hidden) continue
        score += c.value
        if (c.rank === 'A') aces++
    }
    while (score > 21 && aces > 0) {
        score -= 10
        aces--
    }
    return score
}

const playerScore = computed(() => calcScore(playerCards))
const dealerScore = computed(() => calcScore(dealerCards))
const playerBust = computed(() => playerScore.value > 21)
const dealerBust = computed(() => dealerScore.value > 21)
const isPlayerBlackjack = computed(() => playerCards.length === 2 && playerScore.value === 21)
const isDealerBlackjack = computed(() => {
    const allRevealed = dealerCards.every(c => !c.hidden)
    return allRevealed && dealerCards.length === 2 && calcScore(dealerCards) === 21
})

const canHit = computed(() => phase.value === 'playing' && !playerBust.value)
const canStand = computed(() => phase.value === 'playing')
const canDouble = computed(() =>
    phase.value === 'playing' &&
    playerCards.length === 2 &&
    !doubled.value &&
    player.cash.gte(currentBet.value)
)

// â”€â”€â”€ Deal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function deal(): void {
    const bet = D(betAmount.value)
    if (bet.lte(ZERO) || player.cash.lt(bet)) return
    if (!player.spendCash(bet)) return

    currentBet.value = bet
    doubled.value = false
    outcome.value = null
    playerCards.length = 0
    dealerCards.length = 0
    discardedCard.value = null
    luckyCardIndex.value = null
    luckyUsedThisHand.value = false
    luckyTriggered.value = false

    // Deal initial cards
    playerCards.push(drawCard())
    dealerCards.push(drawCard())
    playerCards.push(drawCard())
    dealerCards.push(drawCard(true)) // hidden

    phase.value = 'playing'

    // Check for immediate blackjack
    if (isPlayerBlackjack.value) {
        revealDealer()
        if (isDealerBlackjack.value) {
            // Both have blackjack â€” push (tie)
            settleRound('push')
        } else {
            settleRound('blackjack')
        }
    }
}

// â”€â”€â”€ Player actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hit(): void {
    if (!canHit.value) return
    playerCards.push(drawCardWithLuck())
    if (playerBust.value) {
        revealDealer()
        settleRound('bust')
    }
}

function stand(): void {
    if (!canStand.value) return
    revealDealer()
    dealerPlay()
}

function doubleDown(): void {
    if (!canDouble.value) return
    if (!player.spendCash(currentBet.value)) return
    currentBet.value = add(currentBet.value, currentBet.value)
    doubled.value = true
    playerCards.push(drawCardWithLuck())
    if (playerBust.value) {
        revealDealer()
        settleRound('bust')
    } else {
        revealDealer()
        dealerPlay()
    }
}

// â”€â”€â”€ Dealer logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function revealDealer(): void {
    for (const c of dealerCards) c.hidden = false
}

function dealerPlay(): void {
    phase.value = 'dealer-turn'
    dealerDrawLoop()
}

function dealerDrawLoop(): void {
    const score = calcScore(dealerCards)
    if (score < 17) {
        setTimeout(() => {
            dealerCards.push(drawCard())
            dealerDrawLoop()
        }, 600)
    } else {
        setTimeout(() => resolveHands(), 400)
    }
}

function resolveHands(): void {
    const ps = calcScore(playerCards)
    const ds = calcScore(dealerCards)

    if (ds > 21) {
        settleRound('win')
    } else if (ps > ds) {
        settleRound('win')
    } else if (ps < ds) {
        settleRound('lose')
    } else {
        settleRound('push')
    }
}

// â”€â”€â”€ Settlement â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const lastPayout = ref<Decimal | null>(null)

function settleRound(result: Outcome): void {
    outcome.value = result
    phase.value = 'result'

    switch (result) {
        case 'blackjack': {
            // 3:2 payout â€” bet back + 1.5Ã— bet
            const pay = mul(currentBet.value, 2.5)
            player.earnCash(pay)
            gambling.recordWin('blackjack', currentBet.value, pay)
            lastPayout.value = pay
            break
        }
        case 'win': {
            const pay = mul(currentBet.value, 2)
            player.earnCash(pay)
            gambling.recordWin('blackjack', currentBet.value, pay)
            lastPayout.value = pay
            break
        }
        case 'push': {
            // Return bet
            player.earnCash(currentBet.value)
            // Push is neither win nor loss â€” record as win with 0 net
            gambling.recordWin('blackjack', currentBet.value, currentBet.value)
            lastPayout.value = null
            break
        }
        case 'bust':
        case 'lose': {
            gambling.recordLoss('blackjack', currentBet.value)
            lastPayout.value = null
            break
        }
    }
}

function newRound(): void {
    phase.value = 'betting'
    outcome.value = null
    lastPayout.value = null
    playerCards.length = 0
    dealerCards.length = 0
    discardedCard.value = null
    luckyCardIndex.value = null
    luckyUsedThisHand.value = false
    luckyTriggered.value = false
}

// â”€â”€â”€ Bet helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setBet(amount: number): void {
    betAmount.value = Math.max(1, Math.min(amount, player.cash.toNumber()))
}
function halfBet(): void { setBet(Math.max(1, Math.floor(betAmount.value / 2))) }
function doubleBet(): void { setBet(betAmount.value * 2) }
function maxBet(): void { setBet(player.cash.toNumber()) }

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const stats = computed(() => gambling.getStats('blackjack'))
const isBetting = computed(() => phase.value === 'betting')
const canDeal = computed(() => isBetting.value && betAmount.value > 0 && player.cash.gte(D(betAmount.value)))

const outcomeLabel = computed(() => {
    switch (outcome.value) {
        case 'blackjack': return t('gambling.bj_blackjack')
        case 'win': return t('gambling.bj_you_win')
        case 'push': return t('gambling.bj_push')
        case 'bust': return t('gambling.bj_bust')
        case 'lose': return t('gambling.bj_dealer_wins')
        default: return ''
    }
})

const outcomeClass = computed(() => {
    switch (outcome.value) {
        case 'blackjack':
        case 'win': return 'outcome-win'
        case 'push': return 'outcome-push'
        default: return 'outcome-lose'
    }
})

// â”€â”€â”€ Info Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const bjInfo = computed<InfoSection[]>(() => [
    {
        title: t('gambling.info.blackjack.how_title'),
        icon: 'mdi:help-circle-outline',
        entries: [
            { term: t('gambling.info.blackjack.objective'), desc: t('gambling.info.blackjack.objective_desc'), icon: 'mdi:bullseye-arrow' },
            { term: t('gambling.info.blackjack.card_values'), desc: t('gambling.info.blackjack.card_values_desc'), icon: 'mdi:cards-playing' },
            { term: t('gambling.info.blackjack.dealer_rules'), desc: t('gambling.info.blackjack.dealer_rules_desc'), icon: 'mdi:robot' },
        ]
    },
    {
        title: t('gambling.info.blackjack.actions_title'),
        icon: 'mdi:gesture-tap',
        entries: [
            { term: t('gambling.info.blackjack.hit'), desc: t('gambling.info.blackjack.hit_desc'), icon: 'mdi:plus-circle' },
            { term: t('gambling.info.blackjack.stand'), desc: t('gambling.info.blackjack.stand_desc'), icon: 'mdi:hand-back-right' },
            { term: t('gambling.info.blackjack.double_down'), desc: t('gambling.info.blackjack.double_down_desc'), icon: 'mdi:arrow-up-bold-circle' },
        ]
    },
    {
        title: t('gambling.info.blackjack.payout_title'),
        icon: 'mdi:cash-multiple',
        entries: [
            { term: t('gambling.info.blackjack.win'), desc: t('gambling.info.blackjack.win_desc'), icon: 'mdi:check-circle' },
            { term: t('gambling.info.blackjack.blackjack'), desc: t('gambling.info.blackjack.blackjack_desc'), icon: 'mdi:star' },
            { term: t('gambling.info.blackjack.push'), desc: t('gambling.info.blackjack.push_desc'), icon: 'mdi:equal' },
            { term: t('gambling.info.blackjack.bust'), desc: t('gambling.info.blackjack.bust_desc'), icon: 'mdi:close-circle' },
        ]
    },
])
</script>

<template>
    <div class="bj-game">
        <!-- Header -->
        <div class="bj-header">
            <button class="back-btn" @click="$emit('back')">
                <AppIcon icon="mdi:arrow-left" /> {{ $t('gambling.back') }}
            </button>
            <h2 class="bj-title">
                <AppIcon icon="mdi:cards-playing-spade" class="title-icon" />
                {{ $t('gambling.bj_title') }}
            </h2>
            <div class="balance-chip">
                <AppIcon icon="mdi:cash" />
                {{ formatCash(player.cash) }}
            </div>
        </div>

        <!-- Table -->
        <div class="bj-table">
            <!-- Dealer hand -->
            <BlackjackHand :label="$t('gambling.bj_dealer')" :cards="dealerCards" :score="dealerScore"
                :bust="dealerBust && phase === 'result'" :blackjack="isDealerBlackjack && phase === 'result'" />

            <!-- Outcome badge -->
            <Transition name="pop">
                <div v-if="phase === 'result'" class="outcome-badge" :class="outcomeClass">
                    {{ outcomeLabel }}
                    <span v-if="lastPayout" class="outcome-amount">{{ formatCash(lastPayout) }}</span>
                </div>
            </Transition>

            <!-- Divider -->
            <div class="table-divider">
                <div class="divider-line"></div>
                <span v-if="phase !== 'betting'" class="bet-tag">
                    <AppIcon icon="mdi:poker-chip" /> {{ formatCash(currentBet) }}
                </span>
                <div class="divider-line"></div>
            </div>

            <!-- Player hand -->
            <BlackjackHand :label="$t('gambling.bj_you')" :cards="playerCards" :score="playerScore" :bust="playerBust"
                :blackjack="isPlayerBlackjack" :glow-index="luckyCardIndex" />

            <!-- Discarded bust card + Lucky anti-bust indicator -->
            <Transition name="lucky">
                <div v-if="luckyTriggered" class="lucky-row">
                    <div class="lucky-banner">
                        <AppIcon icon="mdi:clover" class="lucky-icon" />
                        <span class="lucky-text">{{ $t('gambling.lucky_trigger') }}</span>
                    </div>
                </div>
            </Transition>

            <!-- Discarded card (the one that would have busted) -->
            <Transition name="pop">
                <div v-if="discardedCard && phase !== 'betting'" class="discarded-area">
                    <span class="discarded-label">{{ $t('gambling.bj_discarded') }}</span>
                    <div class="discarded-card-wrapper">
                        <BlackjackCard :card="discardedCard" />
                        <AppIcon icon="mdi:close-circle" class="discard-x" />
                    </div>
                </div>
            </Transition>
        </div>

        <!-- Action buttons (during play) -->
        <div v-if="phase === 'playing'" class="action-buttons">
            <button class="action-btn hit-btn" :disabled="!canHit" @click="hit">
                <AppIcon icon="mdi:plus-circle" /> {{ $t('gambling.bj_hit') }}
            </button>
            <button class="action-btn stand-btn" :disabled="!canStand" @click="stand">
                <AppIcon icon="mdi:hand-back-right" /> {{ $t('gambling.bj_stand') }}
            </button>
            <button class="action-btn double-btn" :disabled="!canDouble" @click="doubleDown">
                <AppIcon icon="mdi:arrow-up-bold-circle" /> {{ $t('gambling.bj_double') }}
            </button>
        </div>

        <!-- Dealer turn indicator -->
        <div v-if="phase === 'dealer-turn'" class="dealer-thinking">
            <AppIcon icon="mdi:loading" class="spin-icon" />
            {{ $t('gambling.bj_dealer_playing') }}
        </div>

        <!-- New round button -->
        <div v-if="phase === 'result'" class="result-actions">
            <button class="deal-btn" @click="newRound">
                <AppIcon icon="mdi:refresh" /> {{ $t('gambling.new_round') }}
            </button>
        </div>

        <!-- Betting controls (before deal) -->
        <div v-if="isBetting" class="controls-row">
            <div class="bet-section">
                <label class="bet-label">{{ $t('gambling.bet_amount') }}</label>
                <div class="bet-row">
                    <button class="bet-adj" @click="halfBet">1/2</button>
                    <div class="bet-display">
                        <input type="number" v-model.number="betAmount" :min="1" :max="player.cash.toNumber()"
                            class="bet-input" />
                    </div>
                    <button class="bet-adj" @click="doubleBet">x2</button>
                </div>
                <div class="bet-presets">
                    <button v-for="pct in [10, 25, 50]" :key="pct" class="preset-btn"
                        @click="setBet(Math.floor(player.cash.toNumber() * pct / 100))">
                        {{ pct }}%
                    </button>
                    <button class="preset-btn preset-max" @click="maxBet">{{ $t('gambling.max') }}</button>
                </div>
            </div>

            <div class="action-col">
                <button class="deal-btn" :disabled="!canDeal" @click="deal">
                    <AppIcon icon="mdi:cards-playing" /> {{ $t('gambling.bj_deal') }}
                </button>
            </div>
        </div>

        <!-- Info Panel -->
        <InfoPanel :title="$t('gambling.bj_rules')" :sections="bjInfo" />

        <!-- Stats -->
        <div class="bj-stats">
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_hands') }}</span>
                <span class="stat-value">{{ stats.played }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_wins') }}</span>
                <span class="stat-value">{{ stats.won }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_win_rate') }}</span>
                <span class="stat-value">
                    {{ stats.played > 0 ? Math.round(stats.won / stats.played * 100) : 0 }}%
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_net') }}</span>
                <span class="stat-value" :class="stats.netProfit.gte(0) ? 'success' : 'danger'">
                    {{ formatCash(stats.netProfit) }}
                </span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.bj-game {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
    width: 100%;
    height: 100%;
    min-height: 0;
}

/* â”€â”€ Header â”€â”€ */
.bj-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--t-space-3);
}

.back-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--t-transition-fast);
}

.back-btn:hover {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.bj-title {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: 1.3rem;
    font-weight: 700;
}

.title-icon {
    font-size: 1.5rem;
    color: var(--t-accent);
}

.balance-chip {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-success);
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 0.85rem;
}

/* â”€â”€ Table â”€â”€ */
.bj-table {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-4);
    padding: var(--t-space-5) var(--t-space-4);
    background: radial-gradient(ellipse at center, var(--t-gamble-felt-light) 0%, var(--t-gamble-felt) 70%, var(--t-gamble-felt) 100%);
    border: 3px solid var(--t-gamble-felt-border);
    border-radius: var(--t-radius-xl, 16px);
    box-shadow: inset 0 0 40px var(--t-overlay-light), 0 4px 20px var(--t-overlay-light);
    min-height: 320px;
    position: relative;
}

/* â”€â”€ Outcome badge â”€â”€ */
.outcome-badge {
    font-size: 1.4rem;
    font-weight: 900;
    letter-spacing: 0.1em;
    padding: var(--t-space-2) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    animation: badgePop 0.35s ease;
}

.outcome-win {
    background: var(--t-success-muted);
    border: 2px solid var(--t-gamble-win);
    color: var(--t-gamble-win);
}

.outcome-lose {
    background: var(--t-danger-muted);
    border: 2px solid var(--t-gamble-lose);
    color: var(--t-gamble-lose);
}

.outcome-push {
    background: var(--t-gold-muted);
    border: 2px solid var(--t-gamble-push);
    color: var(--t-gamble-push);
}

.outcome-amount {
    font-size: 1.1rem;
    font-family: var(--font-mono, monospace);
}

@keyframes badgePop {
    0% {
        transform: scale(0.8);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* â”€â”€ Table divider â”€â”€ */
.table-divider {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    width: 100%;
    max-width: 400px;
}

.divider-line {
    flex: 1;
    height: 1px;
    background: var(--t-overlay-light);
}

.bet-tag {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--t-gold);
    background: var(--t-overlay-light);
    padding: 4px 12px;
    border-radius: var(--t-radius-xl);
    font-family: var(--font-mono, monospace);
}

/* â”€â”€ Action buttons â”€â”€ */
.action-buttons {
    display: flex;
    gap: var(--t-space-3);
    justify-content: center;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-5);
    border: none;
    border-radius: var(--t-radius-md);
    font-size: 1rem;
    font-weight: 800;
    cursor: pointer;
    transition: all var(--t-transition-fast);
    color: var(--t-text);
}

.action-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.action-btn:hover:not(:disabled) {
    filter: brightness(1.15);
    transform: translateY(-1px);
}

.hit-btn {
    background: var(--t-success);
}

.stand-btn {
    background: var(--t-orange);
}

.double-btn {
    background: var(--t-blue);
}

.dealer-thinking {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    color: var(--t-text-muted);
    font-weight: 600;
}

.spin-icon {
    animation: spinAnim 1s linear infinite;
}

@keyframes spinAnim {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

.result-actions {
    display: flex;
    justify-content: center;
}

/* â”€â”€ Controls (betting phase) â”€â”€ */
.controls-row {
    display: flex;
    gap: var(--t-space-3);
    align-items: center;
}

.bet-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-3);
    box-shadow: var(--t-shadow-sm);
}

.bet-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    color: var(--t-text-muted);
}

.bet-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.bet-adj {
    width: 36px;
    height: 36px;
    border-radius: var(--t-radius-md);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    color: var(--t-text);
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    transition: all var(--t-transition-fast);
}

.bet-adj:hover {
    background: var(--t-bg-hover);
}

.bet-display {
    flex: 1;
}

.bet-input {
    width: 100%;
    text-align: center;
    font-size: 1rem;
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text);
    outline: none;
}

.bet-presets {
    display: flex;
    gap: 4px;
}

.preset-btn {
    flex: 1;
    padding: var(--t-space-1) var(--t-space-2);
    font-size: 0.7rem;
    font-weight: 600;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.preset-btn:hover {
    background: var(--t-bg-hover);
}

.preset-max {
    color: var(--t-accent);
    font-weight: 700;
}

.action-col {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    min-width: 130px;
}

.deal-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-accent);
    color: var(--t-text);
    border: none;
    border-radius: var(--t-radius-md);
    font-size: 1rem;
    font-weight: 800;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.deal-btn:hover:not(:disabled) {
    filter: brightness(1.1);
}

.deal-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* â”€â”€ Stats â”€â”€ */
.bj-stats {
    display: flex;
    gap: var(--t-space-4);
    justify-content: space-evenly;
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    box-shadow: var(--t-shadow-sm);
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.stat-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--t-text-muted);
}

.stat-value {
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 1rem;
}

.success {
    color: var(--t-success);
}

.danger {
    color: var(--t-danger);
}

/* â”€â”€ Transitions â”€â”€ */
.pop-enter-active {
    transition: all 0.35s ease;
}

.pop-leave-active {
    transition: all 0.2s ease;
}

.pop-enter-from {
    transform: scale(0.8);
    opacity: 0;
}

.pop-leave-to {
    opacity: 0;
}

/* â”€â”€ Lucky banner â”€â”€ */
.lucky-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-3);
}

.lucky-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-3);
    padding: var(--t-space-2) var(--t-space-4);
    border-radius: var(--t-radius-lg);
    background: linear-gradient(135deg, var(--t-success-muted), transparent);
    border: 1px solid var(--t-success);
    box-shadow: 0 0 24px var(--t-success-muted);
    animation: luckyPulse 0.8s ease infinite alternate;
}

.lucky-icon {
    font-size: 1.5rem;
    color: var(--t-success);
    animation: luckyCloverSpin 1s ease;
    filter: drop-shadow(0 0 6px var(--t-success-muted));
}

.lucky-text {
    font-size: 1rem;
    font-weight: 800;
    color: var(--t-success);
    letter-spacing: 0.05em;
    text-shadow: 0 0 8px var(--t-success-muted);
}

@keyframes luckyPulse {
    from {
        box-shadow: 0 0 16px var(--t-success-muted);
    }

    to {
        box-shadow: 0 0 32px var(--t-success-muted);
    }
}

@keyframes luckyCloverSpin {
    0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
    }

    50% {
        transform: scale(1.3) rotate(10deg);
        opacity: 1;
    }

    100% {
        transform: scale(1) rotate(0deg);
    }
}

.lucky-enter-active {
    animation: luckyIn 0.5s ease;
}

.lucky-leave-active {
    animation: luckyOut 0.3s ease;
}

@keyframes luckyIn {
    0% {
        transform: scale(0.5) translateY(-10px);
        opacity: 0;
    }

    60% {
        transform: scale(1.1) translateY(0);
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes luckyOut {
    to {
        transform: scale(0.8) translateY(10px);
        opacity: 0;
    }
}

/* â”€â”€ Discarded card â”€â”€ */
.discarded-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    position: absolute;
    right: var(--t-space-3);
    bottom: var(--t-space-3);
    opacity: 0.7;
}

.discarded-label {
    font-size: 0.6rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--t-danger);
}

.discarded-card-wrapper {
    position: relative;
    transform: scale(0.7) rotate(-8deg);
    filter: grayscale(0.4) brightness(0.8);
}

.discard-x {
    position: absolute;
    top: -6px;
    right: -6px;
    font-size: 1.2rem;
    color: var(--t-danger);
    filter: drop-shadow(0 0 2px var(--t-overlay));
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\BlackjackHand.vue ===
<script setup lang="ts">
/**
 * BlackjackHand â€” Displays a row of cards with overlapping fan layout and a score badge.
 */
import BlackjackCard from './BlackjackCard.vue'
import type { CardData } from './BlackjackCard.vue'

defineProps<{
    label: string
    cards: CardData[]
    score: number
    /** Show "BUST" badge */
    bust?: boolean
    /** Show "BLACKJACK" badge */
    blackjack?: boolean
    /** Index of the card that was drawn by luck (shows green glow) */
    glowIndex?: number | null
}>()
</script>

<template>
    <div class="bj-hand">
        <div class="hand-label-row">
            <span class="hand-label">{{ label }}</span>
            <span class="hand-score" :class="{ bust, blackjack }">
                {{ bust ? $t('gambling.bj_bust') : blackjack ? $t('gambling.bj_bj_short') : score || 'â€”' }}
            </span>
        </div>
        <div class="cards-row">
            <BlackjackCard v-for="(card, i) in cards" :key="`${card.suit}-${card.rank}-${i}`" :card="card"
                :delay="`${i * 120}ms`" :glow="glowIndex === i" class="hand-card" :style="{ '--card-index': i }" />
            <div v-if="cards.length === 0" class="empty-slot">
                <span>?</span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.bj-hand {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-2);
}

.hand-label-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.hand-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--t-text-muted);
}

.hand-score {
    font-family: var(--font-mono, monospace);
    font-weight: 800;
    font-size: 1rem;
    padding: 2px 10px;
    border-radius: var(--t-radius-sm);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    color: var(--t-text);
}

.hand-score.bust {
    background: color-mix(in srgb, var(--t-danger) 15%, transparent);
    border-color: var(--t-danger);
    color: var(--t-danger);
}

.hand-score.blackjack {
    background: color-mix(in srgb, var(--t-success) 15%, transparent);
    border-color: var(--t-success);
    color: var(--t-success);
}

.cards-row {
    display: flex;
    align-items: center;
    min-height: 120px;
}

.hand-card {
    margin-left: calc(var(--card-index, 0) * -1px * 20);
}

.hand-card:first-child {
    margin-left: 0;
}

.empty-slot {
    width: 80px;
    height: 112px;
    border: 2px dashed var(--t-border);
    border-radius: var(--t-radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--t-text-muted);
    font-size: 1.5rem;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\CoinFlip.vue ===
<script setup lang="ts">
import { ref, computed } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import InfoPanel from '@renderer/components/layout/InfoPanel.vue'
import type { InfoSection } from '@renderer/components/layout/InfoPanel.vue'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'
import { usePlayerStore } from '@renderer/stores/usePlayerStore'
import { useGamblingStore } from '@renderer/stores/useGamblingStore'
import { D, ZERO, mul } from '@renderer/core/BigNum'

const emit = defineEmits<{ back: [] }>()
const { t } = useI18n()

const player = usePlayerStore()
const gambling = useGamblingStore()
const { formatCash } = useFormat()

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
type Side = 'heads' | 'tails'

const betAmount = ref(10)
const chosenSide = ref<Side>('heads')
const flipping = ref(false)
const result = ref<Side | null>(null)
const showResult = ref(false)
const won = ref(false)
const payout = ref(ZERO)
/** Number of full rotations for animation (randomised each flip) */
const flipRotations = ref(0)
/** Luck triggered â€” shows clover animation between first loss and re-flip */
const luckyTriggered = ref(false)

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const betDecimal = computed(() => D(betAmount.value))
const canFlip = computed(() =>
    !flipping.value &&
    betAmount.value > 0 &&
    player.cash.gte(betDecimal.value)
)
const stats = computed(() => gambling.getStats('coinflip'))

// â”€â”€â”€ Flip logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function flip(): void {
    if (!canFlip.value) return
    if (!player.spendCash(betDecimal.value)) return

    flipping.value = true
    showResult.value = false
    result.value = null
    won.value = false
    payout.value = ZERO
    luckyTriggered.value = false

    // First roll: fair 50/50
    const firstRoll = Math.random() < 0.5
    const firstWins = firstRoll

    if (firstWins) {
        // Won on first roll â€” normal animation
        playFlip(chosenSide.value, true)
    } else {
        // Lost first roll â€” check second chance
        const luckBonus = gambling.getLuckBonus()
        const luckyReroll = luckBonus > 0 && Math.random() < luckBonus
        if (luckyReroll) {
            // Show losing flip, then "Lucky!" banner, then re-flip
            const losingSide: Side = chosenSide.value === 'heads' ? 'tails' : 'heads'
            playFlip(losingSide, false, () => {
                // After losing flip lands â€” show lucky banner
                luckyTriggered.value = true
                setTimeout(() => {
                    // Re-flip with fresh 50/50
                    luckyTriggered.value = false
                    const secondWins = Math.random() < 0.5
                    const secondOutcome: Side = secondWins ? chosenSide.value : (chosenSide.value === 'heads' ? 'tails' : 'heads')
                    playFlip(secondOutcome, true)
                }, 1400) // show lucky banner for 1.4s
            })
        } else {
            // Normal loss
            const losingSide: Side = chosenSide.value === 'heads' ? 'tails' : 'heads'
            playFlip(losingSide, true)
        }
    }
}

/** Animate a flip to a specific outcome. If `isFinal`, evaluate win/loss at the end. */
function playFlip(outcome: Side, isFinal: boolean, onLand?: () => void): void {
    // Remove animation class so a fresh animation can restart
    flipping.value = false
    flipRotations.value = 0

    // Double requestAnimationFrame ensures the browser renders the reset state
    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
            const baseSpins = 6 + Math.floor(Math.random() * 4)
            const outcomeIsHeads = outcome === 'heads'
            const totalHalves = outcomeIsHeads
                ? (baseSpins % 2 === 0 ? baseSpins : baseSpins + 1)
                : (baseSpins % 2 === 1 ? baseSpins : baseSpins + 1)
            flipRotations.value = totalHalves * 180
            flipping.value = true

            setTimeout(() => {
                result.value = outcome

                if (isFinal) {
                    const isWin = outcome === chosenSide.value
                    if (isWin) {
                        const winPayout = mul(betDecimal.value, 2)
                        player.earnCash(winPayout)
                        gambling.recordWin('coinflip', betDecimal.value, winPayout)
                        payout.value = winPayout
                        won.value = true
                    } else {
                        gambling.recordLoss('coinflip', betDecimal.value)
                        won.value = false
                    }
                    showResult.value = true
                    flipping.value = false
                } else {
                    // Intermediate flip â€” call callback
                    onLand?.()
                }
            }, 2200)
        })
    })
}

function newRound(): void {
    showResult.value = false
    result.value = null
    flipRotations.value = 0
}

// â”€â”€â”€ Bet helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setBet(amount: number): void {
    betAmount.value = Math.max(1, Math.min(amount, player.cash.toNumber()))
}
function halfBet(): void { setBet(Math.max(1, Math.floor(betAmount.value / 2))) }
function doubleBet(): void { setBet(betAmount.value * 2) }
function maxBet(): void { setBet(player.cash.toNumber()) }

// â”€â”€â”€ Info Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const coinFlipInfo = computed<InfoSection[]>(() => [
    {
        title: t('gambling.info.coinflip.how_title'),
        icon: 'mdi:help-circle-outline',
        entries: [
            { term: t('gambling.info.coinflip.choose_side'), desc: t('gambling.info.coinflip.choose_side_desc'), icon: 'mdi:gesture-tap' },
            { term: t('gambling.info.coinflip.place_bet'), desc: t('gambling.info.coinflip.place_bet_desc'), icon: 'mdi:cash' },
            { term: t('gambling.info.coinflip.fair_coin'), desc: t('gambling.info.coinflip.fair_coin_desc'), icon: 'mdi:scale-balance' },
        ]
    },
    {
        title: t('gambling.info.coinflip.payout_title'),
        icon: 'mdi:cash-multiple',
        entries: [
            { term: t('gambling.info.coinflip.correct'), desc: t('gambling.info.coinflip.correct_desc'), icon: 'mdi:check-circle' },
            { term: t('gambling.info.coinflip.wrong'), desc: t('gambling.info.coinflip.wrong_desc'), icon: 'mdi:close-circle' },
        ]
    },
])
</script>

<template>
    <div class="coinflip-game">
        <!-- Header -->
        <div class="cf-header">
            <button class="back-btn" @click="$emit('back')">
                <AppIcon icon="mdi:arrow-left" /> {{ $t('gambling.back') }}
            </button>
            <h2 class="cf-title">
                <AppIcon icon="mdi:circle-half-full" class="title-icon" />
                {{ $t('gambling.cf_title') }}
            </h2>
            <div class="balance-chip">
                <AppIcon icon="mdi:cash" />
                {{ formatCash(player.cash) }}
            </div>
        </div>

        <!-- Coin area -->
        <div class="coin-area">
            <div class="coin-stage">
                <div class="coin" :class="{ flipping }" :style="{ '--flip-deg': flipRotations + 'deg' }">
                    <div class="coin-face coin-heads">
                        <AppIcon icon="mdi:crown" class="coin-icon" />
                        <span class="coin-label">{{ $t('gambling.cf_h') }}</span>
                    </div>
                    <div class="coin-face coin-tails">
                        <AppIcon icon="mdi:shield" class="coin-icon" />
                        <span class="coin-label">{{ $t('gambling.cf_t') }}</span>
                    </div>
                </div>
            </div>

            <!-- Result overlay -->
            <Transition name="pop">
                <div v-if="showResult" class="result-badge" :class="won ? 'badge-win' : 'badge-lose'">
                    <AppIcon :icon="won ? 'mdi:trophy' : 'mdi:emoticon-sad'" class="badge-icon" />
                    <span class="badge-side">{{ result === 'heads' ? $t('gambling.cf_heads') : $t('gambling.cf_tails')
                        }}</span>
                    <span v-if="won" class="badge-payout">{{ formatCash(payout) }}</span>
                    <span v-else class="badge-text">{{ $t('gambling.cf_you_lose') }}</span>
                </div>
            </Transition>

            <!-- Lucky second chance banner -->
            <Transition name="lucky">
                <div v-if="luckyTriggered" class="lucky-banner">
                    <AppIcon icon="mdi:clover" class="lucky-icon" />
                    <span class="lucky-text">{{ $t('gambling.lucky_trigger') }}</span>
                </div>
            </Transition>
        </div>

        <!-- Side selector -->
        <div class="side-selector">
            <button class="side-btn" :class="{ active: chosenSide === 'heads', disabled: flipping }"
                :disabled="flipping" @click="chosenSide = 'heads'">
                <AppIcon icon="mdi:crown" class="side-icon" />
                <span>{{ $t('gambling.cf_heads') }}</span>
            </button>
            <span class="side-vs">{{ $t('gambling.cf_vs') }}</span>
            <button class="side-btn" :class="{ active: chosenSide === 'tails', disabled: flipping }"
                :disabled="flipping" @click="chosenSide = 'tails'">
                <AppIcon icon="mdi:shield" class="side-icon" />
                <span>{{ $t('gambling.cf_tails') }}</span>
            </button>
        </div>

        <!-- Controls -->
        <div class="controls-row">
            <div class="bet-section">
                <label class="bet-label">{{ $t('gambling.bet_amount') }}</label>
                <div class="bet-row">
                    <button class="bet-adj" @click="halfBet" :disabled="flipping">1/2</button>
                    <div class="bet-display">
                        <input type="number" v-model.number="betAmount" :min="1" :max="player.cash.toNumber()"
                            class="bet-input" :disabled="flipping" />
                    </div>
                    <button class="bet-adj" @click="doubleBet" :disabled="flipping">x2</button>
                </div>
                <div class="bet-presets">
                    <button v-for="pct in [10, 25, 50]" :key="pct" class="preset-btn"
                        @click="setBet(Math.floor(player.cash.toNumber() * pct / 100))" :disabled="flipping">
                        {{ pct }}%
                    </button>
                    <button class="preset-btn preset-max" @click="maxBet" :disabled="flipping">{{ $t('gambling.max')
                        }}</button>
                </div>
            </div>

            <div class="action-col">
                <button class="flip-btn" :disabled="!canFlip" @click="flip">
                    <AppIcon :icon="flipping ? 'mdi:loading' : 'mdi:rotate-3d-variant'"
                        :class="{ 'spin-icon': flipping }" />
                    {{ flipping ? $t('gambling.cf_flipping') : $t('gambling.cf_flip') }}
                </button>
                <button v-if="showResult" class="new-round-btn" @click="newRound">
                    <AppIcon icon="mdi:refresh" /> {{ $t('gambling.new_round') }}
                </button>
            </div>
        </div>

        <!-- Info Panel -->
        <InfoPanel :title="$t('gambling.cf_odds')" :sections="coinFlipInfo" />

        <!-- Stats -->
        <div class="cf-stats">
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_flips') }}</span>
                <span class="stat-value">{{ stats.played }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_wins') }}</span>
                <span class="stat-value">{{ stats.won }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_win_rate') }}</span>
                <span class="stat-value">
                    {{ stats.played > 0 ? Math.round(stats.won / stats.played * 100) : 0 }}%
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_net') }}</span>
                <span class="stat-value" :class="stats.netProfit.gte(0) ? 'success' : 'danger'">
                    {{ formatCash(stats.netProfit) }}
                </span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.coinflip-game {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
    width: 100%;
    height: 100%;
    min-height: 0;
}

/* â”€â”€ Header â”€â”€ */
.cf-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--t-space-3);
}

.back-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--t-transition-fast);
}

.back-btn:hover {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.cf-title {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: 1.3rem;
    font-weight: 700;
}

.title-icon {
    font-size: 1.5rem;
    color: var(--t-accent);
}

.balance-chip {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-success);
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 0.85rem;
}

/* â”€â”€ Coin area â”€â”€ */
.coin-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-6) 0;
}

.coin-stage {
    width: 160px;
    height: 160px;
}

.coin {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transform-origin: center center;
    transition: none;
}

.coin.flipping {
    animation: coinToss 2s ease-out forwards, coinSpin 2s cubic-bezier(0.2, 0.8, 0.3, 1) forwards;
}

/* Vertical toss: up then down */
@keyframes coinToss {
    0% {
        translate: 0 0;
    }

    40% {
        translate: 0 -120px;
    }

    100% {
        translate: 0 0;
    }
}

/* Rotation: continuous spin with deceleration */
@keyframes coinSpin {
    0% {
        transform: perspective(600px) rotateX(0deg);
    }

    100% {
        transform: perspective(600px) rotateX(var(--flip-deg));
    }
}

.coin-face {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    backface-visibility: hidden;
    border: 4px solid color-mix(in srgb, var(--t-text) 15%, transparent);
    box-shadow:
        0 4px 20px var(--t-overlay-light),
        inset 0 2px 10px color-mix(in srgb, var(--t-text) 10%, transparent);
}

.coin-heads {
    background: linear-gradient(145deg, var(--t-gold), var(--t-gold-hover));
    color: var(--t-text-inverse);
}

.coin-tails {
    background: linear-gradient(145deg, var(--t-info), var(--t-info));
    color: var(--t-text-inverse);
    transform: rotateX(180deg);
}

.coin-icon {
    font-size: 3rem;
}

.coin-label {
    font-size: 1.6rem;
    font-weight: 900;
    letter-spacing: 0.1em;
}

/* â”€â”€ Result badge â”€â”€ */
.result-badge {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    animation: badgePop 0.35s ease;
}

.badge-win {
    background: var(--t-success-muted);
    border: 1px solid var(--t-success);
}

.badge-lose {
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
}

.badge-icon {
    font-size: 1.8rem;
}

.badge-win .badge-icon {
    color: var(--t-success);
}

.badge-lose .badge-icon {
    color: var(--t-text-muted);
}

.badge-side {
    font-size: 1.1rem;
    font-weight: 700;
}

.badge-payout {
    font-size: 1.4rem;
    font-weight: 800;
    font-family: var(--font-mono, monospace);
    color: var(--t-success);
}

.badge-text {
    font-size: 0.9rem;
    color: var(--t-text-muted);
}

@keyframes badgePop {
    0% {
        transform: scale(0.9);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* â”€â”€ Side selector â”€â”€ */
.side-selector {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-3);
}

.side-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-1);
    padding: var(--t-space-3) var(--t-space-5);
    background: var(--t-bg-card);
    border: 2px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 1rem;
    font-weight: 700;
    transition: all var(--t-transition-fast);
    min-width: 110px;
}

.side-btn:hover:not(.disabled) {
    background: var(--t-bg-hover);
}

.side-btn.active {
    background: var(--t-accent);
    color: var(--t-text);
    box-shadow: 0 0 16px rgba(var(--t-accent-rgb, 99 102 241), 0.35);
}

.side-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.side-icon {
    font-size: 1.8rem;
}

.side-vs {
    font-size: 0.75rem;
    font-weight: 800;
    letter-spacing: 0.15em;
    color: var(--t-text-muted);
}

/* â”€â”€ Controls (shared pattern with roulette) â”€â”€ */
.controls-row {
    display: flex;
    gap: var(--t-space-3);
    align-items: center;
}

.bet-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-3);
    box-shadow: var(--t-shadow-sm);
}

.bet-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    color: var(--t-text-muted);
}

.bet-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.bet-adj {
    width: 36px;
    height: 36px;
    border-radius: var(--t-radius-md);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    color: var(--t-text);
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    transition: all var(--t-transition-fast);
}

.bet-adj:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.bet-adj:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.bet-display {
    flex: 1;
}

.bet-input {
    width: 100%;
    text-align: center;
    font-size: 1rem;
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text);
    outline: none;
}

.bet-presets {
    display: flex;
    gap: 4px;
}

.preset-btn {
    flex: 1;
    padding: var(--t-space-1) var(--t-space-2);
    font-size: 0.7rem;
    font-weight: 600;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.preset-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.preset-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.preset-max {
    color: var(--t-accent);
    font-weight: 700;
}

/* â”€â”€ Action buttons â”€â”€ */
.action-col {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    min-width: 130px;
}

.flip-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-accent);
    color: var(--t-text);
    border: none;
    border-radius: var(--t-radius-md);
    font-size: 1rem;
    font-weight: 800;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.flip-btn:hover:not(:disabled) {
    filter: brightness(1.1);
}

.flip-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.spin-icon {
    animation: spinAnim 1s linear infinite;
}

@keyframes spinAnim {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

.new-round-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-accent);
    border-radius: var(--t-radius-md);
    color: var(--t-accent);
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 600;
    transition: all var(--t-transition-fast);
}

.new-round-btn:hover {
    background: var(--t-bg-hover);
}

/* â”€â”€ Stats â”€â”€ */
.cf-stats {
    display: flex;
    gap: var(--t-space-4);
    justify-content: space-evenly;
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    box-shadow: var(--t-shadow-sm);
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.stat-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--t-text-muted);
}

.stat-value {
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 1rem;
}

.success {
    color: var(--t-success);
}

.danger {
    color: var(--t-danger);
}

/* â”€â”€ Transitions â”€â”€ */
.pop-enter-active {
    transition: all 0.35s ease;
}

.pop-leave-active {
    transition: all 0.2s ease;
}

.pop-enter-from {
    transform: scale(0.8);
    opacity: 0;
}

.pop-leave-to {
    opacity: 0;
}

/* â”€â”€ Lucky banner â”€â”€ */
.lucky-banner {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    background: linear-gradient(135deg, var(--t-success-muted), color-mix(in srgb, var(--t-success) 5%, transparent));
    border: 1px solid var(--t-success);
    box-shadow: 0 0 24px var(--t-success-muted);
    animation: luckyPulse 0.8s ease infinite alternate;
}

.lucky-icon {
    font-size: 2rem;
    color: var(--t-success);
    animation: luckyCloverSpin 1s ease;
    filter: drop-shadow(0 0 6px var(--t-success-muted));
}

.lucky-text {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--t-success);
    letter-spacing: 0.05em;
    text-shadow: 0 0 8px var(--t-success-muted);
}

@keyframes luckyPulse {
    from {
        box-shadow: 0 0 16px var(--t-success-muted);
    }

    to {
        box-shadow: 0 0 32px var(--t-success-muted);
    }
}

@keyframes luckyCloverSpin {
    0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
    }

    50% {
        transform: scale(1.3) rotate(10deg);
        opacity: 1;
    }

    100% {
        transform: scale(1) rotate(0deg);
    }
}

.lucky-enter-active {
    animation: luckyIn 0.5s ease;
}

.lucky-leave-active {
    animation: luckyOut 0.3s ease;
}

@keyframes luckyIn {
    0% {
        transform: scale(0.5) translateY(-10px);
        opacity: 0;
    }

    60% {
        transform: scale(1.1) translateY(0);
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes luckyOut {
    to {
        transform: scale(0.8) translateY(10px);
        opacity: 0;
    }
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\DiceFace.vue ===
<script setup lang="ts">
/**
 * DiceFace â€” A single 3D CSS die with animated roll.
 * Displays pips on all 6 faces and rotates to show the result.
 * Uses the Web Animations API so the tumble ends on the correct face.
 */
import { ref, computed, watch, onBeforeUnmount } from 'vue'

const props = defineProps<{
    /** The face value to show (1-6), null = idle */
    value: number | null
    /** Whether the die is currently rolling */
    rolling: boolean
}>()

const dieRef = ref<HTMLElement>()
let currentAnim: Animation | null = null

// Maps face value â†’ [rotateX, rotateY] degrees to bring that face to front
const FACE_ANGLES: Record<number, [number, number]> = {
    1: [0, 0],       // front
    2: [0, -90],     // right
    3: [-90, 0],     // top
    4: [90, 0],      // bottom
    5: [0, 90],      // left
    6: [180, 0],     // back
}

const FACE_ROTATIONS: Record<number, string> = {
    1: 'rotateX(0deg)    rotateY(0deg)',
    2: 'rotateX(0deg)    rotateY(-90deg)',
    3: 'rotateX(-90deg)  rotateY(0deg)',
    4: 'rotateX(90deg)   rotateY(0deg)',
    5: 'rotateX(0deg)    rotateY(90deg)',
    6: 'rotateX(180deg)  rotateY(0deg)',
}

// Inline transform for when not animating
const dieStyle = computed(() => {
    if (props.value === null) return {}
    return { transform: FACE_ROTATIONS[props.value] }
})

// When the target value is set during a roll, start a tumble â†’ land animation
watch(() => props.value, (val) => {
    if (val === null || !props.rolling || !dieRef.value) return

    const [endX, endY] = FACE_ANGLES[val]

    currentAnim?.cancel()
    currentAnim = dieRef.value.animate(
        [
            { transform: 'rotateX(0deg)   rotateY(0deg)   rotateZ(0deg)' },
            { transform: 'rotateX(200deg) rotateY(150deg)  rotateZ(80deg)', offset: 0.15 },
            { transform: 'rotateX(450deg) rotateY(320deg)  rotateZ(200deg)', offset: 0.4 },
            { transform: 'rotateX(620deg) rotateY(510deg)  rotateZ(310deg)', offset: 0.7 },
            { transform: `rotateX(${720 + endX}deg) rotateY(${720 + endY}deg) rotateZ(360deg)` },
        ],
        { duration: 1400, easing: 'cubic-bezier(0.15, 0.8, 0.25, 1)', fill: 'forwards' },
    )
})

// When rolling finishes, drop the fill so inline dieStyle takes over
watch(() => props.rolling, (isRolling) => {
    if (!isRolling && currentAnim) {
        currentAnim.cancel()
        currentAnim = null
    }
})

onBeforeUnmount(() => { currentAnim?.cancel(); currentAnim = null })
</script>

<template>
    <div class="die-stage">
        <div ref="dieRef" class="die" :style="dieStyle">
            <!-- Face 1 (front) -->
            <div class="face face-1">
                <span class="pip center"></span>
            </div>
            <!-- Face 2 (right) -->
            <div class="face face-2">
                <span class="pip top-right"></span>
                <span class="pip bottom-left"></span>
            </div>
            <!-- Face 3 (top) -->
            <div class="face face-3">
                <span class="pip top-right"></span>
                <span class="pip center"></span>
                <span class="pip bottom-left"></span>
            </div>
            <!-- Face 4 (bottom) -->
            <div class="face face-4">
                <span class="pip top-left"></span>
                <span class="pip top-right"></span>
                <span class="pip bottom-left"></span>
                <span class="pip bottom-right"></span>
            </div>
            <!-- Face 5 (left) -->
            <div class="face face-5">
                <span class="pip top-left"></span>
                <span class="pip top-right"></span>
                <span class="pip center"></span>
                <span class="pip bottom-left"></span>
                <span class="pip bottom-right"></span>
            </div>
            <!-- Face 6 (back) -->
            <div class="face face-6">
                <span class="pip top-left"></span>
                <span class="pip top-right"></span>
                <span class="pip mid-left"></span>
                <span class="pip mid-right"></span>
                <span class="pip bottom-left"></span>
                <span class="pip bottom-right"></span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.die-stage {
    width: 100px;
    height: 100px;
    perspective: 400px;
}

.die {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.3, 1);
}

.face {
    --dice-face-light: #fafafa;
    --dice-face-dark: #e0e0e0;
    position: absolute;
    width: 100px;
    height: 100px;
    background: linear-gradient(145deg, var(--dice-face-light), var(--dice-face-dark));
    border: 2px solid var(--t-border);
    border-radius: var(--t-radius-xl);
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-rows: 1fr 1fr 1fr;
    padding: 12px;
    box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
}

.pip {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: radial-gradient(circle at 35% 35%, var(--t-text-inverse), var(--t-text-inverse));
    box-shadow: 0 1px 3px var(--t-overlay-light);
}

/* pip placement via grid */
.top-left {
    grid-column: 1;
    grid-row: 1;
    align-self: start;
    justify-self: start;
}

.top-right {
    grid-column: 3;
    grid-row: 1;
    align-self: start;
    justify-self: end;
}

.mid-left {
    grid-column: 1;
    grid-row: 2;
    align-self: center;
    justify-self: start;
}

.center {
    grid-column: 2;
    grid-row: 2;
    align-self: center;
    justify-self: center;
}

.mid-right {
    grid-column: 3;
    grid-row: 2;
    align-self: center;
    justify-self: end;
}

.bottom-left {
    grid-column: 1;
    grid-row: 3;
    align-self: end;
    justify-self: start;
}

.bottom-right {
    grid-column: 3;
    grid-row: 3;
    align-self: end;
    justify-self: end;
}

/* 3D face positions */
.face-1 {
    transform: translateZ(50px);
}

/* front */
.face-6 {
    transform: rotateY(180deg) translateZ(50px);
}

/* back */
.face-2 {
    transform: rotateY(90deg) translateZ(50px);
}

/* right */
.face-5 {
    transform: rotateY(-90deg) translateZ(50px);
}

/* left */
.face-3 {
    transform: rotateX(90deg) translateZ(50px);
}

/* top */
.face-4 {
    transform: rotateX(-90deg) translateZ(50px);
}

/* bottom */
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\DiceGame.vue ===
<script setup lang="ts">
/**
 * DiceGame â€” Roll-over / Roll-under dice game with two 3D dice.
 *
 * Mechanic:
 *  - Two dice are rolled (sum 2-12)
 *  - Player picks a target number (3-11) and bets OVER or UNDER
 *  - Payout multiplier scales with difficulty (fewer winning outcomes = higher payout)
 *  - Rolling exactly the target = loss (house edge)
 */
import { ref, computed } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import DiceFace from './DiceFace.vue'
import InfoPanel from '@renderer/components/layout/InfoPanel.vue'
import type { InfoSection } from '@renderer/components/layout/InfoPanel.vue'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'
import { usePlayerStore } from '@renderer/stores/usePlayerStore'
import { useGamblingStore } from '@renderer/stores/useGamblingStore'
import { D, ZERO, mul } from '@renderer/core/BigNum'
import type Decimal from 'break_infinity.js'

const emit = defineEmits<{ back: [] }>()
const { t } = useI18n()

const player = usePlayerStore()
const gambling = useGamblingStore()
const { formatCash } = useFormat()

// â”€â”€â”€ Dice probability table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Total ways to roll each sum with 2d6 (total combinations = 36)
const WAYS: Record<number, number> = {
    2: 1, 3: 2, 4: 3, 5: 4, 6: 5, 7: 6,
    8: 5, 9: 4, 10: 3, 11: 2, 12: 1,
}

function waysOver(target: number): number {
    let count = 0
    for (let i = target + 1; i <= 12; i++) count += WAYS[i]
    return count
}

function waysUnder(target: number): number {
    let count = 0
    for (let i = 2; i < target; i++) count += WAYS[i]
    return count
}

/** Multiplier = 36 / winning_ways Ã— 0.97 (3% house edge) */
function calcMultiplier(ways: number): number {
    if (ways <= 0) return 0
    return Math.round((36 / ways) * 0.97 * 100) / 100
}

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
type Direction = 'over' | 'under'

const betAmount = ref(10)
const target = ref(7)
const direction = ref<Direction>('over')

const rolling = ref(false)
const die1 = ref<number | null>(null)
const die2 = ref<number | null>(null)
const showResult = ref(false)
const won = ref(false)
const lastPayout = ref<Decimal | null>(null)
/** Luck triggered â€” shows clover animation between first loss and re-roll */
const luckyTriggered = ref(false)

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const winWays = computed(() =>
    direction.value === 'over' ? waysOver(target.value) : waysUnder(target.value)
)
const winChance = computed(() => Math.round((winWays.value / 36) * 1000) / 10)
const multiplier = computed(() => calcMultiplier(winWays.value))
const rollSum = computed(() => (die1.value !== null && die2.value !== null) ? die1.value + die2.value : null)

const betDecimal = computed(() => D(betAmount.value))
const canRoll = computed(() =>
    !rolling.value &&
    betAmount.value > 0 &&
    player.cash.gte(betDecimal.value) &&
    winWays.value > 0
)

const stats = computed(() => gambling.getStats('dice'))

const potentialPayout = computed(() => {
    if (multiplier.value <= 0) return ZERO
    return mul(betDecimal.value, multiplier.value)
})

// â”€â”€â”€ Roll logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function roll(): void {
    if (!canRoll.value) return
    if (!player.spendCash(betDecimal.value)) return

    rolling.value = true
    showResult.value = false
    die1.value = null
    die2.value = null
    won.value = false
    lastPayout.value = null
    luckyTriggered.value = false

    // Determine base result
    const r1 = Math.floor(Math.random() * 6) + 1
    const r2 = Math.floor(Math.random() * 6) + 1
    const sum = r1 + r2
    const isWin = direction.value === 'over' ? sum > target.value : sum < target.value

    if (isWin) {
        // Won on first roll â€” normal animation
        playRoll(r1, r2, true)
    } else {
        // Lost â€” check luck second chance
        const luckBonus = gambling.getLuckBonus()
        const luckyReroll = luckBonus > 0 && Math.random() < luckBonus

        if (luckyReroll) {
            // Show losing dice first, then lucky banner, then re-roll
            playRoll(r1, r2, false, () => {
                luckyTriggered.value = true
                setTimeout(() => {
                    luckyTriggered.value = false
                    // Generate second roll
                    const nr1 = Math.floor(Math.random() * 6) + 1
                    const nr2 = Math.floor(Math.random() * 6) + 1
                    die1.value = null
                    die2.value = null
                    rolling.value = true
                    playRoll(nr1, nr2, true)
                }, 1400) // lucky banner duration
            })
        } else {
            // Normal loss
            playRoll(r1, r2, true)
        }
    }
}

/** Animate a roll to a specific outcome. If `isFinal`, evaluate win/loss at the end. */
function playRoll(r1: number, r2: number, isFinal: boolean, onLand?: () => void): void {
    // Show dice faces after short delay
    setTimeout(() => {
        die1.value = r1
        die2.value = r2
    }, 100)

    setTimeout(() => {
        if (isFinal) {
            const sum = r1 + r2
            const isWin = direction.value === 'over' ? sum > target.value : sum < target.value
            if (isWin) {
                const pay = mul(betDecimal.value, multiplier.value)
                player.earnCash(pay)
                gambling.recordWin('dice', betDecimal.value, pay)
                lastPayout.value = pay
                won.value = true
            } else {
                gambling.recordLoss('dice', betDecimal.value)
                won.value = false
            }

            showResult.value = true
            rolling.value = false
        } else {
            rolling.value = false
            if (onLand) onLand()
        }
    }, 1600)
}

function newRound(): void {
    showResult.value = false
    die1.value = null
    die2.value = null
    lastPayout.value = null
}

// â”€â”€â”€ Bet helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setBet(amount: number): void {
    betAmount.value = Math.max(1, Math.min(amount, player.cash.toNumber()))
}
function halfBet(): void { setBet(Math.max(1, Math.floor(betAmount.value / 2))) }
function doubleBet(): void { setBet(betAmount.value * 2) }
function maxBet(): void { setBet(player.cash.toNumber()) }

// â”€â”€â”€ Info Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const diceInfo = computed<InfoSection[]>(() => [
    {
        title: t('gambling.info.dice.how_title'),
        icon: 'mdi:help-circle-outline',
        entries: [
            { term: t('gambling.info.dice.two_dice'), desc: t('gambling.info.dice.two_dice_desc'), icon: 'mdi:dice-multiple' },
            { term: t('gambling.info.dice.pick_target'), desc: t('gambling.info.dice.pick_target_desc'), icon: 'mdi:bullseye' },
            { term: t('gambling.info.dice.over_under'), desc: t('gambling.info.dice.over_under_desc'), icon: 'mdi:arrow-split-horizontal' },
        ]
    },
    {
        title: t('gambling.info.dice.odds_title'),
        icon: 'mdi:cash-multiple',
        entries: [
            { term: t('gambling.info.dice.dynamic'), desc: t('gambling.info.dice.dynamic_desc'), icon: 'mdi:trending-up' },
            { term: t('gambling.info.dice.house_edge'), desc: t('gambling.info.dice.house_edge_desc'), icon: 'mdi:bank' },
            { term: t('gambling.info.dice.example_over7'), desc: t('gambling.info.dice.example_over7_desc'), icon: 'mdi:calculator' },
            { term: t('gambling.info.dice.example_under4'), desc: t('gambling.info.dice.example_under4_desc'), icon: 'mdi:fire' },
        ]
    },
])
</script>

<template>
    <div class="dice-game">
        <!-- Header -->
        <div class="dice-header">
            <button class="back-btn" @click="$emit('back')">
                <AppIcon icon="mdi:arrow-left" /> {{ $t('gambling.back') }}
            </button>
            <h2 class="dice-title">
                <AppIcon icon="mdi:dice-6" class="title-icon" />
                {{ $t('gambling.dc_title') }}
            </h2>
            <div class="balance-chip">
                <AppIcon icon="mdi:cash" />
                {{ formatCash(player.cash) }}
            </div>
        </div>

        <!-- Dice area -->
        <div class="dice-area">
            <div class="dice-pair">
                <DiceFace :value="die1" :rolling="rolling" />
                <DiceFace :value="die2" :rolling="rolling" />
            </div>

            <!-- Roll sum display -->
            <Transition name="pop">
                <div v-if="rollSum !== null && !rolling" class="sum-badge" :class="{ won, lost: showResult && !won }">
                    <span class="sum-value">{{ rollSum }}</span>
                    <span class="sum-label">
                        {{ won ? $t('gambling.dc_win') : showResult ? $t('gambling.dc_lose') : '' }}
                    </span>
                </div>
            </Transition>
        </div>

        <!-- Target selector -->
        <div class="target-section">
            <div class="target-header">
                <span class="target-label-text">{{ $t('gambling.dc_target') }}</span>
                <span class="target-number">{{ target }}</span>
            </div>

            <input type="range" v-model.number="target" :min="3" :max="11" :step="1" class="target-slider"
                :disabled="rolling" />

            <div class="target-scale">
                <span v-for="n in 9" :key="n" class="scale-mark" :class="{ active: n + 2 === target }">
                    {{ n + 2 }}
                </span>
            </div>
        </div>

        <!-- Direction selector + stats -->
        <div class="direction-row">
            <button class="dir-btn dir-under" :class="{ active: direction === 'under' }" :disabled="rolling"
                @click="direction = 'under'">
                <AppIcon icon="mdi:arrow-down-bold" />
                <span class="dir-label">{{ $t('gambling.dc_under', { n: target }) }}</span>
                <span class="dir-detail">{{ waysUnder(target) }}/36 Â· {{ direction === 'under' ? winChance :
                    Math.round(waysUnder(target) / 36 * 1000) / 10 }}%</span>
            </button>

            <div class="payout-display">
                <span class="payout-label">{{ $t('gambling.dc_multiplier') }}</span>
                <span class="payout-value">{{ multiplier }}Ã—</span>
                <span class="payout-sub">{{ $t('gambling.dc_win_chance', { pct: winChance }) }}</span>
                <span class="payout-sub">{{ $t('gambling.dc_potential', { amount: formatCash(potentialPayout) })
                    }}</span>
            </div>

            <button class="dir-btn dir-over" :class="{ active: direction === 'over' }" :disabled="rolling"
                @click="direction = 'over'">
                <AppIcon icon="mdi:arrow-up-bold" />
                <span class="dir-label">{{ $t('gambling.dc_over', { n: target }) }}</span>
                <span class="dir-detail">{{ waysOver(target) }}/36 Â· {{ direction === 'over' ? winChance :
                    Math.round(waysOver(target) / 36 * 1000) / 10 }}%</span>
            </button>
        </div>

        <!-- Result banner -->
        <Transition name="pop">
            <div v-if="showResult" class="result-banner" :class="won ? 'banner-win' : 'banner-lose'">
                <AppIcon :icon="won ? 'mdi:trophy' : 'mdi:emoticon-sad'" class="banner-icon" />
                <div class="banner-info">
                    <span class="banner-text">
                        {{ $t('gambling.dc_rolled', { sum: rollSum }) }}
                        {{ won ? $t('gambling.dc_you_win') : $t('gambling.dc_needed', {
                            dir: direction === 'over' ? '>'
                                : '<', target
                        }) }} </span>
                            <span v-if="won && lastPayout" class="banner-amount">{{ formatCash(lastPayout) }}</span>
                </div>
            </div>
        </Transition>

        <!-- Lucky second chance banner -->
        <Transition name="lucky">
            <div v-if="luckyTriggered" class="lucky-banner">
                <AppIcon icon="mdi:clover" class="lucky-icon" />
                <span class="lucky-text">{{ $t('gambling.lucky_trigger') }}</span>
            </div>
        </Transition>

        <!-- Controls -->
        <div class="controls-row">
            <div class="bet-section">
                <label class="bet-label">{{ $t('gambling.bet_amount') }}</label>
                <div class="bet-row">
                    <button class="bet-adj" @click="halfBet" :disabled="rolling">1/2</button>
                    <div class="bet-display">
                        <input type="number" v-model.number="betAmount" :min="1" :max="player.cash.toNumber()"
                            class="bet-input" :disabled="rolling" />
                    </div>
                    <button class="bet-adj" @click="doubleBet" :disabled="rolling">x2</button>
                </div>
                <div class="bet-presets">
                    <button v-for="pct in [10, 25, 50]" :key="pct" class="preset-btn"
                        @click="setBet(Math.floor(player.cash.toNumber() * pct / 100))" :disabled="rolling">
                        {{ pct }}%
                    </button>
                    <button class="preset-btn preset-max" @click="maxBet" :disabled="rolling">{{ $t('gambling.max')
                        }}</button>
                </div>
            </div>

            <div class="action-col">
                <button class="roll-btn" :disabled="!canRoll" @click="roll">
                    <AppIcon :icon="rolling ? 'mdi:loading' : 'mdi:dice-multiple'" :class="{ 'spin-icon': rolling }" />
                    {{ rolling ? $t('gambling.dc_rolling') : $t('gambling.dc_roll') }}
                </button>
                <button v-if="showResult" class="new-round-btn" @click="newRound">
                    <AppIcon icon="mdi:refresh" /> {{ $t('gambling.new_round') }}
                </button>
            </div>
        </div>

        <!-- Info Panel -->
        <InfoPanel :title="$t('gambling.dc_odds')" :sections="diceInfo" />

        <!-- Stats -->
        <div class="dice-stats">
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_rolls') }}</span>
                <span class="stat-value">{{ stats.played }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_wins') }}</span>
                <span class="stat-value">{{ stats.won }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_win_rate') }}</span>
                <span class="stat-value">
                    {{ stats.played > 0 ? Math.round(stats.won / stats.played * 100) : 0 }}%
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_net') }}</span>
                <span class="stat-value" :class="stats.netProfit.gte(0) ? 'success' : 'danger'">
                    {{ formatCash(stats.netProfit) }}
                </span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.dice-game {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
    width: 100%;
    height: 100%;
    min-height: 0;
}

/* â”€â”€ Header â”€â”€ */
.dice-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--t-space-3);
}

.back-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--t-transition-fast);
}

.back-btn:hover {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.dice-title {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: 1.3rem;
    font-weight: 700;
}

.title-icon {
    font-size: 1.5rem;
    color: var(--t-accent);
}

.balance-chip {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-success);
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 0.85rem;
}

/* â”€â”€ Dice area â”€â”€ */
.dice-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-4);
    padding: var(--t-space-5) 0;
}

.dice-pair {
    display: flex;
    gap: var(--t-space-5);
    justify-content: center;
}

.sum-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: var(--t-space-2) var(--t-space-4);
    border-radius: var(--t-radius-lg);
    background: var(--t-bg-muted);
    border: 2px solid var(--t-border);
}

.sum-badge.won {
    background: var(--t-success-muted);
    border-color: var(--t-success);
}

.sum-badge.lost {
    background: var(--t-danger-muted);
    border-color: var(--t-danger);
}

.sum-value {
    font-size: 2rem;
    font-weight: 900;
    font-family: var(--font-mono, monospace);
}

.sum-badge.won .sum-value {
    color: var(--t-success);
}

.sum-badge.lost .sum-value {
    color: var(--t-danger);
}

.sum-label {
    font-size: 0.7rem;
    font-weight: 800;
    letter-spacing: 0.15em;
    text-transform: uppercase;
}

/* â”€â”€ Target selector â”€â”€ */
.target-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
}

.target-header {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
}

.target-label-text {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--t-text-muted);
}

.target-number {
    font-size: 1.8rem;
    font-weight: 900;
    font-family: var(--font-mono, monospace);
    color: var(--t-accent);
    min-width: 40px;
    text-align: center;
}

.target-slider {
    width: 100%;
    max-width: 400px;
    accent-color: var(--t-accent);
    cursor: pointer;
}

.target-scale {
    display: flex;
    justify-content: space-between;
    width: 100%;
    max-width: 400px;
}

.scale-mark {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--t-text-muted);
    width: 24px;
    text-align: center;
}

.scale-mark.active {
    color: var(--t-accent);
    font-weight: 800;
}

/* â”€â”€ Direction buttons â”€â”€ */
.direction-row {
    display: flex;
    gap: var(--t-space-3);
    align-items: stretch;
}

.dir-btn {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-1);
    padding: var(--t-space-3);
    background: var(--t-bg-card);
    border: 2px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    cursor: pointer;
    transition: all var(--t-transition-fast);
    color: var(--t-text-secondary);
    font-size: 1rem;
}

.dir-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.dir-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.dir-btn.active.dir-under {
    border-color: var(--t-danger);
    background: var(--t-danger-muted);
    color: var(--t-danger);
}

.dir-btn.active.dir-over {
    border-color: var(--t-success);
    background: var(--t-success-muted);
    color: var(--t-success);
}

.dir-label {
    font-weight: 800;
    font-size: 0.95rem;
}

.dir-detail {
    font-size: 0.7rem;
    color: var(--t-text-muted);
}

/* â”€â”€ Payout display â”€â”€ */
.payout-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    min-width: 130px;
    padding: var(--t-space-3);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
}

.payout-label {
    font-size: 0.6rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--t-text-muted);
}

.payout-value {
    font-size: 1.6rem;
    font-weight: 900;
    font-family: var(--font-mono, monospace);
    color: var(--t-accent);
}

.payout-sub {
    font-size: 0.7rem;
    color: var(--t-text-muted);
}

/* â”€â”€ Result banner â”€â”€ */
.result-banner {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-4);
    border-radius: var(--t-radius-lg);
    animation: bannerPop 0.35s ease;
}

.banner-win {
    background: var(--t-success-muted);
    border: 1px solid var(--t-success);
}

.banner-lose {
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
}

.banner-icon {
    font-size: 1.8rem;
}

.banner-win .banner-icon {
    color: var(--t-success);
}

.banner-lose .banner-icon {
    color: var(--t-text-muted);
}

.banner-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.banner-text {
    font-size: 0.9rem;
}

.banner-amount {
    font-size: 1.3rem;
    font-weight: 800;
    font-family: var(--font-mono, monospace);
    color: var(--t-success);
}

@keyframes bannerPop {
    0% {
        transform: scale(0.95);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* â”€â”€ Controls (shared pattern) â”€â”€ */
.controls-row {
    display: flex;
    gap: var(--t-space-3);
    align-items: center;
}

.bet-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-3);
    box-shadow: var(--t-shadow-sm);
}

.bet-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    color: var(--t-text-muted);
}

.bet-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.bet-adj {
    width: 36px;
    height: 36px;
    border-radius: var(--t-radius-md);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    color: var(--t-text);
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    transition: all var(--t-transition-fast);
}

.bet-adj:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.bet-adj:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.bet-display {
    flex: 1;
}

.bet-input {
    width: 100%;
    text-align: center;
    font-size: 1rem;
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text);
    outline: none;
}

.bet-presets {
    display: flex;
    gap: 4px;
}

.preset-btn {
    flex: 1;
    padding: var(--t-space-1) var(--t-space-2);
    font-size: 0.7rem;
    font-weight: 600;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.preset-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.preset-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.preset-max {
    color: var(--t-accent);
    font-weight: 700;
}

/* â”€â”€ Action buttons â”€â”€ */
.action-col {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    min-width: 130px;
}

.roll-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-accent);
    color: var(--t-text);
    border: none;
    border-radius: var(--t-radius-md);
    font-size: 1rem;
    font-weight: 800;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.roll-btn:hover:not(:disabled) {
    filter: brightness(1.1);
}

.roll-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.spin-icon {
    animation: spinAnim 1s linear infinite;
}

@keyframes spinAnim {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

.new-round-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-accent);
    border-radius: var(--t-radius-md);
    color: var(--t-accent);
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 600;
    transition: all var(--t-transition-fast);
}

.new-round-btn:hover {
    background: var(--t-bg-hover);
}

/* â”€â”€ Stats â”€â”€ */
.dice-stats {
    display: flex;
    gap: var(--t-space-4);
    justify-content: space-evenly;
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    box-shadow: var(--t-shadow-sm);
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.stat-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--t-text-muted);
}

.stat-value {
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 1rem;
}

.success {
    color: var(--t-success);
}

.danger {
    color: var(--t-danger);
}

/* â”€â”€ Transitions â”€â”€ */
.pop-enter-active {
    transition: all 0.35s ease;
}

.pop-leave-active {
    transition: all 0.2s ease;
}

.pop-enter-from {
    transform: scale(0.8);
    opacity: 0;
}

.pop-leave-to {
    opacity: 0;
}

/* â”€â”€ Lucky banner â”€â”€ */
.lucky-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    background: linear-gradient(135deg, var(--t-success-muted), color-mix(in srgb, var(--t-success) 5%, transparent));
    border: 1px solid var(--t-success);
    box-shadow: 0 0 24px var(--t-success-muted);
    animation: luckyPulse 0.8s ease infinite alternate;
}

.lucky-icon {
    font-size: 2rem;
    color: var(--t-success);
    animation: luckyCloverSpin 1s ease;
    filter: drop-shadow(0 0 6px var(--t-success-muted));
}

.lucky-text {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--t-success);
    letter-spacing: 0.05em;
    text-shadow: 0 0 8px var(--t-success-muted);
}

@keyframes luckyPulse {
    from {
        box-shadow: 0 0 16px var(--t-success-muted);
    }

    to {
        box-shadow: 0 0 32px var(--t-success-muted);
    }
}

@keyframes luckyCloverSpin {
    0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
    }

    50% {
        transform: scale(1.3) rotate(10deg);
        opacity: 1;
    }

    100% {
        transform: scale(1) rotate(0deg);
    }
}

.lucky-enter-active {
    animation: luckyIn 0.5s ease;
}

.lucky-leave-active {
    animation: luckyOut 0.3s ease;
}

@keyframes luckyIn {
    0% {
        transform: scale(0.5) translateY(-10px);
        opacity: 0;
    }

    60% {
        transform: scale(1.1) translateY(0);
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes luckyOut {
    to {
        transform: scale(0.8) translateY(10px);
        opacity: 0;
    }
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\GamblingStats.vue ===
<script setup lang="ts">
import AppIcon from '@renderer/components/AppIcon.vue'

defineProps<{
    totalWon: string
    totalLost: string
    netProfit: string
    isProfitable: boolean
}>()
</script>

<template>
    <div class="overall-stats glass-card-static">
        <h3 class="stats-title">
            <AppIcon icon="mdi:chart-bar" class="section-icon" />
            {{ $t('gambling.gambling_statistics') }}
        </h3>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.total_wins') }}</span>
                <span class="stat-value text-emerald">{{ totalWon }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.total_losses') }}</span>
                <span class="stat-value text-red">{{ totalLost }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.net_profit') }}</span>
                <span class="stat-value" :class="isProfitable ? 'positive' : 'negative'">{{ netProfit }}</span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.overall-stats {
    padding: var(--spacing-lg);
}

.stats-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: var(--spacing-md);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-lg);
}

.stat-item {
    display: flex;
    flex-direction: column;
}

.stat-item .stat-label {
    font-size: 0.75rem;
    color: var(--color-text-dim);
}

.stat-item .stat-value {
    font-family: var(--font-mono);
    font-size: 1.1rem;
    font-weight: 700;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\GameCard.vue ===
<script setup lang="ts">
/**
 * GameCard â€” Casino lobby game tile.
 * Displays a game with accent color, category badge, odds/payout,
 * win/loss record, and a play button.
 */
import AppIcon from '@renderer/components/AppIcon.vue'

defineProps<{
    name: string
    icon: string
    description: string
    odds: string
    payout: string
    category: string
    accent: string
    gamesPlayed: number
    wins: string
    losses: string
    netProfit: string
    isProfitable: boolean
    /** Luck mechanic label(s) â€” e.g. 'Second Chance', 'Anti-Bust', or empty for Pure RNG */
    luckMechanic: string | string[]
}>()

defineEmits<{ play: [] }>()
</script>

<template>
    <div class="game-card" :style="{ '--_accent': accent }">

        <!-- Top row: icon + name + category badge -->
        <div class="game-card__head">
            <AppIcon :icon="icon" class="game-card__icon" />
            <div class="game-card__identity">
                <div class="game-card__name-row">
                    <span class="game-card__name">{{ name }}</span>
                </div>
                <span class="game-card__tagline">{{ description }}</span>
            </div>
            <span class="game-card__stage">{{ category }}</span>
        </div>

        <!-- Meta row: luck mechanic tags -->
        <div class="game-card__meta">
            <template v-if="Array.isArray(luckMechanic) ? luckMechanic.length : luckMechanic">
                <span v-for="m in (Array.isArray(luckMechanic) ? luckMechanic : [luckMechanic])" :key="m"
                    class="game-card__trait game-card__trait--pos">
                    <AppIcon icon="mdi:clover" />
                    {{ m }}
                </span>
            </template>
            <span v-else class="game-card__trait game-card__trait--neutral">
                <AppIcon icon="mdi:dice-multiple" />
                {{ $t('gambling.pure_rng') }}
            </span>
        </div>

        <!-- Stats grid: odds / payout / record -->
        <div class="game-card__stats">
            <div class="game-card__kpi">
                <span class="game-card__kpi-label">{{ $t('gambling.odds_label') }}</span>
                <span class="game-card__kpi-value game-card__kpi-value--blue">{{ odds }}</span>
            </div>
            <div class="game-card__kpi">
                <span class="game-card__kpi-label">{{ $t('gambling.payout_label') }}</span>
                <span class="game-card__kpi-value game-card__kpi-value--green">{{ payout }}</span>
            </div>
            <div class="game-card__kpi">
                <span class="game-card__kpi-label">{{ $t('gambling.record_label', 'Record') }}</span>
                <template v-if="gamesPlayed > 0">
                    <span class="game-card__kpi-value"
                        :class="isProfitable ? 'game-card__kpi-value--green' : 'game-card__kpi-value--red'">
                        {{ wins }}W / {{ losses }}L
                    </span>
                </template>
                <span v-else class="game-card__kpi-value game-card__kpi-value--muted">â€”</span>
            </div>
        </div>

        <!-- Net profit (if played) -->
        <div v-if="gamesPlayed > 0" class="game-card__net">
            <span class="game-card__net-label">{{ $t('gambling.net') }}</span>
            <span class="game-card__net-value" :class="isProfitable ? 'positive' : 'negative'">{{ netProfit }}</span>
        </div>

        <!-- Actions -->
        <div class="game-card__actions">
            <button class="btn btn-primary btn-sm game-card__btn game-card__btn--primary" @click="$emit('play')">{{
                $t('gambling.play') }}</button>
        </div>
    </div>
</template>

<style scoped>
/* â”€â”€â”€ Card shell (matches opp-card) â”€â”€â”€ */
.game-card {
    --_accent: var(--t-accent);
    position: relative;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
    padding: var(--t-space-4) var(--t-space-4) var(--t-space-4) calc(var(--t-space-4) + 4px);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    box-shadow: var(--t-shadow-sm);
    transition: border-color var(--t-transition-normal), box-shadow var(--t-transition-normal);
    cursor: pointer;
}

/* .game-card::before {
    content: '';
    position: absolute;
    inset: -1px;
    left: -1px;
    width: 4px;
    border-radius: var(--t-radius-md) 0 0 var(--t-radius-md);
    background: var(--_accent);
} */

.game-card:hover {
    border-color: var(--t-border-hover);
    box-shadow: var(--t-shadow-sm);
}

/* â”€â”€â”€ Head â”€â”€â”€ */
.game-card__head {
    display: flex;
    align-items: flex-start;
    gap: var(--t-space-3);
}

.game-card__icon {
    font-size: 1.5rem;
    color: var(--_accent);
    flex-shrink: 0;
    margin-top: 1px;
}

.game-card__identity {
    flex: 1;
    min-width: 0;
}

.game-card__name-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.game-card__name {
    font-weight: 600;
    font-size: var(--t-font-size-base);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.game-card__tagline {
    display: block;
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-top: 1px;
}

.game-card__stage {
    flex-shrink: 0;
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 2px 8px;
    border-radius: 4px;
    background: color-mix(in srgb, var(--_accent) 12%, transparent);
    color: var(--_accent);
}

/* â”€â”€â”€ Meta / Traits â”€â”€â”€ */
.game-card__meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--t-space-1);
}

.game-card__trait {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    padding: 1px 6px;
    border-radius: 4px;
    font-size: 0.68rem;
    font-weight: 500;
    line-height: 1.5;
}

.game-card__trait--pos {
    background: var(--t-success-muted);
    color: var(--t-success);
}

.game-card__trait--neutral {
    background: color-mix(in srgb, var(--t-text-muted) 10%, transparent);
    color: var(--t-text-muted);
}

/* â”€â”€â”€ Stats grid â”€â”€â”€ */
.game-card__stats {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: var(--t-space-3);
    padding: var(--t-space-3);
    background: var(--t-bg-muted);
    border-radius: var(--t-radius-sm);
}

.game-card__kpi {
    display: flex;
    flex-direction: column;
    gap: 1px;
}

.game-card__kpi:not(:first-child) {
    text-align: right;
    padding-left: var(--t-space-3);
    border-left: 1px solid var(--t-border);
}

.game-card__kpi-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--t-text-muted);
}

.game-card__kpi-value {
    font-family: var(--t-font-mono);
    font-size: var(--t-font-size-sm);
    font-weight: 600;
}

.game-card__kpi-value--gold {
    color: var(--t-warning);
}

.game-card__kpi-value--blue {
    color: var(--t-info);
}

.game-card__kpi-value--green {
    color: var(--t-success);
}

.game-card__kpi-value--red {
    color: var(--t-danger);
}

.game-card__kpi-value--muted {
    color: var(--t-text-muted);
}

/* â”€â”€â”€ Net profit row â”€â”€â”€ */
.game-card__net {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--t-font-size-xs);
}

.game-card__net-label {
    color: var(--t-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.game-card__net-value {
    font-family: var(--t-font-mono);
    font-weight: 600;
    font-size: var(--t-font-size-sm);
}

/* â”€â”€â”€ Actions â”€â”€â”€ */
.game-card__actions {
    display: flex;
    gap: var(--t-space-2);
    justify-content: flex-end;
    margin-top: auto;
}

.game-card__btn {
    font-size: var(--t-font-size-xs) !important;
}

.game-card__btn--primary {
    font-weight: 600;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\index.ts ===
export { default as BetControls } from './BetControls.vue'
export { default as ResultBanner } from './ResultBanner.vue'
export { default as GameCard } from './GameCard.vue'
export { default as GamblingStats } from './GamblingStats.vue'
export { default as SlotLever } from './SlotLever.vue'
export { default as SlotMachine } from './SlotMachine.vue'
export { default as RouletteWheel } from './RouletteWheel.vue'
export { default as RouletteBoard } from './RouletteBoard.vue'
export { default as RouletteGame } from './RouletteGame.vue'
export { default as CoinFlip } from './CoinFlip.vue'
export { default as BlackjackCard } from './BlackjackCard.vue'
export { default as BlackjackHand } from './BlackjackHand.vue'
export { default as BlackjackGame } from './BlackjackGame.vue'
export { default as DiceFace } from './DiceFace.vue'
export { default as DiceGame } from './DiceGame.vue'
export { default as PlinkoBoard } from './PlinkoBoard.vue'
export { default as PlinkoGame } from './PlinkoGame.vue'
export { default as LotteryTicket } from './LotteryTicket.vue'
export { default as LotteryDraw } from './LotteryDraw.vue'
export { default as LotteryGame } from './LotteryGame.vue'

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\LotteryDraw.vue ===
<script setup lang="ts">
/**
 * LotteryDraw â€” Animated lottery draw results display.
 *
 * Shows drawn numbers being revealed one by one with matching highlights.
 * Displays prize tier result with rarity-based visual feedback.
 * Supports second-chance animation: shows losing draw first, "Lucky!" banner, then re-draw.
 */
import { ref, computed, onMounted, watch } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import { type LotteryDrawResult, type LotteryTicketDef } from '@renderer/data/lottery'
import { rarityColor } from '@renderer/data/rarity'
import { useFormat } from '@renderer/composables/useFormat'

const props = defineProps<{
    result: LotteryDrawResult
    ticket: LotteryTicketDef
    /** Indices of drawn numbers that were forced by Rolling Luck */
    luckyIndices?: Set<number>
    /** Per-ball rolling luck chance (0â€“1); -1 = already matched */
    luckChances?: number[]
    /** Speed multiplier for draw animation (higher = faster, default 1) */
    speedMultiplier?: number
    /** Whether this draw was a second chance (lost first, re-drawn) */
    secondChance?: boolean
    /** The original losing result before second-chance re-draw */
    originalResult?: LotteryDrawResult | null
    /** Per-ball luck chances for the original (phase 1) draw */
    originalLuckChances?: number[] | null
    /** Indices forced by Rolling Luck in the original (phase 1) draw */
    originalLuckyIndices?: Set<number>
}>()

const { formatCash } = useFormat()

// â”€â”€â”€ Jackpot tier calculation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/** Determines which epic tier an animation should use based on payout multiplier */
type JackpotTier = 'none' | 'minor' | 'major' | 'grand' | 'mega' | 'cosmic'
const jackpotTier = computed<JackpotTier>(() => {
    const pm = activeResult.value.prizeTier?.payoutMultiplier ?? 0
    if (pm >= 100_000_000) return 'cosmic'
    if (pm >= 1_000_000) return 'mega'
    if (pm >= 10_000) return 'grand'
    if (pm >= 1_000) return 'major'
    if (pm >= 100) return 'minor'
    return 'none'
})

// â”€â”€â”€ Two-phase animation state (for second chance) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/** Which result is currently being displayed/animated */
const activeResult = ref<LotteryDrawResult>(props.result)
/** Whether we're in the second phase of a second-chance draw */
const inSecondPhase = ref(false)
/** Show "Lucky!" banner between phases */
const showLuckyBanner = ref(false)
/** Show "Lucky!" banner after rolling luck (final phase) */
const showRollingLuck = ref(false)

// â”€â”€â”€ Animation state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const revealedCount = ref(0)
const bonusRevealed = ref(false)
const animationDone = ref(false)

const emit = defineEmits<{ done: [] }>()

const revealDelay = computed(() => {
    const speed = props.speedMultiplier ?? 1
    return Math.max(30, Math.floor(props.ticket.drawDuration / speed / (activeResult.value.drawnNumbers.length + (props.ticket.hasBonus ? 1 : 0) + 1)))
})

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const playerSet = computed(() => new Set(activeResult.value.playerNumbers))

const rarityColorVal = computed(() =>
    activeResult.value.prizeTier ? rarityColor(activeResult.value.prizeTier.rarity) : ''
)

const isJackpot = computed(() =>
    activeResult.value.prizeTier?.rarity === 'jackpot' || activeResult.value.prizeTier?.rarity === 'legendary'
)

/** Active luck chances â€” switches between Phase 1 (original) and Phase 2 (final) */
const activeLuckChances = computed(() => {
    if (props.secondChance && !inSecondPhase.value && props.originalLuckChances) {
        return props.originalLuckChances
    }
    return props.luckChances ?? []
})

/** Active lucky indices â€” Phase 1 uses originalLuckyIndices, Phase 2 uses luckyIndices */
const activeLuckyIndices = computed(() => {
    if (props.secondChance && !inSecondPhase.value) {
        return props.originalLuckyIndices ?? new Set<number>()
    }
    return props.luckyIndices ?? new Set<number>()
})

// â”€â”€â”€ Animate reveal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animateReveal(result: LotteryDrawResult, onComplete: () => void): void {
    revealedCount.value = 0
    bonusRevealed.value = false
    animationDone.value = false
    activeResult.value = result

    const total = result.drawnNumbers.length
    let idx = 0

    const interval = setInterval(() => {
        idx++
        if (idx <= total) {
            revealedCount.value = idx
        } else if (props.ticket.hasBonus && !bonusRevealed.value) {
            bonusRevealed.value = true
        } else {
            animationDone.value = true
            clearInterval(interval)
            onComplete()
        }
    }, revealDelay.value)
}

function startReveal(): void {
    showLuckyBanner.value = false
    showRollingLuck.value = false
    inSecondPhase.value = false

    if (props.secondChance && props.originalResult) {
        // Phase 1: Animate the original losing draw
        animateReveal(props.originalResult, () => {
            setTimeout(() => {
                showLuckyBanner.value = true
                setTimeout(() => {
                    showLuckyBanner.value = false
                    inSecondPhase.value = true
                    // Phase 2: Animate the actual (winning/better) result
                    animateReveal(props.result, () => {
                        // Show rolling luck banner after Phase 2 if lucky indices exist
                        if (props.luckyIndices && props.luckyIndices.size > 0) {
                            setTimeout(() => {
                                showRollingLuck.value = true
                                setTimeout(() => {
                                    showRollingLuck.value = false
                                    emit('done')
                                }, 1500)
                            }, 300)
                        } else {
                            emit('done')
                        }
                    })
                }, 1500)
            }, 500)
        })
    } else {
        // No second chance â€” single-phase animation
        animateReveal(props.result, () => {
            // Show rolling luck banner if lucky indices exist
            if (props.luckyIndices && props.luckyIndices.size > 0) {
                setTimeout(() => {
                    showRollingLuck.value = true
                    setTimeout(() => {
                        showRollingLuck.value = false
                        emit('done')
                    }, 1500)
                }, 300)
            } else {
                emit('done')
            }
        })
    }
}

onMounted(() => startReveal())
watch(() => props.result, () => startReveal())
</script>

<template>
    <div class="lottery-draw" :class="{
        'jackpot-glow': animationDone && isJackpot && jackpotTier === 'none',
        'tier-minor': animationDone && jackpotTier === 'minor',
        'tier-major': animationDone && jackpotTier === 'major',
        'tier-grand': animationDone && jackpotTier === 'grand',
        'tier-mega': animationDone && jackpotTier === 'mega',
        'tier-cosmic': animationDone && jackpotTier === 'cosmic',
    }">
        <!-- Second-Chance "Lucky!" banner (between phases) -->
        <Transition name="lucky-pop">
            <div v-if="showLuckyBanner" class="draw-lucky-banner">
                <AppIcon icon="mdi:clover" class="draw-lucky-icon" />
                <span class="draw-lucky-text">{{ $t('gambling.lucky_trigger') }}</span>
            </div>
        </Transition>

        <!-- Rolling Luck banner (after final phase) -->
        <Transition name="lucky-pop">
            <div v-if="showRollingLuck" class="draw-lucky-banner rolling-luck">
                <AppIcon icon="mdi:clover" class="draw-lucky-icon" />
                <span class="draw-lucky-text">{{ $t('gambling.rolling_luck_trigger') }}</span>
            </div>
        </Transition>

        <!-- Drawn Numbers -->
        <div class="draw-section">
            <span class="draw-label">{{ $t('gambling.lt_drawn_numbers') }}</span>
            <div class="drawn-balls">
                <div v-for="(num, i) in activeResult.drawnNumbers" :key="i" class="drawn-ball" :class="{
                    revealed: i < revealedCount,
                    matched: i < revealedCount && playerSet.has(num),
                    unmatched: i < revealedCount && !playerSet.has(num),
                    'lucky-forced': i < revealedCount && activeLuckyIndices.has(i),
                }">
                    <span v-if="i < revealedCount">{{ num }}</span>
                    <span v-else class="ball-placeholder">?</span>
                    <AppIcon v-if="i < revealedCount && activeLuckyIndices.has(i)" icon="mdi:clover"
                        class="ball-clover" />
                    <span
                        v-if="i < revealedCount && activeLuckChances[i] !== undefined && activeLuckChances[i] >= 0 && !playerSet.has(num)"
                        class="luck-pct"
                        :class="{ 'luck-high': activeLuckChances[i] >= 0.20, 'luck-mid': activeLuckChances[i] >= 0.10 && activeLuckChances[i] < 0.20 }">
                        <AppIcon icon="mdi:clover" class="luck-pct-icon" />
                        {{ (activeLuckChances[i] * 100).toFixed(1) }}%
                    </span>
                </div>
                <!-- Bonus ball -->
                <template v-if="ticket.hasBonus">
                    <div class="bonus-separator">+</div>
                    <div class="drawn-ball bonus-drawn" :class="{
                        revealed: bonusRevealed,
                        matched: bonusRevealed && activeResult.bonusMatched,
                        unmatched: bonusRevealed && !activeResult.bonusMatched,
                    }">
                        <span v-if="bonusRevealed">{{ activeResult.bonusNumber }}</span>
                        <span v-else class="ball-placeholder">?</span>
                    </div>
                </template>
            </div>
        </div>

        <!-- Player's Numbers -->
        <div class="draw-section">
            <span class="draw-label">{{ $t('gambling.lt_your_numbers') }}</span>
            <div class="drawn-balls player-balls">
                <div v-for="num in activeResult.playerNumbers" :key="num" class="drawn-ball player-ball"
                    :class="{ matched: animationDone && activeResult.drawnNumbers.includes(num) }">
                    {{ num }}
                </div>
                <template v-if="ticket.hasBonus && activeResult.playerBonus !== null">
                    <div class="bonus-separator">+</div>
                    <div class="drawn-ball player-ball bonus-drawn"
                        :class="{ matched: animationDone && activeResult.bonusMatched }">
                        {{ activeResult.playerBonus }}
                    </div>
                </template>
            </div>
        </div>

        <!-- Result -->
        <Transition name="result-pop">
            <div v-if="animationDone" class="draw-result">
                <template v-if="activeResult.prizeTier">
                    <div class="win-result" :class="`win-${jackpotTier}`" :style="{ '--rarity-color': rarityColorVal }">
                        <!-- Particle overlays for epic+ tiers -->
                        <div v-if="jackpotTier === 'grand' || jackpotTier === 'mega' || jackpotTier === 'cosmic'"
                            class="win-particles">
                            <span v-for="p in (jackpotTier === 'cosmic' ? 24 : jackpotTier === 'mega' ? 16 : 10)"
                                :key="p" class="particle"
                                :style="{ '--i': p, '--total': jackpotTier === 'cosmic' ? 24 : jackpotTier === 'mega' ? 16 : 10 }" />
                        </div>
                        <!-- Screen flash for mega+ -->
                        <div v-if="jackpotTier === 'mega' || jackpotTier === 'cosmic'" class="screen-flash" />
                        <div class="win-label-row">
                            <AppIcon
                                :icon="jackpotTier === 'cosmic' ? 'mdi:creation' : jackpotTier === 'mega' ? 'mdi:fire' : jackpotTier === 'grand' ? 'mdi:crown' : isJackpot ? 'mdi:trophy' : 'mdi:party-popper'"
                                class="win-trophy" :class="`trophy-${jackpotTier}`" />
                            <span class="win-tier" :class="`tier-text-${jackpotTier}`">{{ activeResult.prizeTier.label
                                }}</span>
                            <span class="win-rarity-tag">{{ activeResult.prizeTier.rarity.toUpperCase() }}</span>
                        </div>
                        <div class="win-details">
                            <span class="win-matches">
                                {{ $t('gambling.lt_matched', { n: activeResult.matchedCount, total: ticket.pickCount })
                                }}
                                <template v-if="activeResult.bonusMatched"> {{ $t('gambling.lt_bonus') }}</template>
                            </span>
                            <span class="win-payout" :class="`payout-${jackpotTier}`">{{ formatCash(activeResult.payout)
                                }}</span>
                            <span class="win-multi">{{ $t('gambling.lt_payout_multi', {
                                n:
                                    activeResult.prizeTier.payoutMultiplier.toLocaleString()
                            }) }}</span>
                        </div>
                    </div>
                </template>
                <template v-else>
                    <div class="lose-result">
                        <AppIcon icon="mdi:emoticon-neutral" class="lose-icon" />
                        <span class="lose-text">
                            {{ activeResult.matchedCount > 0
                                ? $t('gambling.lt_not_enough', { n: activeResult.matchedCount })
                                : $t('gambling.lt_no_matches') }}
                        </span>
                    </div>
                </template>
            </div>
        </Transition>
    </div>
</template>

<style scoped>
.lottery-draw {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
    padding: var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    transition: box-shadow 0.5s ease;
}

.jackpot-glow {
    box-shadow: 0 0 30px color-mix(in srgb, var(--t-warning) 30%, transparent), 0 0 60px color-mix(in srgb, var(--t-warning) 10%, transparent);
}

/* â”€â”€ Tiered jackpot container glows â”€â”€ */
.tier-minor {
    animation: tierMinorGlow 2s ease infinite alternate;
    border-color: color-mix(in srgb, var(--t-purple) 40%, transparent);
}

.tier-major {
    animation: tierMajorGlow 1.5s ease infinite alternate;
    border-color: color-mix(in srgb, var(--t-warning) 50%, transparent);
}

.tier-grand {
    animation: tierGrandGlow 1.2s ease infinite alternate;
    border-color: color-mix(in srgb, var(--t-danger) 50%, transparent);
}

.tier-mega {
    animation: tierMegaGlow 1s ease infinite alternate;
    border-color: transparent;
    border-image: linear-gradient(135deg, var(--t-danger), var(--t-warning), var(--t-purple), var(--t-blue)) 1;
}

.tier-cosmic {
    animation: tierCosmicGlow 0.8s ease infinite alternate;
    border-color: transparent;
    border-image: linear-gradient(135deg, var(--t-pink), var(--t-purple), var(--t-cyan), var(--t-success), var(--t-warning), var(--t-danger)) 1;
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-pink) 3%, transparent), color-mix(in srgb, var(--t-purple) 3%, transparent), color-mix(in srgb, var(--t-cyan) 3%, transparent));
}

@keyframes tierMinorGlow {
    from {
        box-shadow: 0 0 15px color-mix(in srgb, var(--t-purple) 20%, transparent);
    }

    to {
        box-shadow: 0 0 30px color-mix(in srgb, var(--t-purple) 40%, transparent);
    }
}

@keyframes tierMajorGlow {
    from {
        box-shadow: 0 0 20px color-mix(in srgb, var(--t-warning) 30%, transparent);
    }

    to {
        box-shadow: 0 0 50px color-mix(in srgb, var(--t-warning) 50%, transparent);
    }
}

@keyframes tierGrandGlow {
    from {
        box-shadow: 0 0 25px color-mix(in srgb, var(--t-danger) 30%, transparent), 0 0 50px color-mix(in srgb, var(--t-danger) 10%, transparent);
    }

    to {
        box-shadow: 0 0 50px color-mix(in srgb, var(--t-danger) 50%, transparent), 0 0 80px color-mix(in srgb, var(--t-danger) 20%, transparent);
    }
}

@keyframes tierMegaGlow {
    from {
        box-shadow: 0 0 30px color-mix(in srgb, var(--t-danger) 40%, transparent), 0 0 60px color-mix(in srgb, var(--t-warning) 20%, transparent), 0 0 90px color-mix(in srgb, var(--t-purple) 10%, transparent);
    }

    to {
        box-shadow: 0 0 60px color-mix(in srgb, var(--t-danger) 60%, transparent), 0 0 100px color-mix(in srgb, var(--t-warning) 40%, transparent), 0 0 140px color-mix(in srgb, var(--t-purple) 20%, transparent);
    }
}

@keyframes tierCosmicGlow {
    from {
        box-shadow: 0 0 40px color-mix(in srgb, var(--t-pink) 50%, transparent), 0 0 80px color-mix(in srgb, var(--t-purple) 30%, transparent), 0 0 120px color-mix(in srgb, var(--t-cyan) 20%, transparent);
    }

    to {
        box-shadow: 0 0 80px color-mix(in srgb, var(--t-pink) 70%, transparent), 0 0 140px color-mix(in srgb, var(--t-purple) 50%, transparent), 0 0 200px color-mix(in srgb, var(--t-cyan) 30%, transparent);
    }
}

/* â”€â”€ Sections â”€â”€ */
.draw-section {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    align-items: center;
}

.draw-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
    color: var(--t-text-muted);
}

/* â”€â”€ Balls â”€â”€ */
.drawn-balls {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    padding-bottom: 20px;
    /* room for luck % labels */
}

.drawn-ball {
    position: relative;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.95rem;
    font-weight: 800;
    font-family: var(--t-font-mono);
    background: var(--t-bg-muted);
    border: 2px solid var(--t-border);
    color: var(--t-text-muted);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.drawn-ball.revealed {
    transform: scale(1);
    animation: ballReveal 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.drawn-ball.matched {
    background: var(--t-success);
    border-color: var(--t-success);
    color: var(--t-text);
    box-shadow: 0 0 12px var(--t-success-muted);
}

.drawn-ball.lucky-forced {
    position: relative;
    animation: luckyBallPulse 1s ease infinite alternate;
}

.ball-clover {
    position: absolute;
    top: -6px;
    right: -6px;
    font-size: 0.7rem;
    color: var(--t-success);
    filter: drop-shadow(0 0 3px color-mix(in srgb, var(--t-success) 60%, transparent));
    animation: cloverPop 0.5s ease;
}

@keyframes luckyBallPulse {
    from {
        box-shadow: 0 0 8px color-mix(in srgb, var(--t-success) 30%, transparent);
    }

    to {
        box-shadow: 0 0 18px color-mix(in srgb, var(--t-success) 60%, transparent);
    }
}

@keyframes cloverPop {
    0% {
        transform: scale(0);
    }

    60% {
        transform: scale(1.4);
    }

    100% {
        transform: scale(1);
    }
}

.drawn-ball.unmatched {
    background: var(--t-bg-muted);
    border-color: var(--t-border);
    color: var(--t-text-secondary);
}

.player-ball {
    width: 38px;
    height: 38px;
    font-size: 0.85rem;
    border: 2px solid var(--t-border);
    opacity: 0.7;
}

.player-ball.matched {
    opacity: 1;
    background: color-mix(in srgb, var(--t-success) 15%, transparent);
    border-color: var(--t-success);
    color: var(--t-success);
}

.bonus-drawn {
    border-color: var(--t-warning);
}

.bonus-drawn.matched {
    background: var(--t-warning);
    border-color: var(--t-warning);
    color: var(--t-text);
    box-shadow: 0 0 12px color-mix(in srgb, var(--t-warning) 40%, transparent);
}

.bonus-separator {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--t-text-muted);
}

.ball-placeholder {
    color: var(--t-text-muted);
    font-size: 1.1rem;
}

/* â”€â”€ Luck percentage badge â”€â”€ */
.luck-pct {
    position: absolute;
    bottom: -18px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 2px;
    font-size: 0.55rem;
    font-weight: 700;
    font-family: var(--t-font-mono);
    color: var(--t-text-muted);
    white-space: nowrap;
    opacity: 0.7;
    animation: luckPctFade 0.4s ease;
}

.luck-pct.luck-mid {
    color: var(--t-success);
    opacity: 0.85;
}

.luck-pct.luck-high {
    color: var(--t-success);
    opacity: 1;
    text-shadow: 0 0 4px color-mix(in srgb, var(--t-success) 40%, transparent);
}

.luck-pct-icon {
    font-size: 0.5rem;
}

@keyframes luckPctFade {
    0% {
        opacity: 0;
        transform: translateX(-50%) translateY(4px);
    }

    100% {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

@keyframes ballReveal {
    0% {
        transform: scale(0.3) rotate(-180deg);
        opacity: 0;
    }

    100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }
}

/* â”€â”€ Result displays â”€â”€ */
.draw-result {
    margin-top: var(--t-space-2);
}

.win-result {
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    padding: var(--t-space-4);
    background: color-mix(in srgb, var(--rarity-color) 8%, transparent);
    border: 1px solid color-mix(in srgb, var(--rarity-color) 50%, transparent);
    border-radius: var(--t-radius-lg);
    text-align: center;
    animation: resultPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* â”€â”€ Tiered win panel animations â”€â”€ */
.win-minor {
    animation: resultPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), winPulseSoft 2s ease 0.5s infinite alternate;
}

.win-major {
    animation: resultShake 0.6s cubic-bezier(0.36, 0.07, 0.19, 0.97), winPulseMedium 1.5s ease 0.6s infinite alternate;
}

.win-grand {
    animation: resultEpicEntry 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), winPulseStrong 1.2s ease 0.8s infinite alternate;
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-danger) 12%, transparent), color-mix(in srgb, var(--t-warning) 8%, transparent));
}

.win-mega {
    animation: resultEpicEntry 1s cubic-bezier(0.34, 1.56, 0.64, 1), winRainbow 3s linear 1s infinite;
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-danger) 15%, transparent), color-mix(in srgb, var(--t-warning) 10%, transparent), color-mix(in srgb, var(--t-purple) 8%, transparent));
}

.win-cosmic {
    animation: resultCosmicEntry 1.2s cubic-bezier(0.34, 1.56, 0.64, 1), winCosmicPulse 2s ease 1.2s infinite alternate;
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-pink) 15%, transparent), color-mix(in srgb, var(--t-purple) 12%, transparent), color-mix(in srgb, var(--t-cyan) 8%, transparent));
}

@keyframes winPulseSoft {
    from {
        box-shadow: inset 0 0 20px color-mix(in srgb, var(--t-purple) 5%, transparent);
    }

    to {
        box-shadow: inset 0 0 40px color-mix(in srgb, var(--t-purple) 12%, transparent);
    }
}

@keyframes winPulseMedium {
    from {
        box-shadow: inset 0 0 20px color-mix(in srgb, var(--t-warning) 8%, transparent);
    }

    to {
        box-shadow: inset 0 0 50px color-mix(in srgb, var(--t-warning) 18%, transparent);
    }
}

@keyframes winPulseStrong {
    from {
        box-shadow: inset 0 0 30px color-mix(in srgb, var(--t-danger) 10%, transparent);
    }

    to {
        box-shadow: inset 0 0 60px color-mix(in srgb, var(--t-danger) 25%, transparent);
    }
}

@keyframes winRainbow {
    0% {
        filter: hue-rotate(0deg);
    }

    100% {
        filter: hue-rotate(360deg);
    }
}

@keyframes winCosmicPulse {
    from {
        box-shadow: inset 0 0 40px color-mix(in srgb, var(--t-pink) 15%, transparent), inset 0 0 80px color-mix(in srgb, var(--t-purple) 8%, transparent);
    }

    to {
        box-shadow: inset 0 0 80px color-mix(in srgb, var(--t-pink) 30%, transparent), inset 0 0 120px color-mix(in srgb, var(--t-cyan) 15%, transparent);
    }
}

@keyframes resultShake {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }

    40% {
        transform: scale(1.08);
        opacity: 1;
    }

    50% {
        transform: scale(1.08) rotate(1deg);
    }

    60% {
        transform: scale(1.05) rotate(-1deg);
    }

    70% {
        transform: scale(1.03) rotate(0.5deg);
    }

    80% {
        transform: scale(1.01) rotate(-0.5deg);
    }

    100% {
        transform: scale(1) rotate(0);
    }
}

@keyframes resultEpicEntry {
    0% {
        transform: scale(0) rotate(-10deg);
        opacity: 0;
    }

    30% {
        transform: scale(1.15) rotate(2deg);
        opacity: 1;
    }

    50% {
        transform: scale(0.95) rotate(-1deg);
    }

    70% {
        transform: scale(1.05) rotate(0.5deg);
    }

    100% {
        transform: scale(1) rotate(0);
    }
}

@keyframes resultCosmicEntry {
    0% {
        transform: scale(0) rotate(-20deg);
        opacity: 0;
        filter: brightness(3);
    }

    20% {
        transform: scale(1.3) rotate(5deg);
        opacity: 1;
        filter: brightness(2);
    }

    40% {
        transform: scale(0.9) rotate(-3deg);
        filter: brightness(1.5);
    }

    60% {
        transform: scale(1.1) rotate(1deg);
        filter: brightness(1.2);
    }

    80% {
        transform: scale(0.98) rotate(-0.5deg);
        filter: brightness(1.1);
    }

    100% {
        transform: scale(1) rotate(0);
        filter: brightness(1);
    }
}

/* â”€â”€ Particle burst â”€â”€ */
.win-particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
}

.particle {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    background: var(--rarity-color);
    animation: particleBurst 2s ease-out forwards;
    animation-delay: calc(var(--i) * 0.05s);
    --angle: calc(var(--i) * (360 / var(--total)) * 1deg);
    --dist: calc(60px + var(--i) * 8px);
}

@keyframes particleBurst {
    0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 1;
    }

    30% {
        transform: translate(calc(-50% + cos(var(--angle)) * var(--dist)),
                calc(-50% + sin(var(--angle)) * var(--dist))) scale(1.5);
        opacity: 1;
    }

    100% {
        transform: translate(calc(-50% + cos(var(--angle)) * var(--dist) * 2),
                calc(-50% + sin(var(--angle)) * var(--dist) * 2)) scale(0);
        opacity: 0;
    }
}

/* â”€â”€ Screen flash â”€â”€ */
.screen-flash {
    position: absolute;
    inset: 0;
    background: white;
    opacity: 0;
    pointer-events: none;
    animation: flashBang 0.6s ease-out forwards;
    border-radius: inherit;
}

@keyframes flashBang {
    0% {
        opacity: 0.8;
    }

    100% {
        opacity: 0;
    }
}

/* â”€â”€ Trophy icon tiers â”€â”€ */
.trophy-minor {
    animation: trophySpin 0.6s ease;
}

.trophy-major {
    animation: trophySpin 0.8s ease;
    font-size: 2.2rem !important;
}

.trophy-grand {
    animation: trophyGrandEntry 1s ease;
    font-size: 2.5rem !important;
    filter: drop-shadow(0 0 8px color-mix(in srgb, var(--t-danger) 50%, transparent));
}

.trophy-mega {
    animation: trophyGrandEntry 1.2s ease;
    font-size: 2.8rem !important;
    filter: drop-shadow(0 0 12px color-mix(in srgb, var(--t-danger) 60%, transparent));
}

.trophy-cosmic {
    animation: trophyCosmicEntry 1.5s ease;
    font-size: 3.2rem !important;
    filter: drop-shadow(0 0 16px color-mix(in srgb, var(--t-pink) 70%, transparent));
}

@keyframes trophySpin {
    0% {
        transform: scale(0) rotate(-360deg);
    }

    60% {
        transform: scale(1.3) rotate(20deg);
    }

    100% {
        transform: scale(1) rotate(0);
    }
}

@keyframes trophyGrandEntry {
    0% {
        transform: scale(0) rotate(-360deg);
        filter: brightness(3);
    }

    40% {
        transform: scale(1.5) rotate(10deg);
        filter: brightness(2);
    }

    70% {
        transform: scale(0.9) rotate(-5deg);
        filter: brightness(1.2);
    }

    100% {
        transform: scale(1) rotate(0);
        filter: brightness(1);
    }
}

@keyframes trophyCosmicEntry {
    0% {
        transform: scale(0) rotate(-720deg);
        opacity: 0;
        filter: brightness(5);
    }

    30% {
        transform: scale(2) rotate(30deg);
        opacity: 1;
        filter: brightness(3);
    }

    50% {
        transform: scale(0.8) rotate(-15deg);
        filter: brightness(1.5);
    }

    70% {
        transform: scale(1.2) rotate(5deg);
        filter: brightness(1.2);
    }

    100% {
        transform: scale(1) rotate(0);
        filter: brightness(1);
    }
}

/* â”€â”€ Tier text effects â”€â”€ */
.tier-text-grand {
    text-shadow: 0 0 10px color-mix(in srgb, var(--t-danger) 50%, transparent);
}

.tier-text-mega {
    text-shadow: 0 0 15px color-mix(in srgb, var(--t-danger) 60%, transparent), 0 0 30px color-mix(in srgb, var(--t-warning) 30%, transparent);
    animation: textPulse 1s ease infinite alternate;
}

.tier-text-cosmic {
    text-shadow: 0 0 20px color-mix(in srgb, var(--t-pink) 70%, transparent), 0 0 40px color-mix(in srgb, var(--t-purple) 40%, transparent);
    animation: textRainbow 3s linear infinite;
}

@keyframes textPulse {
    from {
        opacity: 0.9;
        transform: scale(1);
    }

    to {
        opacity: 1;
        transform: scale(1.05);
    }
}

@keyframes textRainbow {
    0% {
        filter: hue-rotate(0deg);
    }

    100% {
        filter: hue-rotate(360deg);
    }
}

/* â”€â”€ Payout amount tiers â”€â”€ */
.payout-minor {
    font-size: 2rem;
}

.payout-major {
    font-size: 2.2rem;
    animation: payoutBounce 0.8s ease;
}

.payout-grand {
    font-size: 2.5rem;
    animation: payoutBounce 1s ease;
    text-shadow: 0 0 10px var(--rarity-color);
}

.payout-mega {
    font-size: 2.8rem;
    animation: payoutCountUp 1.5s ease;
    text-shadow: 0 0 15px var(--rarity-color);
}

.payout-cosmic {
    font-size: 3.2rem;
    animation: payoutCountUp 2s ease, payoutGlow 2s ease 2s infinite alternate;
    text-shadow: 0 0 20px color-mix(in srgb, var(--t-pink) 70%, transparent);
}

@keyframes payoutBounce {
    0% {
        transform: scale(0.5);
        opacity: 0;
    }

    50% {
        transform: scale(1.2);
        opacity: 1;
    }

    75% {
        transform: scale(0.95);
    }

    100% {
        transform: scale(1);
    }
}

@keyframes payoutCountUp {
    0% {
        transform: scale(0.3) translateY(20px);
        opacity: 0;
        filter: blur(4px);
    }

    40% {
        transform: scale(1.3) translateY(-5px);
        opacity: 1;
        filter: blur(0);
    }

    60% {
        transform: scale(0.95) translateY(2px);
    }

    80% {
        transform: scale(1.05) translateY(-1px);
    }

    100% {
        transform: scale(1) translateY(0);
    }
}

@keyframes payoutGlow {
    from {
        text-shadow: 0 0 15px color-mix(in srgb, var(--t-pink) 50%, transparent);
    }

    to {
        text-shadow: 0 0 30px color-mix(in srgb, var(--t-pink) 90%, transparent), 0 0 60px color-mix(in srgb, var(--t-purple) 40%, transparent);
    }
}

.win-label-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
}

.win-trophy {
    font-size: 1.8rem;
    color: var(--rarity-color);
}

.win-tier {
    font-size: 1.3rem;
    font-weight: 800;
    color: var(--rarity-color);
}

.win-rarity-tag {
    font-size: 0.6rem;
    font-weight: 800;
    letter-spacing: 0.1em;
    padding: 2px 8px;
    border-radius: var(--t-radius-sm);
    background: color-mix(in srgb, var(--rarity-color) 15%, transparent);
    color: var(--rarity-color);
}

.win-details {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.win-matches {
    font-size: var(--t-font-size-sm);
    color: var(--t-text-secondary);
}

.win-payout {
    font-size: 1.8rem;
    font-weight: 900;
    font-family: var(--t-font-mono);
    color: var(--rarity-color, var(--t-success));
    transition: font-size 0.3s ease;
}

.win-multi {
    font-size: 0.75rem;
    color: var(--t-text-muted);
}

.lose-result {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    animation: resultPop 0.3s ease;
}

.lose-icon {
    font-size: 1.4rem;
    color: var(--t-text-muted);
}

.lose-text {
    font-size: var(--t-font-size-sm);
    color: var(--t-text-muted);
}

@keyframes resultPop {
    0% {
        transform: scale(0.9);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* â”€â”€ Transition â”€â”€ */
.result-pop-enter-active {
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.result-pop-leave-active {
    transition: all 0.2s ease;
}

.result-pop-enter-from {
    opacity: 0;
    transform: scale(0.8);
}

.result-pop-leave-to {
    opacity: 0;
    transform: scale(0.9);
}

/* â”€â”€ "Lucky!" banner inside draw â”€â”€ */
.draw-lucky-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-2) var(--t-space-4);
    border-radius: var(--t-radius-lg);
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-success) 15%, transparent), color-mix(in srgb, var(--t-success) 5%, transparent));
    border: 1px solid color-mix(in srgb, var(--t-success) 40%, transparent);
    box-shadow: 0 0 20px color-mix(in srgb, var(--t-success) 25%, transparent);
    animation: drawLuckyPulse 0.8s ease infinite alternate;
}

.draw-lucky-icon {
    font-size: 1.4rem;
    color: var(--t-success);
    animation: drawCloverSpin 0.8s ease;
    filter: drop-shadow(0 0 4px color-mix(in srgb, var(--t-success) 50%, transparent));
}

.draw-lucky-text {
    font-size: 1rem;
    font-weight: 800;
    color: var(--t-success);
    letter-spacing: 0.05em;
    text-shadow: 0 0 6px color-mix(in srgb, var(--t-success) 30%, transparent);
}

@keyframes drawLuckyPulse {
    from {
        box-shadow: 0 0 12px color-mix(in srgb, var(--t-success) 20%, transparent);
    }

    to {
        box-shadow: 0 0 28px color-mix(in srgb, var(--t-success) 40%, transparent);
    }
}

@keyframes drawCloverSpin {
    0% {
        transform: scale(0) rotate(-180deg);
    }

    60% {
        transform: scale(1.3) rotate(20deg);
    }

    100% {
        transform: scale(1) rotate(0);
    }
}

.lucky-pop-enter-active {
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.lucky-pop-leave-active {
    transition: all 0.3s ease;
}

.lucky-pop-enter-from {
    opacity: 0;
    transform: scale(0.5);
}

.lucky-pop-leave-to {
    opacity: 0;
    transform: scale(0.8);
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\LotteryGame.vue ===
<script setup lang="ts">
/**
 * LotteryGame â€” Full lottery mini-game view within the Casino.
 *
 * Features:
 * - Multiple ticket types with different odds/prizes
 * - Interactive number picking with quick-pick option
 * - Animated number draw with match highlighting
 * - Prize tiers with rarity system
 * - Full integration with gambling store, player store,
 *   XP rewards, and skill tree gambling_luck (affects second chance)
 * - Draw history tracking within the session
 */
import { ref, computed } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import LotteryTicket from './LotteryTicket.vue'
import LotteryDraw from './LotteryDraw.vue'
import { usePlayerStore } from '@renderer/stores/usePlayerStore'
import { useGamblingStore } from '@renderer/stores/useGamblingStore'
import { useAchievementStore } from '@renderer/stores/useAchievementStore'
import { useSettingsStore } from '@renderer/stores/useSettingsStore'
import { useFormat } from '@renderer/composables/useFormat'
import { D, ZERO } from '@renderer/core/BigNum'
import { gameEngine } from '@renderer/core/GameEngine'
import {
    LOTTERY_TICKETS,
    DIVINE_ABILITIES,
    executeDraw,
    countMatches,
    determinePrize,
    getDivineAbility,
    type LotteryTicketDef,
    type LotteryDrawResult,
    type DivineAbilityDef,
} from '@renderer/data/lottery'
import { rarityCssVar } from '@renderer/data/rarity'

const emit = defineEmits<{ back: [] }>()

const player = usePlayerStore()
const gambling = useGamblingStore()
const achievements = useAchievementStore()
const settings = useSettingsStore()
const { formatCash, formatNumber } = useFormat()

// â”€â”€â”€ Draw speed & multi-draw options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SPEED_OPTIONS = [0.5, 1, 2, 3, 5] as const
const MULTI_DRAW_OPTIONS = [1, 3, 5, 10] as const

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const selectedTicketId = ref<string>(LOTTERY_TICKETS[0].id)
const isDrawing = ref(false)
const currentResult = ref<LotteryDrawResult | null>(null)
/** Luck triggered â€” shows clover animation when second chance or rolling luck activates */
const luckyTriggered = ref(false)
/** Indices of drawn balls forced by Rolling Luck â€” passed to LotteryDraw for glow */
const currentLuckyIndices = ref<Set<number>>(new Set())
/** Per-ball rolling luck chance (%) shown during the draw animation */
const currentLuckChances = ref<number[]>([])
/** Whether the current single draw was a second chance */
const currentSecondChance = ref(false)
/** Original losing result before second-chance re-draw */
const currentOriginalResult = ref<LotteryDrawResult | null>(null)
/** Luck chances for the original (phase 1) draw */
const currentOriginalLuckChances = ref<number[] | null>(null)
/** Indices forced by Rolling Luck in the original (phase 1) draw */
const currentOriginalLuckyIndices = ref<Set<number>>(new Set())

/** Session draw history (most recent first) */
const drawHistory = ref<Array<{
    ticketName: string
    result: LotteryDrawResult
    timestamp: number
}>>([])

const showPrizeTable = ref(false)

/** Toggle for divine abilities gallery */
const showDivineGallery = ref(false)

/** Per-draw data for multi-draw (result + luck visuals + second chance) */
interface MultiDrawEntry {
    result: LotteryDrawResult
    luckyIndices: Set<number>
    luckChances: number[]
    originalLuckyIndices: Set<number>
    originalLuckChances: number[] | null
    secondChance: boolean
    originalResult: LotteryDrawResult | null
}
/** Multi-draw results (when drawing > 1 at a time) */
const multiDrawResults = ref<MultiDrawEntry[]>([])
/** How many draws in the multi-draw have finished their animation */
const multiDrawFinished = ref(0)
/** Summary of multi-draw batch */
const multiDrawSummary = ref<{ total: number; wins: number; totalPayout: number; totalCost: number; abilities: DivineAbilityDef[] } | null>(null)

/** Recently unlocked divine ability (for UI banner) */
const newlyUnlockedAbility = ref<DivineAbilityDef | null>(null)

/** Mapping: ticketId â†’ achievement ID to unlock on jackpot win */
const LOTTERY_ACHIEVEMENT_MAP: Record<string, string> = {
    quick_pick: 'lot_quick_pick',
    classic: 'lot_classic',
    mega: 'lot_mega',
    instant: 'lot_instant',
    ultra: 'lot_ultra',
    cosmic: 'lot_cosmic',
    divine: 'lot_divine',
}

/** All lottery ticket IDs that need a jackpot for the master achievement */
const ALL_LOTTERY_IDS = ['quick_pick', 'classic', 'mega', 'instant', 'ultra', 'cosmic', 'divine']

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const selectedTicket = computed<LotteryTicketDef>(() =>
    LOTTERY_TICKETS.find((t) => t.id === selectedTicketId.value) ?? LOTTERY_TICKETS[0]
)

const canAfford = computed(() =>
    player.cash.gte(D(selectedTicket.value.ticketCost))
)

/** Can afford N tickets for multi-draw */
const canAffordMulti = computed(() =>
    player.cash.gte(D(selectedTicket.value.ticketCost * settings.lotteryMultiDraw))
)

const drawSpeed = computed(() => settings.lotteryDrawSpeed)

const stats = computed(() => gambling.getStats('lottery'))

// Luck affects match probability in lottery via bonus matches
const luckMultiplier = computed(() => gambling.getLuckMultiplier())
const luckBonus = computed(() => gambling.getLuckBonus())

const sessionWins = computed(() => drawHistory.value.filter((h) => h.result.prizeTier !== null).length)
const sessionTotal = computed(() => drawHistory.value.length)
const sessionProfit = computed(() => {
    let total = ZERO
    for (const h of drawHistory.value) {
        const ticket = LOTTERY_TICKETS.find((t) => t.name === h.ticketName)
        const cost = D(ticket?.ticketCost ?? 0)
        const payout = D(h.result.payout)
        total = total.add(payout).sub(cost)
    }
    return total
})

// â”€â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const sleep = (ms: number) => new Promise<void>((r) => setTimeout(r, ms))

// â”€â”€â”€ Luck constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LUCK_CAP_BY_PICKS: Record<number, number> = { 3: 0.12, 4: 0.18, 5: 0.24, 6: 0.30, 8: 0.35, 10: 0.40 }
const LUCK_DECAY = 0.55

/**
 * Execute a single draw with luck mechanics and record results.
 * Returns the finalized result and any newly unlocked ability.
 */
function executeSingleDrawWithLuck(
    ticket: LotteryTicketDef,
    numbers: number[],
    bonus: number | null,
): { result: LotteryDrawResult; ability: DivineAbilityDef | null; luckyIndices: Set<number>; luckChances: number[]; originalLuckyIndices: Set<number>; originalLuckChances: number[] | null; secondChance: boolean; originalResult: LotteryDrawResult | null } {
    const rawBonus = luckBonus.value

    function computeLuckChances(drawnNums: number[]): number[] {
        const cap = LUCK_CAP_BY_PICKS[ticket.pickCount] ?? 0.22
        const bl = rawBonus > 0 ? cap * Math.sqrt(rawBonus) : 0
        const chances: number[] = []
        let unmatchedIdx = 0
        for (let i = 0; i < drawnNums.length; i++) {
            if (numbers.includes(drawnNums[i])) {
                chances.push(-1)
            } else {
                chances.push(bl * Math.pow(LUCK_DECAY, unmatchedIdx))
                unmatchedIdx++
            }
        }
        return chances
    }

    /** Apply rolling luck to a draw result independently. Returns modified draw + forced indices. */
    function applyRollingLuck(draw: ReturnType<typeof executeDraw>): { draw: ReturnType<typeof executeDraw>; luckyIdx: Set<number> } {
        const luckyIdx = new Set<number>()
        if (rawBonus <= 0 || draw.prizeTier) return { draw, luckyIdx }
        const cap = LUCK_CAP_BY_PICKS[ticket.pickCount] ?? 0.22
        const baseLuck = cap * Math.sqrt(rawBonus)
        const drawnArr = [...draw.drawnNumbers]
        const unmatchedPlayer = numbers.filter((n) => !new Set(drawnArr).has(n))
        let forcedCount = 0
        const forcedValues = new Set<number>()
        for (let i = 0; i < drawnArr.length && unmatchedPlayer.length > 0; i++) {
            if (!numbers.includes(drawnArr[i])) {
                const chance = baseLuck * Math.pow(LUCK_DECAY, forcedCount)
                if (Math.random() < chance) {
                    const forced = unmatchedPlayer.shift()!
                    drawnArr[i] = forced
                    forcedValues.add(forced)
                    forcedCount++
                }
            }
        }
        if (forcedCount > 0) {
            drawnArr.sort((a, b) => a - b)
            drawnArr.forEach((n, i) => { if (forcedValues.has(n)) luckyIdx.add(i) })
            const newMatchCount = countMatches(numbers, drawnArr)
            const newPrize = determinePrize(newMatchCount, draw.bonusMatched, ticket.prizes)
            return { draw: { ...draw, drawnNumbers: drawnArr, matchedCount: newMatchCount, prizeTier: newPrize }, luckyIdx }
        }
        return { draw, luckyIdx }
    }

    let drawResult = executeDraw(ticket, numbers, bonus)
    let secondChance = false
    let originalDrawResult: ReturnType<typeof executeDraw> | null = null
    let luckyIdx = new Set<number>()
    let originalLuckyIdx = new Set<number>()

    // Apply rolling luck to Phase 1
    const phase1 = applyRollingLuck(drawResult)
    drawResult = phase1.draw
    luckyIdx = phase1.luckyIdx

    // Second chance (only if Phase 1 still lost after rolling luck)
    if (!drawResult.prizeTier && luckBonus.value > 0 && Math.random() < luckBonus.value) {
        originalDrawResult = drawResult
        originalLuckyIdx = luckyIdx
        drawResult = executeDraw(ticket, numbers, bonus)
        secondChance = true
        // Apply rolling luck to Phase 2 independently
        const phase2 = applyRollingLuck(drawResult)
        drawResult = phase2.draw
        luckyIdx = phase2.luckyIdx
    }

    // Calculate payout
    let payout = 0
    if (drawResult.prizeTier) payout = ticket.ticketCost * drawResult.prizeTier.payoutMultiplier
    const fullResult: LotteryDrawResult = { ...drawResult, payout }

    // Record in stores
    const cost = D(ticket.ticketCost)
    let unlockedAbility: DivineAbilityDef | null = null

    if (fullResult.prizeTier) {
        player.earnCash(D(payout))
        gambling.recordWin('lottery', cost, D(payout))
        gambling.recordLotteryWin(ticket.id, fullResult.prizeTier.label)

        const isJackpot = fullResult.prizeTier.rarity === 'jackpot' || fullResult.prizeTier.rarity === 'mythic'
        if (isJackpot) {
            const achId = LOTTERY_ACHIEVEMENT_MAP[ticket.id]
            if (achId) achievements.unlock(achId, gameEngine.currentTick)
            if (ticket.id === 'divine' && fullResult.prizeTier.label === 'DIVINE JACKPOT') {
                achievements.unlock('lot_divine_jackpot', gameEngine.currentTick)
            }
        }

        if (fullResult.prizeTier.grantsAbility) {
            const abilityId = fullResult.prizeTier.grantsAbility
            const wasNew = gambling.unlockDivineAbility(abilityId)
            if (wasNew) {
                unlockedAbility = getDivineAbility(abilityId) ?? null
                if (ticket.id === 'divine') achievements.unlock('lot_divine', gameEngine.currentTick)
            }
        }

        const allHaveJackpots = ALL_LOTTERY_IDS.every(tid => {
            const ticketDef = LOTTERY_TICKETS.find(t => t.id === tid)
            if (!ticketDef) return false
            const topPrize = ticketDef.prizes[ticketDef.prizes.length - 1]
            return gambling.hasLotteryWin(tid, topPrize.label)
        })
        if (allHaveJackpots) achievements.unlock('lot_master', gameEngine.currentTick)
    } else {
        gambling.recordLoss('lottery', cost)
    }

    // Add to history
    drawHistory.value.unshift({ ticketName: ticket.name, result: fullResult, timestamp: Date.now() })
    if (drawHistory.value.length > 50) drawHistory.value.pop()

    // Build original result for second-chance visual (the losing draw shown first)
    const originalResult: LotteryDrawResult | null = originalDrawResult
        ? { ...originalDrawResult, payout: 0 }
        : null

    return {
        result: fullResult,
        ability: unlockedAbility,
        luckyIndices: luckyIdx,
        luckChances: computeLuckChances(fullResult.drawnNumbers),
        originalLuckyIndices: originalLuckyIdx,
        originalLuckChances: originalDrawResult ? computeLuckChances(originalDrawResult.drawnNumbers) : null,
        secondChance,
        originalResult,
    }
}

/** Generate random numbers for a quick pick */
function generateQuickPick(ticket: LotteryTicketDef): { numbers: number[]; bonus: number | null } {
    const nums = new Set<number>()
    while (nums.size < ticket.pickCount) {
        nums.add(Math.floor(Math.random() * ticket.maxNumber) + 1)
    }
    const bonus = ticket.hasBonus ? Math.floor(Math.random() * ticket.bonusMax) + 1 : null
    return { numbers: Array.from(nums).sort((a, b) => a - b), bonus }
}

/** Single draw with full animation (when multiDraw = 1) */
async function handlePlay(numbers: number[], bonus: number | null): Promise<void> {
    const ticket = selectedTicket.value
    const drawCount = settings.lotteryMultiDraw
    const totalCost = D(ticket.ticketCost * drawCount)

    if (!player.spendCash(totalCost)) return

    isDrawing.value = true
    currentResult.value = null
    multiDrawResults.value = []
    multiDrawSummary.value = null
    luckyTriggered.value = false
    currentLuckyIndices.value = new Set()
    currentLuckChances.value = []
    newlyUnlockedAbility.value = null

    if (drawCount <= 1) {
        // â”€â”€â”€ Single draw â€” LotteryDraw handles all animation phases â”€â”€â”€â”€â”€
        await sleep(200)

        const { result, ability, luckyIndices, luckChances, originalLuckyIndices, originalLuckChances, secondChance, originalResult } =
            executeSingleDrawWithLuck(ticket, numbers, bonus)

        currentLuckChances.value = luckChances
        currentLuckyIndices.value = luckyIndices
        currentOriginalLuckyIndices.value = originalLuckyIndices
        currentSecondChance.value = secondChance
        currentOriginalResult.value = originalResult
        currentOriginalLuckChances.value = originalLuckChances
        currentResult.value = result
        newlyUnlockedAbility.value = ability

        // isDrawing stays true until LotteryDraw emits 'done' (via onSingleDrawDone)
    } else {
        // â”€â”€â”€ Multi-draw: execute all draws up-front, animate via LotteryDraw grid â”€â”€
        await sleep(100)

        const entries: MultiDrawEntry[] = []
        let wins = 0
        let totalPayout = 0
        const abilities: DivineAbilityDef[] = []

        for (let i = 0; i < drawCount; i++) {
            const nums = i === 0 ? numbers : generateQuickPick(ticket).numbers
            const bn = i === 0 ? bonus : generateQuickPick(ticket).bonus

            const { result, ability, luckyIndices, luckChances, originalLuckyIndices, originalLuckChances, secondChance, originalResult } = executeSingleDrawWithLuck(ticket, nums, bn)
            entries.push({ result, luckyIndices, luckChances, originalLuckyIndices, originalLuckChances, secondChance, originalResult })
            if (result.prizeTier) {
                wins++
                totalPayout += result.payout
            }
            if (ability) abilities.push(ability)
        }

        multiDrawResults.value = entries
        multiDrawFinished.value = 0
        multiDrawSummary.value = {
            total: drawCount,
            wins,
            totalPayout,
            totalCost: ticket.ticketCost * drawCount,
            abilities,
        }

        if (abilities.length > 0) {
            newlyUnlockedAbility.value = abilities[0]
        }

        // isDrawing stays true until all animations finish (handled in onMultiDrawDone)
    }
}

/** Called by each LotteryDraw in the multi-draw grid when its animation finishes */
function onMultiDrawDone(): void {
    multiDrawFinished.value++
    if (multiDrawFinished.value >= multiDrawResults.value.length) {
        isDrawing.value = false
    }
}

/** Called by the single-draw LotteryDraw when its full animation completes */
function onSingleDrawDone(): void {
    isDrawing.value = false
}

function clearResult(): void {
    currentResult.value = null
    multiDrawResults.value = []
    multiDrawFinished.value = 0
    multiDrawSummary.value = null
    newlyUnlockedAbility.value = null
    currentSecondChance.value = false
    currentOriginalResult.value = null
    currentOriginalLuckChances.value = null
    currentOriginalLuckyIndices.value = new Set()
}

function selectTicket(id: string): void {
    if (isDrawing.value) return
    selectedTicketId.value = id
    currentResult.value = null
    multiDrawResults.value = []
    multiDrawFinished.value = 0
    multiDrawSummary.value = null
    currentSecondChance.value = false
    currentOriginalResult.value = null
    currentOriginalLuckChances.value = null
    currentOriginalLuckyIndices.value = new Set()
}

// â”€â”€â”€ Dev: Simulate jackpots â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const isDev = import.meta.env.DEV

/**
 * Simulate a winning draw for a specific ticket + prize tier.
 * Fabricates a perfect draw result that triggers the right animation.
 */
function simulateJackpot(ticket: LotteryTicketDef, prizeIndex: number): void {
    if (isDrawing.value) return
    const prize = ticket.prizes[prizeIndex]
    if (!prize) return

    selectedTicketId.value = ticket.id
    currentLuckyIndices.value = new Set()
    currentLuckChances.value = []
    newlyUnlockedAbility.value = null

    // Build fake player numbers: 1..pickCount
    const playerNumbers = Array.from({ length: ticket.pickCount }, (_, i) => i + 1)
    // Build drawn numbers: first `matchCount` match, rest are offset
    const drawnNumbers = Array.from({ length: ticket.pickCount }, (_, i) =>
        i < prize.matchCount ? i + 1 : ticket.maxNumber - i
    ).sort((a, b) => a - b)

    const bonusMatched = prize.bonusRequired
    const bonusNumber = ticket.hasBonus ? (bonusMatched ? 1 : 99) : null
    const playerBonus = ticket.hasBonus ? 1 : null
    const payout = ticket.ticketCost * prize.payoutMultiplier

    const result: LotteryDrawResult = {
        drawnNumbers,
        bonusNumber,
        playerNumbers,
        playerBonus,
        matchedCount: prize.matchCount,
        bonusMatched,
        prizeTier: prize,
        payout,
    }

    currentResult.value = result

    // Track lottery win in store for achievements
    gambling.recordLotteryWin(ticket.id, prize.label)

    // Unlock achievement
    const isJackpot = prize.rarity === 'jackpot' || prize.rarity === 'mythic'
    if (isJackpot) {
        const achId = LOTTERY_ACHIEVEMENT_MAP[ticket.id]
        if (achId) achievements.unlock(achId, gameEngine.currentTick)
        if (ticket.id === 'divine' && prize.label === 'DIVINE JACKPOT') {
            achievements.unlock('lot_divine_jackpot', gameEngine.currentTick)
        }
    }

    // Unlock divine ability
    if (prize.grantsAbility) {
        const wasNew = gambling.unlockDivineAbility(prize.grantsAbility)
        if (wasNew) {
            newlyUnlockedAbility.value = getDivineAbility(prize.grantsAbility) ?? null
            if (ticket.id === 'divine') achievements.unlock('lot_divine', gameEngine.currentTick)
        }
    }

    // Check master achievement
    const allHaveJackpots = ALL_LOTTERY_IDS.every(tid => {
        const t = LOTTERY_TICKETS.find(tk => tk.id === tid)
        if (!t) return false
        return gambling.hasLotteryWin(tid, t.prizes[t.prizes.length - 1].label)
    })
    if (allHaveJackpots) achievements.unlock('lot_master', gameEngine.currentTick)
}
</script>

<template>
    <div class="lottery-game">
        <!-- Header -->
        <div class="lottery-header">
            <button class="back-btn" @click="$emit('back')">
                <AppIcon icon="mdi:arrow-left" /> {{ $t('gambling.back') }}
            </button>
            <h2 class="lottery-title">
                <AppIcon icon="mdi:ticket" class="title-icon" />
                {{ $t('gambling.lt_title') }}
            </h2>
            <div class="header-info">
                <div class="luck-badge" :title="`Luck multiplier: Ã—${luckMultiplier.toFixed(2)}`">
                    <AppIcon icon="mdi:clover" />
                    <span>Ã—{{ luckMultiplier.toFixed(2) }}</span>
                </div>

                <!-- Draw Speed Selector -->
                <div class="speed-selector">
                    <AppIcon icon="mdi:speedometer" class="speed-icon" />
                    <button v-for="sp in SPEED_OPTIONS" :key="sp" class="speed-btn"
                        :class="{ active: settings.lotteryDrawSpeed === sp }" @click="settings.lotteryDrawSpeed = sp"
                        :disabled="isDrawing">
                        {{ sp }}Ã—
                    </button>
                </div>

                <!-- Multi-Draw Selector -->
                <div class="multi-draw-selector">
                    <AppIcon icon="mdi:layers-triple" class="multi-icon" />
                    <button v-for="n in MULTI_DRAW_OPTIONS" :key="n" class="multi-btn"
                        :class="{ active: settings.lotteryMultiDraw === n }" @click="settings.lotteryMultiDraw = n"
                        :disabled="isDrawing">
                        {{ n }}
                    </button>
                </div>

                <button class="prize-toggle" @click="showDivineGallery = !showDivineGallery"
                    :title="$t('gambling.lt_divine_gallery')">
                    <AppIcon icon="mdi:shimmer" /> {{ showDivineGallery ? $t('gambling.hide') :
                        $t('gambling.lt_divine_gallery') }}
                </button>
                <button class="prize-toggle" @click="showPrizeTable = !showPrizeTable">
                    <AppIcon icon="mdi:table" /> {{ showPrizeTable ? $t('gambling.hide') : $t('gambling.lt_prizes') }}
                </button>
            </div>
        </div>

        <!-- Prize Table (collapsible) -->
        <Transition name="slide">
            <div v-if="showPrizeTable" class="prize-table-panel">
                <h3 class="prize-table-title">{{ $t('gambling.lt_prize_table', { name: selectedTicket.name }) }}</h3>
                <div class="prize-grid">
                    <div v-for="prize in selectedTicket.prizes" :key="prize.label" class="prize-entry"
                        :style="{ '--prize-color': rarityCssVar(prize.rarity) }">
                        <span class="prize-match">{{ prize.matchCount }}/{{ selectedTicket.pickCount }}
                            <template v-if="prize.bonusRequired"> {{ $t('gambling.lt_bonus') }}</template>
                        </span>
                        <span class="prize-label">{{ prize.label }}</span>
                        <span class="prize-rarity">{{ prize.rarity }}</span>
                        <span class="prize-payout">Ã—{{ prize.payoutMultiplier.toLocaleString() }}</span>
                    </div>
                </div>
                <p class="prize-note">{{ $t('gambling.lt_luck_note', { luck: luckMultiplier.toFixed(2) }) }}
                </p>
            </div>
        </Transition>

        <!-- Divine Abilities Gallery (collapsible) â€” minimal card layout -->
        <Transition name="slide">
            <div v-if="showDivineGallery" class="divine-gallery-panel">
                <div class="divine-gallery-header">
                    <span class="divine-gallery-title">{{ $t('gambling.lt_divine_gallery') }}</span>
                    <span class="divine-gallery-count">{{ gambling.divineAbilities.length }} / {{
                        DIVINE_ABILITIES.length
                    }}</span>
                </div>
                <div class="divine-gallery-grid">
                    <div v-for="ability in DIVINE_ABILITIES" :key="ability.id" class="divine-gallery-card"
                        :class="{ 'divine-locked': !gambling.hasDivineAbility(ability.id) }">
                        <div class="dg-top-row">
                            <AppIcon :icon="gambling.hasDivineAbility(ability.id) ? ability.icon : 'mdi:lock-outline'"
                                class="dg-icon" />
                            <span class="dg-name">{{ gambling.hasDivineAbility(ability.id) ? ability.name : '???'
                            }}</span>
                            <span v-if="gambling.hasDivineAbility(ability.id)" class="dg-value"
                                :style="{ color: rarityCssVar(ability.rarity) }">+{{ Math.round((ability.effect.value -
                                    1) *
                                    100) }}%</span>
                        </div>
                        <span class="dg-desc">{{ gambling.hasDivineAbility(ability.id) ? ability.description :
                            $t('gambling.lt_divine_locked') }}</span>
                        <span class="dg-source">
                            <AppIcon icon="mdi:ticket-outline" class="dg-source-icon" />
                            {{ $t('gambling.lt_divine_source', { tier: ability.source }) }}
                        </span>
                    </div>
                </div>
            </div>
        </Transition>

        <!-- Main content area -->
        <div class="lottery-body">
            <!-- Left: Ticket type selector -->
            <div class="ticket-selector">
                <span class="selector-label">{{ $t('gambling.lt_select_ticket') }}</span>
                <div class="ticket-tabs">
                    <button v-for="t in LOTTERY_TICKETS" :key="t.id" class="ticket-tab"
                        :class="{ active: selectedTicketId === t.id }" :style="{ '--tab-accent': t.accent }"
                        @click="selectTicket(t.id)" :disabled="isDrawing">
                        <AppIcon :icon="t.icon" class="tab-icon" />
                        <span class="tab-name">{{ t.name }}</span>
                        <span class="tab-cost">${{ t.ticketCost }}</span>
                    </button>
                </div>
            </div>

            <!-- Center: Number picker / Draw result -->
            <div class="play-area">
                <!-- Single draw result -->
                <template v-if="currentResult && !multiDrawSummary">
                    <LotteryDraw :result="currentResult" :ticket="selectedTicket" :lucky-indices="currentLuckyIndices"
                        :luck-chances="currentLuckChances" :second-chance="currentSecondChance"
                        :original-result="currentOriginalResult" :original-luck-chances="currentOriginalLuckChances"
                        :original-lucky-indices="currentOriginalLuckyIndices" :speed-multiplier="drawSpeed"
                        @done="onSingleDrawDone" />
                    <button class="new-draw-btn" @click="clearResult" :disabled="isDrawing">
                        <AppIcon icon="mdi:refresh" /> {{ $t('gambling.lt_new_draw') }}
                    </button>
                </template>

                <!-- Multi-draw results â€” animated grid of LotteryDraw components -->
                <template v-else-if="multiDrawSummary">
                    <!-- Summary bar -->
                    <div class="multi-draw-summary">
                        <div class="multi-summary-stats">
                            <div class="multi-stat">
                                <span class="multi-stat-label">{{ $t('gambling.stats_wins') }}</span>
                                <span class="multi-stat-value" :class="multiDrawSummary.wins > 0 ? 'positive' : ''">
                                    {{ multiDrawSummary.wins }} / {{ multiDrawSummary.total }}
                                </span>
                            </div>
                            <div class="multi-stat">
                                <span class="multi-stat-label">{{ $t('gambling.lt_total_cost') }}</span>
                                <span class="multi-stat-value negative">-{{ formatCash(D(multiDrawSummary.totalCost))
                                }}</span>
                            </div>
                            <div class="multi-stat">
                                <span class="multi-stat-label">{{ $t('gambling.lt_total_payout') }}</span>
                                <span class="multi-stat-value positive">+{{ formatCash(D(multiDrawSummary.totalPayout))
                                }}</span>
                            </div>
                            <div class="multi-stat">
                                <span class="multi-stat-label">{{ $t('gambling.stats_net') }}</span>
                                <span class="multi-stat-value"
                                    :class="multiDrawSummary.totalPayout - multiDrawSummary.totalCost >= 0 ? 'positive' : 'negative'">
                                    {{ formatCash(D(multiDrawSummary.totalPayout - multiDrawSummary.totalCost)) }}
                                </span>
                            </div>
                        </div>
                        <div v-if="multiDrawSummary.abilities.length > 0" class="multi-abilities-found">
                            <span class="multi-abilities-label">{{ $t('gambling.lt_abilities_found') }}</span>
                            <div v-for="ab in multiDrawSummary.abilities" :key="ab.id" class="multi-ability-tag"
                                :style="{ color: rarityCssVar(ab.rarity) }">
                                <AppIcon :icon="ab.icon" /> {{ ab.name }}
                            </div>
                        </div>
                    </div>

                    <!-- Animated draws grid -->
                    <div class="multi-draw-grid">
                        <div v-for="(entry, i) in multiDrawResults" :key="i" class="multi-draw-cell">
                            <span class="multi-draw-index">#{{ i + 1 }}</span>
                            <LotteryDraw :result="entry.result" :ticket="selectedTicket"
                                :lucky-indices="entry.luckyIndices" :luck-chances="entry.luckChances"
                                :second-chance="entry.secondChance" :original-result="entry.originalResult"
                                :original-luck-chances="entry.originalLuckChances"
                                :original-lucky-indices="entry.originalLuckyIndices" :speed-multiplier="drawSpeed"
                                @done="onMultiDrawDone" />
                        </div>
                    </div>

                    <button class="new-draw-btn" @click="clearResult" :disabled="isDrawing">
                        <AppIcon icon="mdi:refresh" /> {{ $t('gambling.lt_new_draw') }}
                    </button>
                </template>

                <!-- Number picker (no result showing) -->
                <template v-else>
                    <LotteryTicket :ticket="selectedTicket"
                        :disabled="isDrawing || (settings.lotteryMultiDraw > 1 ? !canAffordMulti : !canAfford)"
                        @play="handlePlay" />
                    <p v-if="settings.lotteryMultiDraw > 1 && !canAffordMulti" class="cant-afford">
                        <AppIcon icon="mdi:alert-circle-outline" /> {{ $t('gambling.lt_cant_afford_multi', {
                            n:
                                settings.lotteryMultiDraw, cost: formatCash(D(selectedTicket.ticketCost *
                                    settings.lotteryMultiDraw))
                        }) }}
                    </p>
                    <p v-else-if="!canAfford" class="cant-afford">
                        <AppIcon icon="mdi:alert-circle-outline" /> {{ $t('gambling.lt_cant_afford') }}
                    </p>
                </template>

                <!-- Lucky indicator -->
                <Transition name="lucky">
                    <div v-if="luckyTriggered" class="lucky-banner">
                        <AppIcon icon="mdi:clover" class="lucky-icon" />
                        <span class="lucky-text">{{ $t('gambling.lucky_trigger') }}</span>
                    </div>
                </Transition>

                <!-- Divine Ability Unlock Banner -->
                <Transition name="lucky">
                    <div v-if="newlyUnlockedAbility" class="divine-ability-banner">
                        <AppIcon :icon="newlyUnlockedAbility.icon" class="divine-ability-icon" />
                        <div class="divine-ability-info">
                            <span class="divine-ability-title">{{ $t('gambling.lt_ability_unlocked') }}</span>
                            <span class="divine-ability-name">{{ newlyUnlockedAbility.name }}</span>
                            <span class="divine-ability-desc">{{ newlyUnlockedAbility.description }}</span>
                        </div>
                    </div>
                </Transition>
            </div>
        </div>

        <!-- Stats & History -->
        <div class="lottery-footer">
            <!-- Stats -->
            <div class="lottery-stats">
                <div class="stat-item">
                    <span class="stat-label">{{ $t('gambling.stats_draws') }}</span>
                    <span class="stat-value">{{ formatNumber(stats.played) }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">{{ $t('gambling.stats_wins') }}</span>
                    <span class="stat-value">{{ formatNumber(stats.won) }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">{{ $t('gambling.stats_win_rate') }}</span>
                    <span class="stat-value">{{ stats.played > 0 ? Math.round(stats.won / stats.played * 100) : 0
                        }}%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">{{ $t('gambling.stats_net') }}</span>
                    <span class="stat-value" :class="stats.netProfit.gte(0) ? 'positive' : 'negative'">
                        {{ formatCash(stats.netProfit) }}
                    </span>
                </div>
                <div class="stat-item" v-if="sessionTotal > 0">
                    <span class="stat-label">{{ $t('gambling.stats_session') }}</span>
                    <span class="stat-value" :class="sessionProfit.gte(0) ? 'positive' : 'negative'">
                        {{ formatCash(sessionProfit) }} ({{ sessionWins }}/{{ sessionTotal }})
                    </span>
                </div>
            </div>

            <!-- Recent history -->
            <div v-if="drawHistory.length > 0" class="history-section">
                <span class="history-label">{{ $t('gambling.lt_recent') }}</span>
                <div class="history-list">
                    <div v-for="(entry, i) in drawHistory.slice(0, 8)" :key="i" class="history-entry"
                        :class="{ 'history-win': entry.result.prizeTier }">
                        <span class="history-ticket">{{ entry.ticketName }}</span>
                        <span class="history-matches">{{ entry.result.matchedCount }}/{{
                            LOTTERY_TICKETS.find(t => t.name === entry.ticketName)?.pickCount ?? '?'
                            }}</span>
                        <span v-if="entry.result.prizeTier" class="history-prize"
                            :style="{ color: rarityCssVar(entry.result.prizeTier.rarity) }">
                            {{ entry.result.prizeTier.label }} â€” {{ formatCash(entry.result.payout) }}
                        </span>
                        <span v-else class="history-loss">{{ $t('gambling.lt_no_win') }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dev: Jackpot Simulator -->
        <div v-if="isDev" class="dev-jackpot-panel">
            <div class="dev-panel-header">
                <AppIcon icon="mdi:bug" />
                <span>DEV â€” Jackpot Simulator</span>
            </div>
            <div v-for="ticket in LOTTERY_TICKETS" :key="ticket.id" class="dev-ticket-group">
                <span class="dev-ticket-name" :style="{ color: ticket.accent }">{{ ticket.name }}</span>
                <div class="dev-btn-row">
                    <button v-for="(prize, pi) in ticket.prizes" :key="pi" class="dev-sim-btn"
                        :class="`dev-rarity-${prize.rarity}`"
                        :title="`${prize.label} â€” Ã—${prize.payoutMultiplier.toLocaleString()}`"
                        @click="simulateJackpot(ticket, pi)">
                        {{ prize.label }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</template>

<style scoped>
.lottery-game {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
    width: 100%;
    height: 100%;
    min-height: 0;
}

/* â”€â”€ Header â”€â”€ */
.lottery-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--t-space-3);
}

.back-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--t-transition-fast);
}

.back-btn:hover {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.lottery-title {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: 1.3rem;
    font-weight: 700;
}

.title-icon {
    font-size: 1.5rem;
    color: var(--t-accent);
}

.header-info {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.luck-badge {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-1) var(--t-space-2);
    background: color-mix(in srgb, var(--t-success) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--t-success) 30%, transparent);
    border-radius: var(--t-radius-sm);
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--t-success);
    font-family: var(--t-font-mono);
}

.prize-toggle {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--t-transition-fast);
}

.prize-toggle:hover {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

/* â”€â”€ Prize Table â”€â”€ */
.prize-table-panel {
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-4);
}

.prize-table-title {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: var(--t-space-3);
    color: var(--t-text-secondary);
}

.prize-grid {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-1);
}

.prize-entry {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-2);
    border-radius: var(--t-radius-sm);
    border-left: 3px solid var(--prize-color, var(--t-border));
}

.prize-entry:nth-child(odd) {
    background: var(--t-bg-muted);
}

.prize-match {
    font-family: var(--t-font-mono);
    font-size: 0.8rem;
    min-width: 70px;
    color: var(--t-text-secondary);
}

.prize-label {
    flex: 1;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--t-text);
}

.prize-rarity {
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--prize-color, var(--t-text-muted));
}

.prize-payout {
    font-family: var(--t-font-mono);
    font-weight: 800;
    font-size: 0.95rem;
    color: var(--prize-color, var(--t-accent));
    min-width: 80px;
    text-align: right;
}

.prize-note {
    margin-top: var(--t-space-2);
    font-size: 0.75rem;
    color: var(--t-text-muted);
    font-style: italic;
}

/* â”€â”€ Body layout â”€â”€ */
.lottery-body {
    display: flex;
    gap: var(--t-space-4);
    flex: 1;
    min-height: 0;
}

/* â”€â”€ Ticket selector â”€â”€ */
.ticket-selector {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    width: 180px;
    flex-shrink: 0;
}

.selector-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
    color: var(--t-text-muted);
}

.ticket-tabs {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
}

.ticket-tab {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 2px;
    padding: var(--t-space-3);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    cursor: pointer;
    transition: all var(--t-transition-fast);
    text-align: left;
}

.ticket-tab:hover:not(:disabled) {
    border-color: var(--tab-accent, var(--t-border-hover));
}

.ticket-tab.active {
    border-color: var(--tab-accent, var(--t-accent));
    background: color-mix(in srgb, var(--tab-accent, var(--t-accent)) 6%, transparent);
}

.ticket-tab:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.tab-icon {
    font-size: 1.2rem;
    color: var(--tab-accent, var(--t-text-secondary));
}

.tab-name {
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--t-text);
}

.tab-cost {
    font-size: 0.75rem;
    font-family: var(--t-font-mono);
    color: var(--t-text-muted);
}

/* â”€â”€ Play area â”€â”€ */
.play-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
    min-width: 0;
}

.cant-afford {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--t-font-size-sm);
    color: var(--t-danger);
}

.new-draw-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: var(--t-font-size-sm);
    font-weight: 600;
    transition: all var(--t-transition-fast);
}

.new-draw-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.new-draw-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* â”€â”€ Footer: Stats & History â”€â”€ */
.lottery-footer {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
}

.lottery-stats {
    display: flex;
    gap: var(--t-space-4);
    justify-content: space-evenly;
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    flex-wrap: wrap;
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.stat-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--t-text-muted);
}

.stat-value {
    font-family: var(--t-font-mono);
    font-weight: 700;
    font-size: 1rem;
}

.positive {
    color: var(--t-success);
}

.negative {
    color: var(--t-danger);
}

/* â”€â”€ History â”€â”€ */
.history-section {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
}

.history-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
    color: var(--t-text-muted);
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.history-entry {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    font-size: 0.8rem;
}

.history-entry.history-win {
    border-left: 3px solid var(--t-success);
}

.history-ticket {
    font-weight: 600;
    color: var(--t-text-secondary);
    min-width: 100px;
}

.history-matches {
    font-family: var(--t-font-mono);
    color: var(--t-text-muted);
    min-width: 30px;
}

.history-prize {
    font-weight: 700;
    font-family: var(--t-font-mono);
}

.history-loss {
    color: var(--t-text-muted);
    font-style: italic;
}

/* â”€â”€ Transitions â”€â”€ */
.slide-enter-active,
.slide-leave-active {
    transition: all 0.3s ease;
    overflow: hidden;
}

.slide-enter-from,
.slide-leave-to {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
}

.slide-enter-to,
.slide-leave-from {
    max-height: 600px;
    opacity: 1;
}

/* â”€â”€ Lucky banner â”€â”€ */
.lucky-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-success) 15%, transparent), color-mix(in srgb, var(--t-success) 5%, transparent));
    border: 1px solid color-mix(in srgb, var(--t-success) 40%, transparent);
    box-shadow: 0 0 24px color-mix(in srgb, var(--t-success) 25%, transparent);
    animation: luckyPulse 0.8s ease infinite alternate;
}

.lucky-icon {
    font-size: 2rem;
    color: var(--t-success);
    animation: luckyCloverSpin 1s ease;
    filter: drop-shadow(0 0 6px color-mix(in srgb, var(--t-success) 50%, transparent));
}

.lucky-text {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--t-success);
    letter-spacing: 0.05em;
    text-shadow: 0 0 8px color-mix(in srgb, var(--t-success) 30%, transparent);
}

@keyframes luckyPulse {
    from {
        box-shadow: 0 0 16px color-mix(in srgb, var(--t-success) 20%, transparent);
    }

    to {
        box-shadow: 0 0 32px color-mix(in srgb, var(--t-success) 40%, transparent);
    }
}

@keyframes luckyCloverSpin {
    0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
    }

    50% {
        transform: scale(1.3) rotate(10deg);
        opacity: 1;
    }

    100% {
        transform: scale(1) rotate(0deg);
    }
}

.lucky-enter-active {
    animation: luckyIn 0.5s ease;
}

.lucky-leave-active {
    animation: luckyOut 0.3s ease;
}

@keyframes luckyIn {
    0% {
        transform: scale(0.5) translateY(-10px);
        opacity: 0;
    }

    60% {
        transform: scale(1.1) translateY(0);
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes luckyOut {
    to {
        transform: scale(0.8) translateY(10px);
        opacity: 0;
    }
}

/* â”€â”€ Dev Jackpot Simulator â”€â”€ */
.dev-jackpot-panel {
    border: 2px dashed color-mix(in srgb, var(--t-danger) 40%, transparent);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-3);
    background: color-mix(in srgb, var(--t-danger) 3%, transparent);
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
}

.dev-panel-header {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: 0.75rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--t-danger);
}

.dev-ticket-group {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-1);
}

.dev-ticket-name {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}

.dev-btn-row {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.dev-sim-btn {
    padding: 3px 8px;
    font-size: 0.6rem;
    font-weight: 700;
    border-radius: var(--t-radius-sm);
    border: 1px solid var(--t-border);
    background: var(--t-bg-muted);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
}

.dev-sim-btn:hover {
    background: var(--t-bg-hover);
    transform: scale(1.05);
}

.dev-rarity-common {
    border-color: var(--t-rarity-common);
    color: var(--t-rarity-common);
}

.dev-rarity-uncommon {
    border-color: var(--t-rarity-uncommon);
    color: var(--t-rarity-uncommon);
}

.dev-rarity-rare {
    border-color: var(--t-rarity-rare);
    color: var(--t-rarity-rare);
}

.dev-rarity-epic {
    border-color: var(--t-rarity-epic);
    color: var(--t-rarity-epic);
}

.dev-rarity-legendary {
    border-color: var(--t-rarity-legendary);
    color: var(--t-rarity-legendary);
}

.dev-rarity-jackpot {
    border-color: var(--t-rarity-jackpot);
    color: var(--t-rarity-jackpot);
    font-weight: 800;
}

.dev-rarity-mythic {
    border-color: var(--t-rarity-mythic);
    color: var(--t-rarity-mythic);
    font-weight: 800;
}

/* â”€â”€ Divine Ability Unlock Banner â”€â”€ */
.divine-ability-banner {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-4) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-gold) 15%, transparent), color-mix(in srgb, var(--t-purple) 10%, transparent));
    border: 1px solid color-mix(in srgb, var(--t-gold) 50%, transparent);
    box-shadow: 0 0 32px color-mix(in srgb, var(--t-gold) 30%, transparent);
    animation: divinePulse 1s ease infinite alternate;
}

.divine-ability-icon {
    font-size: 2.5rem;
    color: var(--t-gold);
    filter: drop-shadow(0 0 10px color-mix(in srgb, var(--t-gold) 60%, transparent));
    animation: divineIconSpin 1.2s ease;
}

.divine-ability-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.divine-ability-title {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 800;
    color: var(--t-gold);
}

.divine-ability-name {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--t-gold);
    text-shadow: 0 0 8px color-mix(in srgb, var(--t-gold) 40%, transparent);
}

.divine-ability-desc {
    font-size: 0.8rem;
    color: var(--t-text-secondary);
}

@keyframes divinePulse {
    from {
        box-shadow: 0 0 16px color-mix(in srgb, var(--t-gold) 20%, transparent);
    }

    to {
        box-shadow: 0 0 40px color-mix(in srgb, var(--t-gold) 50%, transparent);
    }
}

@keyframes divineIconSpin {
    0% {
        transform: scale(0) rotate(-360deg);
        opacity: 0;
    }

    50% {
        transform: scale(1.4) rotate(15deg);
        opacity: 1;
    }

    100% {
        transform: scale(1) rotate(0deg);
    }
}

/* â”€â”€ Speed & Multi-Draw Selectors â”€â”€ */
.speed-selector,
.multi-draw-selector {
    display: flex;
    align-items: center;
    gap: 2px;
    padding: 2px;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
}

.speed-icon,
.multi-icon {
    font-size: 0.85rem;
    color: var(--t-text-muted);
    padding: 0px;
    margin: 2px;
}

.speed-btn,
.multi-btn {
    padding: 3px 8px;
    font-size: 0.7rem;
    font-weight: 700;
    font-family: var(--t-font-mono);
    border: none;
    border-radius: var(--t-radius-sm);
    background: transparent;
    color: var(--t-text-muted);
    cursor: pointer;
    transition: all 0.15s ease;
}

.speed-btn:hover:not(:disabled),
.multi-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.speed-btn.active,
.multi-btn.active {
    background: var(--t-accent);
    color: var(--t-text);
}

.speed-btn:disabled,
.multi-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* â”€â”€ Divine Abilities Gallery (minimal) â”€â”€ */
.divine-gallery-panel {
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-4);
}

.divine-gallery-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--t-space-3);
}

.divine-gallery-title {
    font-size: var(--t-font-size-lg);
    font-weight: 700;
    color: var(--t-text);
}

.divine-gallery-count {
    font-size: var(--t-font-size-xs);
    font-weight: 600;
    font-family: var(--t-font-mono);
    color: var(--t-text-muted);
}

.divine-gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--t-space-2);
}

.divine-gallery-card {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-1);
    padding: var(--t-space-3);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    transition: border-color var(--t-transition-normal);
}

.divine-gallery-card:hover {
    border-color: var(--t-border-hover);
}

.divine-gallery-card.divine-locked {
    opacity: 0.45;
}

.dg-top-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.dg-icon {
    font-size: 1.1rem;
    color: var(--t-text-secondary);
    flex-shrink: 0;
}

.divine-locked .dg-icon {
    color: var(--t-text-muted);
}

.dg-name {
    font-size: var(--t-font-size-sm);
    font-weight: 600;
    color: var(--t-text);
    flex: 1;
    min-width: 0;
}

.divine-locked .dg-name {
    color: var(--t-text-muted);
}

.dg-value {
    font-family: var(--t-font-mono);
    font-weight: 800;
    font-size: var(--t-font-size-sm);
    flex-shrink: 0;
}

.dg-desc {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-secondary);
    line-height: 1.3;
}

.divine-locked .dg-desc {
    color: var(--t-text-muted);
    font-style: italic;
}

.dg-source {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
}

.dg-source-icon {
    font-size: 0.75rem;
}

/* â”€â”€ Multi-Draw Summary â”€â”€ */
.multi-draw-summary {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
}

.multi-summary-stats {
    display: flex;
    gap: var(--t-space-4);
    flex-wrap: wrap;
}

.multi-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.multi-stat-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--t-text-muted);
}

.multi-stat-value {
    font-family: var(--t-font-mono);
    font-weight: 700;
    font-size: 1rem;
}

.multi-abilities-found {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--t-space-2);
}

.multi-abilities-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--t-text-secondary);
}

.multi-ability-tag {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: var(--t-radius-sm);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
}

/* â”€â”€ Multi-Draw Animated Grid â”€â”€ */
.multi-draw-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: var(--t-space-3);
    max-height: 60vh;
    overflow-y: auto;
    padding: var(--t-space-1);
}

.multi-draw-cell {
    position: relative;
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    padding: var(--t-space-2);
    overflow: hidden;
}

.multi-draw-index {
    position: absolute;
    top: var(--t-space-1);
    left: var(--t-space-2);
    font-family: var(--t-font-mono);
    font-weight: 700;
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    z-index: 1;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\LotteryTicket.vue ===
<script setup lang="ts">
/**
 * LotteryTicket â€” Interactive number picker for a single lottery ticket.
 *
 * Displays a grid of numbers the player can pick from,
 * optional bonus number selection, and ticket cost info.
 * Emits the selected numbers when the player confirms.
 */
import { ref, computed } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import type { LotteryTicketDef } from '@renderer/data/lottery'

const props = defineProps<{
    ticket: LotteryTicketDef
    disabled: boolean
}>()

const emit = defineEmits<{
    play: [numbers: number[], bonus: number | null]
}>()

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const selectedNumbers = ref<Set<number>>(new Set())
const selectedBonus = ref<number | null>(null)

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const mainNumbers = computed(() =>
    Array.from({ length: props.ticket.maxNumber }, (_, i) => i + 1)
)
const bonusNumbers = computed(() =>
    props.ticket.hasBonus
        ? Array.from({ length: props.ticket.bonusMax }, (_, i) => i + 1)
        : []
)
const isComplete = computed(() => {
    const mainOk = selectedNumbers.value.size === props.ticket.pickCount
    const bonusOk = !props.ticket.hasBonus || selectedBonus.value !== null
    return mainOk && bonusOk
})
const remaining = computed(() => props.ticket.pickCount - selectedNumbers.value.size)

// â”€â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleNumber(n: number): void {
    if (props.disabled) return
    const set = new Set(selectedNumbers.value)
    if (set.has(n)) {
        set.delete(n)
    } else if (set.size < props.ticket.pickCount) {
        set.add(n)
    }
    selectedNumbers.value = set
}

function toggleBonus(n: number): void {
    if (props.disabled) return
    selectedBonus.value = selectedBonus.value === n ? null : n
}

function quickPick(): void {
    if (props.disabled) return
    const nums = new Set<number>()
    while (nums.size < props.ticket.pickCount) {
        nums.add(Math.floor(Math.random() * props.ticket.maxNumber) + 1)
    }
    selectedNumbers.value = nums
    if (props.ticket.hasBonus) {
        selectedBonus.value = Math.floor(Math.random() * props.ticket.bonusMax) + 1
    }
}

function clearSelection(): void {
    selectedNumbers.value = new Set()
    selectedBonus.value = null
}

function confirmPlay(): void {
    if (!isComplete.value || props.disabled) return
    const nums = Array.from(selectedNumbers.value).sort((a, b) => a - b)
    emit('play', nums, selectedBonus.value)
    // Reset after play
    clearSelection()
}
</script>

<template>
    <div class="lottery-ticket" :style="{ '--ticket-accent': ticket.accent }">
        <!-- Ticket Header -->
        <div class="ticket-header">
            <div class="ticket-icon-box">
                <AppIcon :icon="ticket.icon" class="ticket-icon" />
            </div>
            <div class="ticket-info">
                <h3 class="ticket-name">{{ ticket.name }}</h3>
                <p class="ticket-desc">{{ ticket.description }}</p>
            </div>
            <div class="ticket-cost">
                <span class="cost-label">{{ $t('gambling.lt_ticket') }}</span>
                <span class="cost-value">${{ ticket.ticketCost }}</span>
            </div>
        </div>

        <!-- Pick instructions -->
        <div class="pick-instructions">
            <span v-if="remaining > 0" class="picks-remaining">
                {{ $t('gambling.lt_pick_more', { n: remaining }) }}
            </span>
            <span v-else class="picks-complete">
                <AppIcon icon="mdi:check-circle" /> {{ $t('gambling.lt_numbers_selected') }}
            </span>
            <div class="pick-actions">
                <button class="pick-action-btn" @click="quickPick" :disabled="disabled">
                    <AppIcon icon="mdi:dice-multiple" /> {{ $t('gambling.lt_quick_pick') }}
                </button>
                <button class="pick-action-btn" @click="clearSelection"
                    :disabled="disabled || selectedNumbers.size === 0">
                    <AppIcon icon="mdi:close-circle-outline" /> {{ $t('gambling.lt_clear') }}
                </button>
            </div>
        </div>

        <!-- Main number grid -->
        <div class="number-grid">
            <button v-for="n in mainNumbers" :key="n" class="number-ball"
                :class="{ selected: selectedNumbers.has(n), full: selectedNumbers.size >= ticket.pickCount && !selectedNumbers.has(n) }"
                :disabled="disabled" @click="toggleNumber(n)">
                {{ n }}
            </button>
        </div>

        <!-- Bonus number grid (if applicable) -->
        <template v-if="ticket.hasBonus">
            <div class="bonus-divider">
                <span class="bonus-label">
                    <AppIcon icon="mdi:star-four-points" /> {{ $t('gambling.lt_bonus_ball') }}
                </span>
            </div>
            <div class="number-grid bonus-grid">
                <button v-for="n in bonusNumbers" :key="n" class="number-ball bonus-ball"
                    :class="{ selected: selectedBonus === n }" :disabled="disabled" @click="toggleBonus(n)">
                    {{ n }}
                </button>
            </div>
        </template>

        <!-- Confirm button -->
        <button class="play-ticket-btn" :disabled="!isComplete || disabled" @click="confirmPlay">
            <AppIcon icon="mdi:ticket-confirmation" />
            {{ $t('gambling.lt_buy_draw', { cost: ticket.ticketCost }) }}
        </button>
    </div>
</template>

<style scoped>
.lottery-ticket {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-4);
    transition: border-color var(--t-transition-normal);
}

.lottery-ticket:hover {
    border-color: color-mix(in srgb, var(--ticket-accent) 40%, var(--t-border));
}

/* â”€â”€ Header â”€â”€ */
.ticket-header {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
}

.ticket-icon-box {
    width: 44px;
    height: 44px;
    border-radius: var(--t-radius-md);
    background: color-mix(in srgb, var(--ticket-accent) 12%, transparent);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.ticket-icon {
    font-size: 1.4rem;
    color: var(--ticket-accent);
}

.ticket-info {
    flex: 1;
    min-width: 0;
}

.ticket-name {
    font-size: var(--t-font-size-md);
    font-weight: 700;
    color: var(--t-text);
    margin: 0;
}

.ticket-desc {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    margin: 0;
    line-height: 1.4;
}

.ticket-cost {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border-radius: var(--t-radius-md);
    flex-shrink: 0;
}

.cost-label {
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--t-text-muted);
    font-weight: 600;
}

.cost-value {
    font-family: var(--t-font-mono);
    font-weight: 700;
    font-size: var(--t-font-size-md);
    color: var(--ticket-accent);
}

/* â”€â”€ Pick instructions â”€â”€ */
.pick-instructions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--t-space-2);
    flex-wrap: wrap;
}

.picks-remaining {
    font-size: var(--t-font-size-sm);
    color: var(--t-text-secondary);
}

.picks-complete {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--t-font-size-sm);
    color: var(--t-success);
    font-weight: 600;
}

.pick-actions {
    display: flex;
    gap: 4px;
}

.pick-action-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-1) var(--t-space-2);
    font-size: 0.75rem;
    font-weight: 600;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.pick-action-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.pick-action-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* â”€â”€ Number grid â”€â”€ */
.number-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
}

.number-ball {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    font-weight: 700;
    font-family: var(--t-font-mono);
    background: var(--t-bg-muted);
    border: 2px solid var(--t-border);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all var(--t-transition-fast);
    user-select: none;
}

.number-ball:hover:not(:disabled):not(.full) {
    border-color: var(--ticket-accent);
    color: var(--ticket-accent);
    background: color-mix(in srgb, var(--ticket-accent) 8%, transparent);
}

.number-ball.selected {
    background: var(--ticket-accent);
    border-color: var(--ticket-accent);
    color: var(--t-text);
    box-shadow: 0 0 8px color-mix(in srgb, var(--ticket-accent) 40%, transparent);
}

.number-ball.full {
    opacity: 0.3;
    cursor: not-allowed;
}

.number-ball:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* â”€â”€ Bonus section â”€â”€ */
.bonus-divider {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.bonus-divider::before,
.bonus-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--t-border);
}

.bonus-label {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--t-text-muted);
    white-space: nowrap;
}

.bonus-ball.selected {
    background: var(--t-warning);
    border-color: var(--t-warning);
    color: var(--t-text);
    box-shadow: 0 0 10px color-mix(in srgb, var(--t-warning) 40%, transparent);
}

/* â”€â”€ Play button â”€â”€ */
.play-ticket-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--ticket-accent);
    border: none;
    border-radius: var(--t-radius-md);
    color: var(--t-text);
    font-size: var(--t-font-size-sm);
    font-weight: 700;
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.play-ticket-btn:hover:not(:disabled) {
    filter: brightness(1.1);
    box-shadow: 0 4px 12px color-mix(in srgb, var(--ticket-accent) 30%, transparent);
}

.play-ticket-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    filter: none;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\PlinkoBoard.vue ===
<script setup lang="ts">
/**
 * PlinkoBoard â€” Canvas-based rendering of the Plinko peg board.
 *
 * Renders pegs, balls with trails, bucket zones with multiplier labels,
 * and animates ball physics via requestAnimationFrame.
 */
import { ref, onMounted, onUnmounted, watch, toRefs, computed } from 'vue'
import { PlinkoEngine, type PlinkoBall, type PlinkoRisk } from '@renderer/core/PlinkoEngine'

const props = withDefaults(defineProps<{
    rows: number
    risk: PlinkoRisk
    width: number
    height: number
    /** Physics steps per animation frame (1 = normal, 2 = fast, 4 = turbo). Does NOT change trajectory. */
    speed?: number
}>(), { speed: 1 })

const emit = defineEmits<{
    ballLanded: [bucketIndex: number, multiplier: number, ballId: number]
}>()

const { rows, risk, width, height } = toRefs(props)
const stepsPerFrame = computed(() => Math.max(1, Math.min(props.speed ?? 1, 8)))
const skipFrames = computed(() => (props.speed ?? 1) < 1 ? Math.round(1 / (props.speed ?? 1)) : 0)
let frameCounter = 0

const canvasRef = ref<HTMLCanvasElement | null>(null)
let engine: PlinkoEngine
let balls: PlinkoBall[] = []
let animId: number | null = null
let lastHitBucket: number | null = null
let hitFlash = 0

// â”€â”€â”€ Engine management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function rebuildEngine(): void {
    if (engine) engine.destroy()
    engine = new PlinkoEngine({
        rows: rows.value,
        risk: risk.value,
        boardWidth: width.value,
        boardHeight: height.value,
    })
    balls = []
}

watch([rows, risk, width, height], () => {
    rebuildEngine()
})

// â”€â”€â”€ Public API (called from parent) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function dropBall(): void {
    if (!engine) return
    const ball = engine.createBall()
    balls.push(ball)
}

defineExpose({ dropBall })

// â”€â”€â”€ Animation loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function tick(): void {
    if (!engine) return

    // For sub-1 speeds, skip physics on some frames (slow motion)
    const skip = skipFrames.value
    const shouldStep = skip === 0 || (++frameCounter % (skip + 1) === 0)

    if (shouldStep) {
        const steps = stepsPerFrame.value
        for (let s = 0; s < steps; s++) {
            // Advance the Matter.js world once
            engine.tick()

            // Sync every ball from its physics body
            for (const ball of balls) {
                if (!ball.active) continue
                engine.step(ball)

                // Ball just landed
                if (!ball.active && ball.landedBucket !== null) {
                    const mult = engine.getMultiplier(ball.landedBucket)
                    lastHitBucket = ball.landedBucket
                    hitFlash = 15
                    emit('ballLanded', ball.landedBucket, mult, ball.id)
                }
            }
        }
    }

    // Decay flash
    if (hitFlash > 0) hitFlash--
    if (hitFlash === 0) lastHitBucket = null

    // Garbage-collect old landed balls (keep last 3 for visual)
    const landed = balls.filter((b) => !b.active)
    if (landed.length > 3) {
        const removeCount = landed.length - 3
        for (let i = 0; i < removeCount; i++) {
            const idx = balls.indexOf(landed[i])
            if (idx !== -1) balls.splice(idx, 1)
        }
    }

    draw()
    animId = requestAnimationFrame(tick)
}

// â”€â”€â”€ Drawing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function draw(): void {
    const canvas = canvasRef.value
    if (!canvas || !engine) return
    const ctx = canvas.getContext('2d')
    if (!ctx) return

    const w = width.value
    const h = height.value
    canvas.width = w * window.devicePixelRatio
    canvas.height = h * window.devicePixelRatio
    ctx.scale(window.devicePixelRatio, window.devicePixelRatio)

    ctx.clearRect(0, 0, w, h)

    drawBuckets(ctx)
    drawPegs(ctx)
    drawBalls(ctx)
}

function drawPegs(ctx: CanvasRenderingContext2D): void {
    for (const peg of engine.pegs) {
        ctx.beginPath()
        ctx.arc(peg.x, peg.y, engine.pegRadius, 0, Math.PI * 2)
        ctx.fillStyle = 'rgba(148, 163, 184, 0.6)'
        ctx.fill()

        // Subtle highlight
        ctx.beginPath()
        ctx.arc(peg.x - 1, peg.y - 1, engine.pegRadius * 0.5, 0, Math.PI * 2)
        ctx.fillStyle = 'rgba(255, 255, 255, 0.15)'
        ctx.fill()
    }
}

function drawBuckets(ctx: CanvasRenderingContext2D): void {
    const bw = engine.bucketWidth
    const by = engine.bucketY
    const bh = height.value - by

    for (const bucket of engine.buckets) {
        const bx = engine.sidePadding + bucket.index * bw

        // Bucket background
        const isHit = lastHitBucket === bucket.index && hitFlash > 0
        const alpha = isHit ? 0.5 + (hitFlash / 15) * 0.3 : 0.25
        ctx.fillStyle = hexToRgba(bucket.color, alpha)
        ctx.fillRect(bx + 1, by, bw - 2, bh)

        // Border between buckets
        ctx.strokeStyle = hexToRgba(bucket.color, 0.4)
        ctx.lineWidth = 1
        ctx.strokeRect(bx + 1, by, bw - 2, bh)

        // Multiplier label
        ctx.fillStyle = bucket.color
        ctx.font = `bold ${bw < 35 ? 9 : 11}px system-ui, sans-serif`
        ctx.textAlign = 'center'
        ctx.textBaseline = 'middle'
        const label = bucket.multiplier >= 1
            ? `${bucket.multiplier}x`
            : `${bucket.multiplier}x`
        ctx.fillText(label, bx + bw / 2, by + bh / 2)
    }
}

function drawBalls(ctx: CanvasRenderingContext2D): void {
    for (const ball of balls) {
        // Draw trail
        if (ball.trail.length > 1) {
            ctx.beginPath()
            ctx.moveTo(ball.trail[0].x, ball.trail[0].y)
            for (let i = 1; i < ball.trail.length; i++) {
                ctx.lineTo(ball.trail[i].x, ball.trail[i].y)
            }
            ctx.strokeStyle = 'rgba(251, 191, 36, 0.3)'
            ctx.lineWidth = ball.radius * 0.8
            ctx.lineCap = 'round'
            ctx.stroke()
        }

        // Draw ball
        ctx.beginPath()
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2)

        // Glowing ball gradient
        const grad = ctx.createRadialGradient(
            ball.x - 1, ball.y - 1, 0,
            ball.x, ball.y, ball.radius
        )
        grad.addColorStop(0, '#fcd34d')
        grad.addColorStop(0.6, '#f59e0b')
        grad.addColorStop(1, '#d97706')
        ctx.fillStyle = grad
        ctx.fill()

        // Ball highlight
        ctx.beginPath()
        ctx.arc(ball.x - 1.5, ball.y - 1.5, ball.radius * 0.35, 0, Math.PI * 2)
        ctx.fillStyle = 'rgba(255, 255, 255, 0.4)'
        ctx.fill()

        // Land indicator for settled balls
        if (!ball.active && ball.landedBucket !== null) {
            const bucket = engine.buckets[ball.landedBucket]
            ctx.beginPath()
            ctx.arc(ball.x, ball.y, ball.radius + 3, 0, Math.PI * 2)
            ctx.strokeStyle = bucket.color
            ctx.lineWidth = 2
            ctx.stroke()
        }
    }
}

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function hexToRgba(hex: string, alpha: number): string {
    const r = parseInt(hex.slice(1, 3), 16)
    const g = parseInt(hex.slice(3, 5), 16)
    const b = parseInt(hex.slice(5, 7), 16)
    return `rgba(${r}, ${g}, ${b}, ${alpha})`
}

// â”€â”€â”€ Lifecycle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

onMounted(() => {
    rebuildEngine()
    animId = requestAnimationFrame(tick)
})

onUnmounted(() => {
    if (animId !== null) cancelAnimationFrame(animId)
    if (engine) engine.destroy()
})
</script>

<template>
    <div class="plinko-board-wrap">
        <canvas ref="canvasRef" class="plinko-canvas" :style="{ width: width + 'px', height: height + 'px' }" />
    </div>
</template>

<style scoped>
.plinko-board-wrap {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
}

.plinko-canvas {
    border-radius: var(--t-radius-lg);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    display: block;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\PlinkoGame.vue ===
<script setup lang="ts">
/**
 * PlinkoGame â€” Full Plinko mini-game view.
 *
 * Features:
 * - Risk level (low / medium / high) with distinct payout curves
 * - Row count selection (8 / 12 / 16) for board complexity
 * - Bet controls with presets, half/double/max
 * - Animated ball drop with physics simulation
 * - Result history showing last drops
 * - Auto-drop mode for rapid play
 * - Full integration with gambling store (XP, gambling_luck, stats)
 * - Info panel with odds & payout tables
 */
import { useI18n } from 'vue-i18n'
import { ref, computed, onUnmounted } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import InfoPanel from '@renderer/components/layout/InfoPanel.vue'
import type { InfoSection } from '@renderer/components/layout/InfoPanel.vue'
import PlinkoBoard from './PlinkoBoard.vue'
import { useFormat } from '@renderer/composables/useFormat'
import { usePlayerStore } from '@renderer/stores/usePlayerStore'
import { useGamblingStore } from '@renderer/stores/useGamblingStore'
import { D, mul } from '@renderer/core/BigNum'
import { PlinkoEngine, type PlinkoRisk } from '@renderer/core/PlinkoEngine'
import { THEME, RISK_COLORS } from '@renderer/assets/theme/colors'

const emit = defineEmits<{ back: [] }>()

const { t } = useI18n()
const player = usePlayerStore()
const gambling = useGamblingStore()
const { formatCash, formatNumber } = useFormat()

// â”€â”€â”€ Board configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BOARD_WIDTH = 560
const BOARD_HEIGHT = 600

const selectedRows = ref<number>(12)
const selectedRisk = ref<PlinkoRisk>('medium')

// â”€â”€â”€ Speed control â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export type BallSpeed = 0.5 | 1 | 2 | 4
const selectedSpeed = ref<BallSpeed>(1)
const speedOptions: { value: BallSpeed; label: string; icon: string }[] = [
    { value: 0.5, label: '0.5Ã—', icon: 'mdi:play-speed' },
    { value: 1, label: '1Ã—', icon: 'mdi:play' },
    { value: 2, label: '2Ã—', icon: 'mdi:fast-forward' },
    { value: 4, label: '4Ã—', icon: 'mdi:skip-forward' },
]

const rowOptions = PlinkoEngine.getRowOptions()
const riskOptions = PlinkoEngine.getRiskOptions()

const riskMeta: Record<PlinkoRisk, { label: string; color: string; icon: string }> = {
    low: { label: t('gambling.pk_low'), color: RISK_COLORS.low, icon: 'mdi:shield-check' },
    medium: { label: t('gambling.pk_medium'), color: RISK_COLORS.medium, icon: 'mdi:shield-alert' },
    high: { label: t('gambling.pk_high'), color: RISK_COLORS.high, icon: 'mdi:shield-off' },
}

// â”€â”€â”€ Bet state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const betAmount = ref(10)
const dropping = ref(false)
const autoDrop = ref(false)
let autoDropInterval: ReturnType<typeof setInterval> | null = null

// â”€â”€â”€ Result history â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
interface DropResult {
    id: number
    multiplier: number
    payout: string
    won: boolean
    color: string
}
const lastResults = ref<DropResult[]>([])
const lastMultiplier = ref<number | null>(null)
const showResultFlash = ref(false)

// â”€â”€â”€ Board ref â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const boardRef = ref<InstanceType<typeof PlinkoBoard> | null>(null)

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const betDecimal = computed(() => D(betAmount.value))
const canDrop = computed(() =>
    betAmount.value > 0 &&
    player.cash.gte(betDecimal.value) &&
    !dropping.value
)
const stats = computed(() => gambling.getStats('plinko'))

// Build a preview multiplier table for the current config
const previewBuckets = computed(() => {
    const eng = new PlinkoEngine({
        rows: selectedRows.value,
        risk: selectedRisk.value,
        boardWidth: BOARD_WIDTH,
        boardHeight: BOARD_HEIGHT,
    })
    return eng.buckets
})

/** Auto-drop interval scaled by speed */
const autoDropDelay = computed(() => Math.max(120, 500 / selectedSpeed.value))

const maxMultiplier = computed(() =>
    Math.max(...previewBuckets.value.map(b => b.multiplier))
)

// â”€â”€â”€ Drop logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drop(): void {
    if (!canDrop.value) return
    if (!player.spendCash(betDecimal.value)) return

    dropping.value = true
    showResultFlash.value = false
    lastMultiplier.value = null

    boardRef.value?.dropBall()

    // The dropping flag resets fast-enough to allow queued drops if auto
    setTimeout(() => {
        dropping.value = false
    }, 300)
}

function onBallLanded(bucketIndex: number, multiplier: number, _ballId: number): void {
    const payoutAmount = mul(betDecimal.value, multiplier)
    const isWin = multiplier >= 1

    if (isWin) {
        player.earnCash(payoutAmount)
        gambling.recordWin('plinko', betDecimal.value, payoutAmount)
    } else {
        // Partial return: the payout is less than the bet
        if (multiplier > 0) {
            player.earnCash(payoutAmount)
        }
        gambling.recordLoss('plinko', betDecimal.value)
    }

    // Update result display
    lastMultiplier.value = multiplier
    showResultFlash.value = true

    const result: DropResult = {
        id: Date.now(),
        multiplier,
        payout: formatCash(isWin ? payoutAmount : payoutAmount),
        won: isWin,
        color: previewBuckets.value[bucketIndex]?.color ?? THEME.info,
    }
    lastResults.value.unshift(result)
    if (lastResults.value.length > 20) lastResults.value.pop()

    setTimeout(() => {
        showResultFlash.value = false
    }, 1500)
}

// â”€â”€â”€ Auto-drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleAutoDrop(): void {
    autoDrop.value = !autoDrop.value
    if (autoDrop.value) {
        autoDropInterval = setInterval(() => {
            if (canDrop.value) {
                drop()
            } else if (!player.cash.gte(betDecimal.value)) {
                // Stop if insufficient funds
                autoDrop.value = false
                if (autoDropInterval) clearInterval(autoDropInterval)
                autoDropInterval = null
            }
        }, autoDropDelay.value)
    } else {
        if (autoDropInterval) clearInterval(autoDropInterval)
        autoDropInterval = null
    }
}

onUnmounted(() => {
    if (autoDropInterval) clearInterval(autoDropInterval)
})

// â”€â”€â”€ Bet helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setBet(amount: number): void {
    betAmount.value = Math.max(1, Math.min(amount, player.cash.toNumber()))
}
function halfBet(): void { setBet(Math.max(1, Math.floor(betAmount.value / 2))) }
function doubleBet(): void { setBet(betAmount.value * 2) }
function maxBet(): void { setBet(player.cash.toNumber()) }

// â”€â”€â”€ Info Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const plinkoInfo = computed<InfoSection[]>(() => [
    {
        title: t('gambling.info.plinko.how_title'),
        icon: 'mdi:help-circle-outline',
        entries: [
            { term: t('gambling.info.plinko.set_bet'), desc: t('gambling.info.plinko.set_bet_desc'), icon: 'mdi:cash' },
            { term: t('gambling.info.plinko.pick_rows'), desc: t('gambling.info.plinko.pick_rows_desc'), icon: 'mdi:grid' },
            { term: t('gambling.info.plinko.choose_risk'), desc: t('gambling.info.plinko.choose_risk_desc'), icon: 'mdi:shield-alert' },
            { term: t('gambling.info.plinko.drop_ball'), desc: t('gambling.info.plinko.drop_ball_desc'), icon: 'mdi:arrow-down-bold' },
        ]
    },
    {
        title: t('gambling.info.plinko.multipliers_title'),
        icon: 'mdi:cash-multiple',
        entries: [
            { term: t('gambling.info.plinko.center'), desc: t('gambling.info.plinko.center_desc'), icon: 'mdi:chart-bell-curve' },
            { term: t('gambling.info.plinko.edge'), desc: t('gambling.info.plinko.edge_desc'), icon: 'mdi:trophy' },
            { term: t('gambling.info.plinko.luck'), desc: t('gambling.info.plinko.luck_desc'), icon: 'mdi:clover' },
        ]
    },
    {
        title: t('gambling.info.plinko.max_title'),
        icon: 'mdi:star-circle',
        entries: [
            { term: t('gambling.info.plinko.low'), desc: t('gambling.info.plinko.low_desc'), icon: 'mdi:shield-check' },
            { term: t('gambling.info.plinko.medium'), desc: t('gambling.info.plinko.medium_desc'), icon: 'mdi:shield-alert' },
            { term: t('gambling.info.plinko.high'), desc: t('gambling.info.plinko.high_desc'), icon: 'mdi:shield-off' },
        ]
    }
])
</script>

<template>
    <div class="plinko-game">
        <!-- Header -->
        <div class="pk-header">
            <button class="back-btn" @click="$emit('back')">
                <AppIcon icon="mdi:arrow-left" /> {{ $t('gambling.back') }}
            </button>
            <h2 class="pk-title">
                <AppIcon icon="mdi:triangle-outline" class="title-icon" />
                {{ $t('gambling.pk_title') }}
            </h2>
            <div class="balance-chip">
                <AppIcon icon="mdi:cash" />
                {{ formatCash(player.cash) }}
            </div>
        </div>

        <!-- Main area: Board + Controls side by side -->
        <div class="pk-main">
            <!-- Board -->
            <div class="pk-board-col">
                <!-- Result flash overlay -->
                <Transition name="pop">
                    <div v-if="showResultFlash && lastMultiplier !== null" class="result-flash"
                        :class="lastMultiplier >= 1 ? 'flash-win' : 'flash-lose'">
                        <span class="flash-mult">{{ lastMultiplier }}Ã—</span>
                        <span class="flash-label">{{ lastMultiplier >= 1 ? $t('gambling.pk_win') :
                            $t('gambling.pk_loss') }}</span>
                    </div>
                </Transition>

                <PlinkoBoard ref="boardRef" :rows="selectedRows" :risk="selectedRisk" :width="BOARD_WIDTH"
                    :height="BOARD_HEIGHT" :speed="selectedSpeed" @ball-landed="onBallLanded" />
            </div>

            <!-- Controls panel -->
            <div class="pk-controls-col">
                <!-- Risk selector -->
                <div class="control-group">
                    <label class="control-label">{{ $t('gambling.pk_risk') }}</label>
                    <div class="risk-selector">
                        <button v-for="r in riskOptions" :key="r" class="risk-btn"
                            :class="{ active: selectedRisk === r }" :style="{
                                '--risk-color': riskMeta[r].color,
                            }" @click="selectedRisk = r" :disabled="autoDrop">
                            <AppIcon :icon="riskMeta[r].icon" class="risk-icon" />
                            <span>{{ riskMeta[r].label }}</span>
                        </button>
                    </div>
                </div>

                <!-- Row selector -->
                <div class="control-group">
                    <label class="control-label">{{ $t('gambling.pk_rows') }}</label>
                    <div class="row-selector">
                        <button v-for="r in rowOptions" :key="r" class="row-btn" :class="{ active: selectedRows === r }"
                            @click="selectedRows = r" :disabled="autoDrop">
                            {{ r }}
                        </button>
                    </div>
                </div>

                <!-- Speed selector -->
                <div class="control-group">
                    <label class="control-label">{{ $t('gambling.pk_speed') }}</label>
                    <div class="speed-selector">
                        <button v-for="s in speedOptions" :key="s.value" class="speed-btn"
                            :class="{ active: selectedSpeed === s.value }" @click="selectedSpeed = s.value">
                            <AppIcon :icon="s.icon" class="speed-icon" />
                            <span>{{ s.label }}</span>
                        </button>
                    </div>
                </div>

                <!-- Bet controls -->
                <div class="control-group">
                    <label class="control-label">{{ $t('gambling.bet_amount') }}</label>
                    <div class="bet-row">
                        <button class="bet-adj" @click="halfBet" :disabled="autoDrop">1/2</button>
                        <div class="bet-display">
                            <input type="number" v-model.number="betAmount" :min="1" :max="player.cash.toNumber()"
                                class="bet-input" :disabled="autoDrop" />
                        </div>
                        <button class="bet-adj" @click="doubleBet" :disabled="autoDrop">Ã—2</button>
                    </div>
                    <div class="bet-presets">
                        <button v-for="pct in [10, 25, 50]" :key="pct" class="preset-btn"
                            @click="setBet(Math.floor(player.cash.toNumber() * pct / 100))" :disabled="autoDrop">
                            {{ pct }}%
                        </button>
                        <button class="preset-btn preset-max" @click="maxBet" :disabled="autoDrop">{{ $t('gambling.max')
                            }}</button>
                    </div>
                </div>

                <!-- Max multiplier display -->
                <div class="max-mult-display">
                    <span class="max-mult-label">{{ $t('gambling.pk_max_payout') }}</span>
                    <span class="max-mult-value">{{ maxMultiplier }}Ã—</span>
                </div>

                <!-- Action buttons -->
                <div class="action-buttons">
                    <button class="drop-btn" :disabled="!canDrop && !autoDrop" @click="drop">
                        <AppIcon :icon="dropping ? 'mdi:loading' : 'mdi:arrow-down-bold'"
                            :class="{ 'spin-icon': dropping }" />
                        {{ $t('gambling.pk_drop') }}
                    </button>
                    <button class="auto-btn" :class="{ active: autoDrop }" @click="toggleAutoDrop">
                        <AppIcon :icon="autoDrop ? 'mdi:stop' : 'mdi:autorenew'" />
                        {{ autoDrop ? $t('gambling.pk_stop') : $t('gambling.pk_auto') }}
                    </button>
                </div>

                <!-- Result history -->
                <div class="result-history" v-if="lastResults.length > 0">
                    <label class="control-label">{{ $t('gambling.pk_recent') }}</label>
                    <div class="history-chips">
                        <TransitionGroup name="chip">
                            <span v-for="r in lastResults.slice(0, 12)" :key="r.id" class="history-chip"
                                :class="r.won ? 'chip-win' : 'chip-lose'" :style="{ borderColor: r.color }">
                                {{ r.multiplier }}Ã—
                            </span>
                        </TransitionGroup>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Panel -->
        <InfoPanel :title="$t('gambling.pk_odds')" :sections="plinkoInfo" />

        <!-- Stats -->
        <div class="pk-stats">
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_drops') }}</span>
                <span class="stat-value">{{ formatNumber(stats.played) }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_wins') }}</span>
                <span class="stat-value">{{ formatNumber(stats.won) }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_win_rate') }}</span>
                <span class="stat-value">
                    {{ stats.played > 0 ? Math.round(stats.won / stats.played * 100) : 0 }}%
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_net') }}</span>
                <span class="stat-value" :class="stats.netProfit.gte(0) ? 'success' : 'danger'">
                    {{ formatCash(stats.netProfit) }}
                </span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.plinko-game {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
    width: 100%;
    height: 100%;
    min-height: 0;
}

/* â”€â”€ Header â”€â”€ */
.pk-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--t-space-3);
}

.back-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--t-transition-fast);
}

.back-btn:hover {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.pk-title {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: 1.3rem;
    font-weight: 700;
}

.title-icon {
    font-size: 1.5rem;
    color: var(--t-warning);
}

.balance-chip {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-success);
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 0.85rem;
}

/* â”€â”€ Main layout â”€â”€ */
.pk-main {
    display: flex;
    gap: var(--t-space-4);
    align-items: stretch;
    flex: 1;
    min-height: 0;
}

.pk-board-col {
    position: relative;
    flex: 1;
    min-width: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.pk-controls-col {
    flex: 0 0 280px;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
    max-width: 300px;
    overflow-y: auto;
}

/* â”€â”€ Result flash overlay â”€â”€ */
.result-flash {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-3) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    pointer-events: none;
    animation: flashPulse 1.5s ease-out forwards;
}

.flash-win {
    background: color-mix(in srgb, var(--t-success) 20%, transparent);
    border: 2px solid var(--t-success);
}

.flash-lose {
    background: color-mix(in srgb, var(--t-danger) 20%, transparent);
    border: 2px solid var(--t-danger);
}

.flash-mult {
    font-size: 2rem;
    font-weight: 900;
    font-family: var(--font-mono, monospace);
}

.flash-win .flash-mult {
    color: var(--t-success);
}

.flash-lose .flash-mult {
    color: var(--t-danger);
}

.flash-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--t-text-muted);
}

@keyframes flashPulse {
    0% {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
    }

    15% {
        transform: translate(-50%, -50%) scale(1.1);
        opacity: 1;
    }

    30% {
        transform: translate(-50%, -50%) scale(1);
    }

    80% {
        opacity: 1;
    }

    100% {
        opacity: 0;
    }
}

/* â”€â”€ Control groups â”€â”€ */
.control-group {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-3);
    box-shadow: var(--t-shadow-sm);
}

.control-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    color: var(--t-text-muted);
}

/* â”€â”€ Risk selector â”€â”€ */
.risk-selector {
    display: flex;
    gap: var(--t-space-2);
}

.risk-btn {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 2px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: 700;
    transition: all var(--t-transition-fast);
}

.risk-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.risk-btn.active {
    border-color: var(--risk-color);
    color: var(--risk-color);
    background: color-mix(in srgb, var(--risk-color) 10%, transparent);
}

.risk-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.risk-icon {
    font-size: 1.2rem;
}

/* â”€â”€ Row selector â”€â”€ */
.row-selector {
    display: flex;
    gap: var(--t-space-2);
}

.row-btn {
    flex: 1;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 2px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 700;
    text-align: center;
    transition: all var(--t-transition-fast);
}

.row-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.row-btn.active {
    border-color: var(--t-accent);
    color: var(--t-accent);
    background: color-mix(in srgb, var(--t-accent) 10%, transparent);
}

.row-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* â”€â”€ Speed selector â”€â”€ */
.speed-selector {
    display: flex;
    gap: var(--t-space-2);
}

.speed-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 2px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 700;
    transition: all var(--t-transition-fast);
}

.speed-btn:hover {
    background: var(--t-bg-hover);
}

.speed-btn.active {
    border-color: var(--t-warning);
    color: var(--t-warning);
    background: color-mix(in srgb, var(--t-warning) 10%, transparent);
}

.speed-icon {
    font-size: 1rem;
}

/* â”€â”€ Bet controls â”€â”€ */
.bet-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.bet-adj {
    width: 36px;
    height: 36px;
    border-radius: var(--t-radius-md);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    color: var(--t-text);
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    transition: all var(--t-transition-fast);
}

.bet-adj:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.bet-adj:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.bet-display {
    flex: 1;
}

.bet-input {
    width: 100%;
    text-align: center;
    font-size: 1rem;
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text);
    outline: none;
}

.bet-presets {
    display: flex;
    gap: 4px;
}

.preset-btn {
    flex: 1;
    padding: var(--t-space-1) var(--t-space-2);
    font-size: 0.7rem;
    font-weight: 600;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.preset-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.preset-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.preset-max {
    color: var(--t-accent);
    font-weight: 700;
}

/* â”€â”€ Max multiplier display â”€â”€ */
.max-mult-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
}

.max-mult-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    color: var(--t-text-muted);
}

.max-mult-value {
    font-family: var(--font-mono, monospace);
    font-weight: 800;
    font-size: 1.1rem;
    color: var(--t-warning);
}

/* â”€â”€ Action buttons â”€â”€ */
.action-buttons {
    display: flex;
    gap: var(--t-space-2);
}

.drop-btn {
    flex: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-warning);
    color: var(--t-text-inverse);
    border: none;
    border-radius: var(--t-radius-md);
    font-size: 1rem;
    font-weight: 800;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.drop-btn:hover:not(:disabled) {
    filter: brightness(1.1);
}

.drop-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.auto-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 700;
    transition: all var(--t-transition-fast);
}

.auto-btn:hover {
    background: var(--t-bg-hover);
}

.auto-btn.active {
    background: var(--t-danger);
    color: var(--t-text);
    border-color: var(--t-danger);
}

.spin-icon {
    animation: spinAnim 1s linear infinite;
}

@keyframes spinAnim {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

/* â”€â”€ Result history â”€â”€ */
.result-history {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-3);
    box-shadow: var(--t-shadow-sm);
}

.history-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.history-chip {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: var(--t-radius-sm);
    font-family: var(--font-mono, monospace);
    font-size: 0.7rem;
    font-weight: 700;
    border: 1px solid;
}

.chip-win {
    background: var(--t-success-muted);
    color: var(--t-success);
}

.chip-lose {
    background: var(--t-bg-muted);
    color: var(--t-text-muted);
}

.chip-enter-active {
    transition: all 0.3s ease;
}

.chip-leave-active {
    transition: all 0.2s ease;
}

.chip-enter-from {
    transform: scale(0.8);
    opacity: 0;
}

.chip-leave-to {
    opacity: 0;
}

/* â”€â”€ Stats â”€â”€ */
.pk-stats {
    display: flex;
    gap: var(--t-space-4);
    justify-content: space-evenly;
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    box-shadow: var(--t-shadow-sm);
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.stat-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--t-text-muted);
}

.stat-value {
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 1rem;
}

.success {
    color: var(--t-success);
}

.danger {
    color: var(--t-danger);
}

/* â”€â”€ Transitions â”€â”€ */
.pop-enter-active {
    transition: all 0.35s ease;
}

.pop-leave-active {
    transition: all 0.2s ease;
}

.pop-enter-from {
    transform: translate(-50%, -50%) scale(0.8);
    opacity: 0;
}

.pop-leave-to {
    opacity: 0;
}

/* â”€â”€ Responsive â”€â”€ */
@media (max-width: 800px) {
    .pk-main {
        flex-direction: column;
        align-items: stretch;
    }

    .pk-controls-col {
        max-width: 100%;
    }
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\ResultBanner.vue ===
<script setup lang="ts">
import AppIcon from '@renderer/components/AppIcon.vue'

defineProps<{
    won: boolean
    amount: string
}>()
</script>

<template>
    <div class="result-banner" :class="won ? 'result-win' : 'result-lose'">
        <AppIcon :icon="won ? 'mdi:party-popper' : 'mdi:emoticon-sad'" class="result-icon" />
        <span>{{ won ? $t('gambling.won_amount', { amount }) : $t('gambling.lost_amount', { amount }) }}</span>
    </div>
</template>

<style scoped>
.result-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-5);
    border-radius: var(--t-radius-md);
    font-size: 1.25rem;
    font-weight: 700;
}

.result-win {
    background: var(--t-success-muted);
    border: 1px solid var(--t-success);
    color: var(--t-success);
}

.result-lose {
    background: var(--t-danger-muted);
    border: 1px solid var(--t-danger);
    color: var(--t-danger);
}

.result-icon {
    font-size: 1.75rem;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\RouletteBoard.vue ===
<script setup lang="ts">
import { computed } from 'vue'
import { useI18n } from 'vue-i18n'
import AppIcon from '@renderer/components/AppIcon.vue'

export type RouletteBetType =
    | 'straight'   // single number (36:1)
    | 'red'        // red   (1:1)
    | 'black'      // black (1:1)
    | 'odd'        // odd   (1:1)
    | 'even'       // even  (1:1)
    | 'low'        // 1-18  (1:1)
    | 'high'       // 19-36 (1:1)
    | 'dozen1'     // 1-12  (2:1)
    | 'dozen2'     // 13-24 (2:1)
    | 'dozen3'     // 25-36 (2:1)
    | 'col1'       // column 1 (2:1)
    | 'col2'       // column 2 (2:1)
    | 'col3'       // column 3 (2:1)

export interface RouletteBet {
    type: RouletteBetType
    number?: number    // only for 'straight'
    label: string
}

const props = defineProps<{
    activeBets: RouletteBet[]
    disabled?: boolean
}>()

const emit = defineEmits<{
    bet: [bet: RouletteBet]
}>()

const RED_NUMBERS = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36])

const { t } = useI18n()

function getColor(n: number): 'red' | 'black' | 'green' {
    if (n === 0) return 'green'
    return RED_NUMBERS.has(n) ? 'red' : 'black'
}

// Grid layout: 3 columns Ã— 12 rows (numbers 1-36)
const numberGrid = computed(() => {
    const rows: number[][] = []
    for (let row = 0; row < 12; row++) {
        const base = row * 3
        rows.push([base + 3, base + 2, base + 1]) // 3,2,1 / 6,5,4 ...
    }
    return rows
})

function isActive(type: RouletteBetType, number?: number): boolean {
    return props.activeBets.some(b => b.type === type && b.number === number)
}

function placeBet(type: RouletteBetType, number?: number): void {
    if (props.disabled) return
    const labels: Record<string, string> = {
        red: t('gambling.rl_red'), black: t('gambling.rl_black'), odd: t('gambling.rl_odd'), even: t('gambling.rl_even'),
        low: t('gambling.rl_low'), high: t('gambling.rl_high'),
        dozen1: t('gambling.rl_1st12'), dozen2: t('gambling.rl_2nd12'), dozen3: t('gambling.rl_3rd12'),
        col1: t('gambling.rl_col1'), col2: t('gambling.rl_col2'), col3: t('gambling.rl_col3'),
    }
    emit('bet', {
        type,
        number: type === 'straight' ? number : undefined,
        label: type === 'straight' ? `${number}` : labels[type] || type,
    })
}
</script>

<template>
    <div class="roulette-board" :class="{ disabled }">
        <!-- Zero -->
        <div class="board-zero" :class="{ active: isActive('straight', 0) }" @click="placeBet('straight', 0)">
            <span class="cell-num green">0</span>
        </div>

        <!-- Number grid -->
        <div class="board-grid">
            <template v-for="row in numberGrid" :key="row[0]">
                <div v-for="num in row" :key="num" class="board-cell" :class="{ active: isActive('straight', num) }"
                    @click="placeBet('straight', num)">
                    <span class="cell-num" :class="getColor(num)">{{ num }}</span>
                </div>
            </template>
        </div>

        <!-- Column bets (bottom of grid) -->
        <div class="board-columns">
            <div class="col-bet" :class="{ active: isActive('col1') }" @click="placeBet('col1')">{{
                $t('gambling.rl_2to1') }}
            </div>
            <div class="col-bet" :class="{ active: isActive('col2') }" @click="placeBet('col2')">{{
                $t('gambling.rl_2to1') }}
            </div>
            <div class="col-bet" :class="{ active: isActive('col3') }" @click="placeBet('col3')">{{
                $t('gambling.rl_2to1') }}
            </div>
        </div>

        <!-- Dozen bets -->
        <div class="board-dozens">
            <div class="dozen-bet" :class="{ active: isActive('dozen1') }" @click="placeBet('dozen1')">{{
                $t('gambling.rl_1st12') }}</div>
            <div class="dozen-bet" :class="{ active: isActive('dozen2') }" @click="placeBet('dozen2')">{{
                $t('gambling.rl_2nd12') }}</div>
            <div class="dozen-bet" :class="{ active: isActive('dozen3') }" @click="placeBet('dozen3')">{{
                $t('gambling.rl_3rd12') }}</div>
        </div>

        <!-- Outside bets -->
        <div class="board-outside">
            <div class="outside-bet" :class="{ active: isActive('low') }" @click="placeBet('low')">{{
                $t('gambling.rl_low') }}
            </div>
            <div class="outside-bet" :class="{ active: isActive('even') }" @click="placeBet('even')">{{
                $t('gambling.rl_even')
            }}</div>
            <div class="outside-bet color-bet red-bet" :class="{ active: isActive('red') }" @click="placeBet('red')">
                <AppIcon icon="mdi:diamond" />
            </div>
            <div class="outside-bet color-bet black-bet" :class="{ active: isActive('black') }"
                @click="placeBet('black')">
                <AppIcon icon="mdi:diamond" />
            </div>
            <div class="outside-bet" :class="{ active: isActive('odd') }" @click="placeBet('odd')">{{
                $t('gambling.rl_odd') }}
            </div>
            <div class="outside-bet" :class="{ active: isActive('high') }" @click="placeBet('high')">{{
                $t('gambling.rl_high')
            }}</div>
        </div>
    </div>
</template>

<style scoped>
.roulette-board {
    --roulette-red: var(--t-gamble-roulette-red);
    --roulette-black: var(--t-gamble-roulette-black);
    --roulette-green: var(--t-gamble-roulette-green);

    display: flex;
    flex-direction: column;
    gap: 2px;
    user-select: none;
}

.roulette-board.disabled {
    opacity: 0.5;
    pointer-events: none;
}

/* â”€â”€ Zero â”€â”€ */
.board-zero {
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md) var(--t-radius-md) 0 0;
    padding: var(--t-space-2);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.board-zero:hover {
    background: var(--t-bg-card-hover, var(--t-bg-hover));
}

.board-zero.active {
    box-shadow: inset 0 0 0 2px var(--t-accent);
}

/* â”€â”€ Number grid â”€â”€ */
.board-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2px;
}

.board-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--t-space-1) var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    cursor: pointer;
    transition: all var(--t-transition-fast);
    min-height: 32px;
}

.board-cell:hover {
    background: var(--t-bg-card-hover, var(--t-bg-hover));
    z-index: 1;
}

.board-cell.active {
    box-shadow: inset 0 0 0 2px var(--t-accent);
}

.cell-num {
    font-size: 0.8rem;
    font-weight: 700;
    font-family: var(--font-mono, monospace);
}

.cell-num.red {
    color: var(--roulette-red);
}

.cell-num.black {
    color: var(--t-text);
}

.cell-num.green {
    color: var(--roulette-green);
}

/* â”€â”€ Column bets â”€â”€ */
.board-columns {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2px;
}

.col-bet {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--t-space-1);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    cursor: pointer;
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--t-text-secondary);
    transition: all var(--t-transition-fast);
}

.col-bet:hover {
    background: var(--t-bg-card-hover, var(--t-bg-hover));
}

.col-bet.active {
    box-shadow: inset 0 0 0 2px var(--t-accent);
}

/* â”€â”€ Dozen bets â”€â”€ */
.board-dozens {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2px;
}

.dozen-bet {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--t-text-secondary);
    transition: all var(--t-transition-fast);
}

.dozen-bet:hover {
    background: var(--t-bg-card-hover, var(--t-bg-hover));
}

.dozen-bet.active {
    box-shadow: inset 0 0 0 2px var(--t-accent);
}

/* â”€â”€ Outside bets â”€â”€ */
.board-outside {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 2px;
    border-radius: 0 0 var(--t-radius-md) var(--t-radius-md);
    overflow: hidden;
}

.outside-bet {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    cursor: pointer;
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--t-text-secondary);
    transition: all var(--t-transition-fast);
}

.outside-bet:hover {
    background: var(--t-bg-card-hover, var(--t-bg-hover));
}

.outside-bet.active {
    box-shadow: inset 0 0 0 2px var(--t-accent);
}

.color-bet {
    font-size: 1rem;
}

.red-bet {
    color: var(--roulette-red);
}

.black-bet {
    color: var(--t-text);
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\RouletteGame.vue ===
<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import RouletteWheel from './RouletteWheel.vue'
import RouletteBoard from './RouletteBoard.vue'
import type { RouletteBet, RouletteBetType } from './RouletteBoard.vue'
import InfoPanel from '@renderer/components/layout/InfoPanel.vue'
import type { InfoSection } from '@renderer/components/layout/InfoPanel.vue'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'
import { usePlayerStore } from '@renderer/stores/usePlayerStore'
import { useGamblingStore } from '@renderer/stores/useGamblingStore'
import { D, ZERO, mul, add } from '@renderer/core/BigNum'
import type Decimal from 'break_infinity.js'

const emit = defineEmits<{ back: [] }>()
const { t } = useI18n()

const player = usePlayerStore()
const gambling = useGamblingStore()
const { formatCash } = useFormat()

// â”€â”€â”€ Roulette constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RED_NUMBERS = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36])

// Payout multipliers (payout = bet Ã— multiplier, includes the original bet)
const PAYOUT_MAP: Record<RouletteBetType, number> = {
    straight: 36,
    red: 2, black: 2,
    odd: 2, even: 2,
    low: 2, high: 2,
    dozen1: 3, dozen2: 3, dozen3: 3,
    col1: 3, col2: 3, col3: 3,
}

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const betAmount = ref(10)
const bets = ref<RouletteBet[]>([])
const spinning = ref(false)
const result = ref<number | null>(null)
const showResult = ref(false)
const lastPayout = ref<Decimal | null>(null)
const lastWinBets = ref<RouletteBet[]>([])
/** Luck triggered â€” shows clover animation between first loss and re-spin */
const luckyTriggered = ref(false)

// â”€â”€â”€ Bet management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onBet(bet: RouletteBet): void {
    if (spinning.value) return

    // Toggle: remove if already placed, add otherwise
    const idx = bets.value.findIndex(
        b => b.type === bet.type && b.number === bet.number
    )
    if (idx !== -1) {
        bets.value.splice(idx, 1)
    } else {
        bets.value.push(bet)
    }
}

function clearBets(): void {
    bets.value = []
}

const totalBetCost = computed(() => mul(D(betAmount.value), bets.value.length))
const canSpin = computed(() =>
    !spinning.value &&
    bets.value.length > 0 &&
    player.cash.gte(totalBetCost.value) &&
    betAmount.value > 0
)

// â”€â”€â”€ Spin logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function spin(): void {
    if (!canSpin.value) return

    const totalCost = totalBetCost.value
    if (!player.spendCash(totalCost)) return

    spinning.value = true
    showResult.value = false
    lastPayout.value = null
    lastWinBets.value = []
    luckyTriggered.value = false

    // Generate first result after a short delay (so wheel starts first)
    setTimeout(() => {
        const firstNum = Math.floor(Math.random() * 37) // 0-36
        const hasAnyWin = bets.value.some(b => isBetWinner(b, firstNum))

        if (hasAnyWin) {
            // Won on first roll â€” normal flow
            result.value = firstNum
        } else {
            // Lost â€” check luck second chance
            const luckBonus = gambling.getLuckBonus()
            const luckyReroll = luckBonus > 0 && Math.random() < luckBonus

            if (luckyReroll) {
                // Show losing spin first, then lucky banner, then re-spin
                result.value = firstNum
                // After wheel finishes (~4200ms), show lucky banner then re-spin
                setTimeout(() => {
                    luckyTriggered.value = true
                    setTimeout(() => {
                        luckyTriggered.value = false
                        // Re-spin with new number
                        spinning.value = true
                        showResult.value = false
                        const secondNum = Math.floor(Math.random() * 37)
                        setTimeout(() => {
                            result.value = secondNum
                        }, 200)
                    }, 1400) // lucky banner duration
                }, 4200) // wait for first wheel animation
                return
            } else {
                result.value = firstNum
            }
        }
    }, 200)
}

// When wheel finishes spinning, evaluate bets
watch(() => spinning.value, () => { })

// Detect when the RouletteWheel finishes its animation
// The wheel animation takes ~4s after result is set
watch(result, (num) => {
    if (num === null) return
    // Don't evaluate if lucky banner is showing (intermediate spin)
    if (luckyTriggered.value) return
    setTimeout(() => {
        // Double-check we're not in a lucky-triggered intermediate state
        if (!luckyTriggered.value) {
            evaluateResult(num)
        }
    }, 4200)
})

function evaluateResult(num: number): void {
    const betPerChip = D(betAmount.value)
    let totalPayout = ZERO
    const winningBets: RouletteBet[] = []

    for (const bet of bets.value) {
        if (isBetWinner(bet, num)) {
            const payout = mul(betPerChip, PAYOUT_MAP[bet.type])
            totalPayout = add(totalPayout, payout)
            winningBets.push(bet)
        }
    }

    if (totalPayout.gt(ZERO)) {
        player.earnCash(totalPayout)
        gambling.recordWin('roulette', totalBetCost.value, totalPayout)
        lastPayout.value = totalPayout
    } else {
        gambling.recordLoss('roulette', totalBetCost.value)
        lastPayout.value = null
    }

    lastWinBets.value = winningBets
    showResult.value = true
    spinning.value = false
}

function isBetWinner(bet: RouletteBet, num: number): boolean {
    switch (bet.type) {
        case 'straight': return bet.number === num
        case 'red': return num > 0 && RED_NUMBERS.has(num)
        case 'black': return num > 0 && !RED_NUMBERS.has(num)
        case 'odd': return num > 0 && num % 2 === 1
        case 'even': return num > 0 && num % 2 === 0
        case 'low': return num >= 1 && num <= 18
        case 'high': return num >= 19 && num <= 36
        case 'dozen1': return num >= 1 && num <= 12
        case 'dozen2': return num >= 13 && num <= 24
        case 'dozen3': return num >= 25 && num <= 36
        case 'col1': return num > 0 && num % 3 === 1
        case 'col2': return num > 0 && num % 3 === 2
        case 'col3': return num > 0 && num % 3 === 0
        default: return false
    }
}

function newRound(): void {
    result.value = null
    showResult.value = false
    lastPayout.value = null
    lastWinBets.value = []
}

// â”€â”€â”€ Bet helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setBet(amount: number): void {
    betAmount.value = Math.max(1, Math.min(amount, player.cash.toNumber()))
}

function halfBet(): void { setBet(Math.max(1, Math.floor(betAmount.value / 2))) }
function doubleBet(): void { setBet(betAmount.value * 2) }
function maxBet(): void { setBet(player.cash.toNumber()) }

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const stats = computed(() => gambling.getStats('roulette'))

function getResultColor(num: number): string {
    if (num === 0) return 'green'
    return RED_NUMBERS.has(num) ? 'red' : 'black'
}

// â”€â”€â”€ Info Panel data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const rouletteInfo = computed<InfoSection[]>(() => [
    {
        title: t('gambling.info.roulette.how_title'),
        icon: 'mdi:help-circle-outline',
        entries: [
            { term: t('gambling.info.roulette.european'), desc: t('gambling.info.roulette.european_desc'), icon: 'mdi:record-circle' },
            { term: t('gambling.info.roulette.placing_bets'), desc: t('gambling.info.roulette.placing_bets_desc'), icon: 'mdi:cursor-default-click' },
            { term: t('gambling.info.roulette.spin'), desc: t('gambling.info.roulette.spin_desc'), icon: 'mdi:rotate-right' },
        ]
    },
    {
        title: t('gambling.info.roulette.inside_title'),
        icon: 'mdi:grid',
        entries: [
            { term: t('gambling.info.roulette.straight'), desc: t('gambling.info.roulette.straight_desc'), icon: 'mdi:numeric' },
        ]
    },
    {
        title: t('gambling.info.roulette.outside_title'),
        icon: 'mdi:table-large',
        entries: [
            { term: t('gambling.info.roulette.red_black'), desc: t('gambling.info.roulette.red_black_desc'), icon: 'mdi:circle' },
            { term: t('gambling.info.roulette.even_odd'), desc: t('gambling.info.roulette.even_odd_desc'), icon: 'mdi:numeric-2-box-outline' },
            { term: t('gambling.info.roulette.high_low'), desc: t('gambling.info.roulette.high_low_desc'), icon: 'mdi:arrow-split-vertical' },
            { term: t('gambling.info.roulette.dozen'), desc: t('gambling.info.roulette.dozen_desc'), icon: 'mdi:numeric-12-box-outline' },
            { term: t('gambling.info.roulette.column'), desc: t('gambling.info.roulette.column_desc'), icon: 'mdi:view-column' },
        ]
    },
    {
        title: t('gambling.info.roulette.payout_title'),
        icon: 'mdi:cash-multiple',
        entries: [
            { term: t('gambling.info.roulette.pay_straight'), desc: t('gambling.info.roulette.pay_straight_desc'), icon: 'mdi:star-four-points' },
            { term: t('gambling.info.roulette.pay_outside'), desc: t('gambling.info.roulette.pay_outside_desc'), icon: 'mdi:circle-half-full' },
            { term: t('gambling.info.roulette.pay_dozen'), desc: t('gambling.info.roulette.pay_dozen_desc'), icon: 'mdi:view-grid' },
        ]
    },
])
</script>

<template>
    <div class="roulette-game">
        <!-- Header -->
        <div class="roulette-header">
            <button class="back-btn" @click="$emit('back')">
                <AppIcon icon="mdi:arrow-left" /> {{ $t('gambling.back') }}
            </button>
            <h2 class="roulette-title">
                <AppIcon icon="mdi:record-circle" class="title-icon" />
                {{ $t('gambling.rl_title') }}
            </h2>
            <div class="balance-chip">
                <AppIcon icon="mdi:cash" />
                {{ formatCash(player.cash) }}
            </div>
        </div>

        <!-- Main layout: wheel + board side by side -->
        <div class="roulette-body">
            <!-- Left: Wheel -->
            <div class="wheel-section">
                <RouletteWheel :result="result" :spinning="spinning" />

                <!-- Active bets summary -->
                <div class="bets-summary" v-if="bets.length > 0">
                    <div class="bets-chips">
                        <span v-for="(bet, i) in bets" :key="i" class="bet-chip">
                            {{ bet.label }}
                        </span>
                    </div>
                    <div class="bets-total">
                        {{ bets.length }} bet{{ bets.length > 1 ? 's' : '' }} Ã—
                        {{ formatCash(D(betAmount)) }} =
                        <strong>{{ formatCash(totalBetCost) }}</strong>
                    </div>
                </div>
            </div>

            <!-- Right: Board + controls -->
            <div class="board-section">
                <RouletteBoard :active-bets="bets" :disabled="spinning" @bet="onBet" />

                <!-- Bet controls -->
                <div class="controls-row">
                    <div class="bet-section">
                        <label class="bet-label">{{ $t('gambling.bet_per_chip') }}</label>
                        <div class="bet-row">
                            <button class="bet-adj" @click="halfBet">1/2</button>
                            <div class="bet-display">
                                <input type="number" v-model.number="betAmount" :min="1" :max="player.cash.toNumber()"
                                    class="bet-input" :disabled="spinning" />
                            </div>
                            <button class="bet-adj" @click="doubleBet">x2</button>
                        </div>
                        <div class="bet-presets">
                            <button v-for="pct in [10, 25, 50]" :key="pct" class="preset-btn"
                                @click="setBet(Math.floor(player.cash.toNumber() * pct / 100))" :disabled="spinning">
                                {{ pct }}%
                            </button>
                            <button class="preset-btn preset-max" @click="maxBet" :disabled="spinning">{{
                                $t('gambling.max') }}</button>
                        </div>
                    </div>

                    <div class="action-col">
                        <button class="spin-btn" :disabled="!canSpin" @click="spin">
                            <AppIcon :icon="spinning ? 'mdi:loading' : 'mdi:rotate-right'"
                                :class="{ 'spin-icon': spinning }" />
                            {{ spinning ? $t('gambling.rl_spinning') : $t('gambling.rl_spin') }}
                        </button>
                        <div class="action-row">
                            <button class="clear-btn" :disabled="spinning || bets.length === 0" @click="clearBets">
                                <AppIcon icon="mdi:close" /> {{ $t('gambling.rl_clear') }}
                            </button>
                            <button v-if="showResult" class="new-round-btn" @click="newRound">
                                <AppIcon icon="mdi:refresh" /> {{ $t('gambling.new_round') }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Banner -->
        <Transition name="fade">
            <div v-if="showResult" class="result-area">
                <div v-if="lastPayout" class="win-banner">
                    <AppIcon icon="mdi:trophy" class="win-icon" />
                    <div class="win-info">
                        <span class="win-num" :class="`num-${getResultColor(result!)}`">{{ result }}</span>
                        <span class="win-desc">
                            {{ $t('gambling.rl_bets_won', { n: lastWinBets.length }) }}
                            ({{lastWinBets.map(b => b.label).join(', ')}})
                        </span>
                        <span class="win-amount">{{ formatCash(lastPayout) }}</span>
                    </div>
                </div>
                <div v-else class="lose-banner">
                    <span class="lose-num" :class="`num-${getResultColor(result!)}`">{{ result }}</span>
                    <span>{{ $t('gambling.rl_no_winning') }}</span>
                </div>
            </div>
        </Transition>

        <!-- Lucky second chance banner -->
        <Transition name="lucky">
            <div v-if="luckyTriggered" class="lucky-banner">
                <AppIcon icon="mdi:clover" class="lucky-icon" />
                <span class="lucky-text">{{ $t('gambling.lucky_trigger') }}</span>
            </div>
        </Transition>

        <!-- Info Panel -->
        <InfoPanel :title="$t('gambling.rl_odds')" :sections="rouletteInfo" />

        <!-- Stats -->
        <div class="roulette-stats">
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_spins') }}</span>
                <span class="stat-value">{{ stats.played }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_wins') }}</span>
                <span class="stat-value">{{ stats.won }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_win_rate') }}</span>
                <span class="stat-value">
                    {{ stats.played > 0 ? Math.round(stats.won / stats.played * 100) : 0 }}%
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_net') }}</span>
                <span class="stat-value" :class="stats.netProfit.gte(0) ? 'success' : 'danger'">
                    {{ formatCash(stats.netProfit) }}
                </span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.roulette-game {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
    width: 100%;
    height: 100%;
    min-height: 0;
}

/* â”€â”€ Header â”€â”€ */
.roulette-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--t-space-3);
}

.back-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--t-transition-fast);
}

.back-btn:hover {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.roulette-title {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: 1.3rem;
    font-weight: 700;
}

.title-icon {
    font-size: 1.5rem;
    color: var(--t-accent);
}

.balance-chip {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-success);
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 0.85rem;
}

/* â”€â”€ Body (wheel + board) â”€â”€ */
.roulette-body {
    flex: 1;
    min-height: 0;
    display: flex;
    gap: var(--t-space-4);
    align-items: flex-start;
}

.wheel-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-4);
    min-width: 280px;
}

.board-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
    min-width: 0;
}

/* â”€â”€ Bets summary â”€â”€ */
.bets-summary {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    width: 100%;
}

.bets-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    justify-content: center;
}

.bet-chip {
    padding: 2px var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--t-text-secondary);
}

.bets-total {
    font-size: 0.8rem;
    color: var(--t-text-muted);
}

.bets-total strong {
    color: var(--t-accent);
}

/* â”€â”€ Controls â”€â”€ */
.controls-row {
    display: flex;
    gap: var(--t-space-3);
    align-items: center;
}

.bet-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-3);
    box-shadow: var(--t-shadow-sm);
}

.bet-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    color: var(--t-text-muted);
}

.bet-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.bet-adj {
    width: 36px;
    height: 36px;
    border-radius: var(--t-radius-md);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    color: var(--t-text);
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    transition: all var(--t-transition-fast);
}

.bet-adj:hover {
    background: var(--t-bg-hover);
}

.bet-display {
    flex: 1;
}

.bet-input {
    width: 100%;
    text-align: center;
    font-size: 1rem;
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text);
    outline: none;
}

.bet-presets {
    display: flex;
    gap: 4px;
}

.preset-btn {
    flex: 1;
    padding: var(--t-space-1) var(--t-space-2);
    font-size: 0.7rem;
    font-weight: 600;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.preset-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.preset-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.preset-max {
    color: var(--t-accent);
    font-weight: 700;
}

/* â”€â”€ Action buttons â”€â”€ */
.action-col {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    min-width: 130px;
}

.spin-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-accent);
    color: var(--t-text);
    border: none;
    border-radius: var(--t-radius-md);
    font-size: 1rem;
    font-weight: 800;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.spin-btn:hover:not(:disabled) {
    filter: brightness(1.1);
}

.spin-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.spin-icon {
    animation: spinAnim 1s linear infinite;
}

@keyframes spinAnim {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

.action-row {
    display: flex;
    gap: var(--t-space-2);
}

.clear-btn,
.new-round-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 600;
    transition: all var(--t-transition-fast);
}

.clear-btn:hover:not(:disabled),
.new-round-btn:hover {
    background: var(--t-bg-hover);
}

.clear-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.new-round-btn {
    color: var(--t-accent);
}

/* â”€â”€ Result â”€â”€ */
.result-area {
    min-height: 56px;
}

.win-banner {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-success-muted);
    border: 1px solid var(--t-success);
    border-radius: var(--t-radius-lg);
    animation: bannerPop 0.3s ease;
}

.win-icon {
    font-size: 2rem;
    color: var(--t-success);
}

.win-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.win-num,
.lose-num {
    font-size: 1.2rem;
    font-weight: 800;
    font-family: var(--font-mono, monospace);
}

.num-red {
    color: var(--t-gamble-roulette-red);
}

.num-black {
    color: var(--t-text);
}

.num-green {
    color: var(--t-gamble-roulette-green);
}

.win-desc {
    font-size: 0.85rem;
    color: var(--t-text-secondary);
}

.win-amount {
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--t-success);
    font-family: var(--font-mono, monospace);
}

.lose-banner {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    color: var(--t-text-muted);
    font-size: 0.9rem;
}

@keyframes bannerPop {
    0% {
        transform: scale(0.95);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* â”€â”€ Stats â”€â”€ */
.roulette-stats {
    display: flex;
    gap: var(--t-space-4);
    justify-content: space-evenly;
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    box-shadow: var(--t-shadow-sm);
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.stat-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--t-text-muted);
}

.stat-value {
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 1rem;
}

.success {
    color: var(--t-success);
}

.danger {
    color: var(--t-danger);
}

/* â”€â”€ Transitions â”€â”€ */
.fade-enter-active,
.fade-leave-active {
    transition: opacity 0.3s;
}

.fade-enter-from,
.fade-leave-to {
    opacity: 0;
}

/* â”€â”€ Lucky banner â”€â”€ */
.lucky-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-success) 15%, transparent), color-mix(in srgb, var(--t-success) 5%, transparent));
    border: 1px solid color-mix(in srgb, var(--t-success) 40%, transparent);
    box-shadow: 0 0 24px color-mix(in srgb, var(--t-success) 25%, transparent);
    animation: luckyPulse 0.8s ease infinite alternate;
}

.lucky-icon {
    font-size: 2rem;
    color: var(--t-success);
    animation: luckyCloverSpin 1s ease;
    filter: drop-shadow(0 0 6px color-mix(in srgb, var(--t-success) 50%, transparent));
}

.lucky-text {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--t-success);
    letter-spacing: 0.05em;
    text-shadow: 0 0 8px color-mix(in srgb, var(--t-success) 30%, transparent);
}

@keyframes luckyPulse {
    from {
        box-shadow: 0 0 16px color-mix(in srgb, var(--t-success) 20%, transparent);
    }

    to {
        box-shadow: 0 0 32px color-mix(in srgb, var(--t-success) 40%, transparent);
    }
}

@keyframes luckyCloverSpin {
    0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
    }

    50% {
        transform: scale(1.3) rotate(10deg);
        opacity: 1;
    }

    100% {
        transform: scale(1) rotate(0deg);
    }
}

.lucky-enter-active {
    animation: luckyIn 0.5s ease;
}

.lucky-leave-active {
    animation: luckyOut 0.3s ease;
}

@keyframes luckyIn {
    0% {
        transform: scale(0.5) translateY(-10px);
        opacity: 0;
    }

    60% {
        transform: scale(1.1) translateY(0);
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes luckyOut {
    to {
        transform: scale(0.8) translateY(10px);
        opacity: 0;
    }
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\RouletteWheel.vue ===
<script setup lang="ts">
import { ref, computed, watch } from 'vue'

const props = defineProps<{
    /** The winning number (0-36), null = idle */
    result: number | null
    /** Whether the wheel is currently spinning */
    spinning: boolean
}>()

// European roulette number order on the wheel
const WHEEL_ORDER = [
    0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36,
    11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9,
    22, 18, 29, 7, 28, 12, 35, 3, 26
]

const RED_NUMBERS = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36])

function getColor(n: number): string {
    if (n === 0) return 'green'
    return RED_NUMBERS.has(n) ? 'red' : 'black'
}

const SEGMENT_ANGLE = 360 / WHEEL_ORDER.length

// Current rotation of the wheel
const wheelRotation = ref(0)
const isAnimating = ref(false)

// When result changes, animate the spin
watch(() => props.result, (newResult) => {
    if (newResult === null || !props.spinning) return
    animateToNumber(newResult)
})

watch(() => props.spinning, (spin) => {
    if (spin && props.result === null) {
        // Start indefinite spin (will be stopped when result arrives)
        isAnimating.value = true
    }
})

function animateToNumber(num: number): void {
    const idx = WHEEL_ORDER.indexOf(num)
    if (idx === -1) return

    isAnimating.value = true

    // Where the wheel must stop so the center of this segment is under the pointer
    const targetAngle = -(idx * SEGMENT_ANGLE + SEGMENT_ANGLE / 2)

    // Normalise current & target to [0, 360)
    const curEff = ((wheelRotation.value % 360) + 360) % 360
    const tgtEff = ((targetAngle % 360) + 360) % 360

    // Delta: always negative (clockwise)
    let delta = tgtEff - curEff
    if (delta > 0) delta -= 360

    // Add 3-5 exact full rotations for drama
    const extraSpins = (3 + Math.floor(Math.random() * 3)) * 360

    wheelRotation.value += delta - extraSpins

    setTimeout(() => {
        isAnimating.value = false
    }, 4000)
}

const wheelStyle = computed(() => ({
    transform: `rotate(${wheelRotation.value}deg)`,
    transition: isAnimating.value
        ? 'transform 4s cubic-bezier(0.15, 0.6, 0.35, 1)'
        : 'none',
}))
</script>

<template>
    <div class="wheel-container">
        <!-- Pointer -->
        <div class="wheel-pointer"></div>

        <!-- Wheel -->
        <div class="wheel" :style="wheelStyle">
            <svg viewBox="0 0 400 400" class="wheel-svg">
                <g transform="translate(200,200)">
                    <template v-for="(num, i) in WHEEL_ORDER" :key="num">
                        <path :d="describeArc(0, 0, 190, i * SEGMENT_ANGLE - 90, (i + 1) * SEGMENT_ANGLE - 90)"
                            :fill="getColor(num) === 'red' ? 'var(--roulette-red)' : getColor(num) === 'black' ? 'var(--roulette-black)' : 'var(--roulette-green)'"
                            stroke="var(--t-bg-card)" stroke-width="1" />
                        <text :transform="`rotate(${i * SEGMENT_ANGLE + SEGMENT_ANGLE / 2}) translate(0, -165)`"
                            text-anchor="middle" dominant-baseline="central" fill="white" font-size="10"
                            font-weight="700">{{ num }}</text>
                    </template>
                    <!-- Center hub -->
                    <circle r="30" fill="var(--t-bg-card)" stroke="var(--t-border)" stroke-width="2" />
                    <circle r="12" fill="var(--t-bg-muted)" />
                </g>
            </svg>
        </div>

        <!-- Result overlay -->
        <Transition name="fade">
            <div v-if="result !== null && !isAnimating" class="result-chip" :class="`chip-${getColor(result)}`">
                {{ result }}
            </div>
        </Transition>
    </div>
</template>

<script lang="ts">
// SVG arc helper (outside setup for template use)
function polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {
    const rad = (angleDeg * Math.PI) / 180
    return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) }
}

function describeArc(cx: number, cy: number, r: number, startAngle: number, endAngle: number): string {
    const start = polarToCartesian(cx, cy, r, endAngle)
    const end = polarToCartesian(cx, cy, r, startAngle)
    const large = endAngle - startAngle > 180 ? 1 : 0
    return `M ${cx} ${cy} L ${start.x} ${start.y} A ${r} ${r} 0 ${large} 0 ${end.x} ${end.y} Z`
}
</script>

<style scoped>
.wheel-container {
    --roulette-red: var(--t-gamble-roulette-red);
    --roulette-black: var(--t-gamble-roulette-black);
    --roulette-green: var(--t-gamble-roulette-green);

    position: relative;
    width: 100%;
    max-width: 340px;
    aspect-ratio: 1;
    margin: 0 auto;
}

.wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    overflow: hidden;
    box-shadow: 0 0 0 6px var(--t-border), 0 0 0 10px var(--t-bg-muted);
}

.wheel-svg {
    width: 100%;
    height: 100%;
    display: block;
}

.wheel-pointer {
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 20px solid var(--t-accent);
    z-index: 5;
    filter: drop-shadow(0 2px 4px var(--t-overlay-light));
}

.result-chip {
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    min-width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--t-text);
    border: 3px solid var(--t-bg-card);
    box-shadow: 0 2px 12px var(--t-overlay-light);
    z-index: 6;
}

.chip-red {
    background: var(--roulette-red);
}

.chip-black {
    background: var(--roulette-black);
}

.chip-green {
    background: var(--roulette-green);
}

.fade-enter-active,
.fade-leave-active {
    transition: opacity 0.3s;
}

.fade-enter-from,
.fade-leave-to {
    opacity: 0;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\SlotLever.vue ===
<script setup lang="ts">
import { ref, computed } from 'vue'

const props = defineProps<{
    disabled?: boolean
    spinning?: boolean
}>()

const emit = defineEmits<{ pull: [] }>()

// Lever state: idle â†’ pulling (drag down) â†’ release (spring back) â†’ idle
const leverEl = ref<HTMLElement | null>(null)
const isDragging = ref(false)
const pullProgress = ref(0) // 0..1

const PULL_THRESHOLD = 0.7 // must pull past 70% to trigger
const TRACK_HEIGHT = 140
const HANDLE_SIZE = 48
const HANDLE_OFFSET = -6
const TRAVEL = TRACK_HEIGHT - HANDLE_SIZE + 12 // max px the handle can slide

const leverStyle = computed(() => ({
    transform: `translateY(${pullProgress.value * TRAVEL}px)`,
    transition: isDragging.value ? 'none' : 'transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)',
}))

const trackFillStyle = computed(() => {
    const handleCenter = HANDLE_OFFSET + HANDLE_SIZE / 2 + pullProgress.value * TRAVEL
    return {
        height: `${Math.max(0, handleCenter)}px`,
        transition: isDragging.value ? 'none' : 'height 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)',
    }
})

let startY = 0
let trackHeight = 0

function onPointerDown(e: PointerEvent): void {
    if (props.disabled || props.spinning) return
    isDragging.value = true
    startY = e.clientY
    const track = leverEl.value?.parentElement
    trackHeight = track?.getBoundingClientRect().height ?? 200

    document.addEventListener('pointermove', onPointerMove)
    document.addEventListener('pointerup', onPointerUp)
        ; (e.target as HTMLElement)?.setPointerCapture?.(e.pointerId)
}

function onPointerMove(e: PointerEvent): void {
    if (!isDragging.value) return
    const delta = e.clientY - startY
    pullProgress.value = Math.max(0, Math.min(1, delta / (trackHeight * 0.7)))
}

function onPointerUp(): void {
    isDragging.value = false
    document.removeEventListener('pointermove', onPointerMove)
    document.removeEventListener('pointerup', onPointerUp)

    if (pullProgress.value >= PULL_THRESHOLD) {
        emit('pull')
    }

    // Spring back
    pullProgress.value = 0
}

const canPull = computed(() => !props.disabled && !props.spinning)
</script>

<template>
    <div class="lever-wrapper" :class="{ disabled: !canPull, spinning: spinning }">
        <div class="lever-track">
            <!-- Fill that follows the pull -->
            <div class="lever-track-fill" :style="trackFillStyle"></div>

            <!-- The handle -->
            <div ref="leverEl" class="lever-handle" :style="leverStyle"
                :class="{ dragging: isDragging, glow: canPull && !isDragging }" @pointerdown.prevent="onPointerDown">
                <div class="handle-grip">
                    <div class="grip-line"></div>
                    <div class="grip-line"></div>
                    <div class="grip-line"></div>
                </div>
            </div>
        </div>

        <!-- Label -->
        <span class="lever-label" :class="{ active: isDragging }">
            {{ spinning ? $t('gambling.sl_spinning') : $t('gambling.sl_pull') }}
        </span>
    </div>
</template>

<style scoped>
.lever-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-2);
    user-select: none;
    touch-action: none;
}

.lever-wrapper.disabled {
    opacity: 0.4;
    pointer-events: none;
}

.lever-track {
    position: relative;
    width: 12px;
    height: 140px;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    overflow: visible;
}

.lever-track-fill {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    background: var(--t-accent);
    opacity: 0.25;
    border-radius: var(--t-radius-lg) var(--t-radius-lg) 0 0;
}

.lever-handle {
    position: absolute;
    top: -6px;
    left: 50%;
    margin-left: -24px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--t-accent);
    border: 3px solid var(--t-bg-card);
    box-shadow: 0 2px 8px var(--t-overlay-light);
    cursor: grab;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
    z-index: 2;
}

.lever-handle.dragging {
    cursor: grabbing;
    box-shadow: 0 4px 16px var(--t-overlay-light);
}

.lever-handle.glow {
    animation: leverPulse 2s ease-in-out infinite;
}

@keyframes leverPulse {

    0%,
    100% {
        box-shadow: 0 2px 8px var(--t-overlay-light);
    }

    50% {
        box-shadow: 0 2px 12px var(--t-accent), 0 0 20px var(--t-blue-muted);
    }
}

.handle-grip {
    display: flex;
    flex-direction: column;
    gap: 3px;
    align-items: center;
}

.grip-line {
    width: 16px;
    height: 2px;
    background: color-mix(in srgb, var(--t-text) 50%, transparent);
    border-radius: 1px;
}

.lever-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    font-weight: 700;
    color: var(--t-text-muted);
    transition: color 0.2s;
}

.lever-label.active {
    color: var(--t-accent);
}

.lever-wrapper.spinning .lever-label {
    animation: spinText 1s ease-in-out infinite;
}

@keyframes spinText {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.4;
    }
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\gambling\SlotMachine.vue ===
<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import SlotLever from './SlotLever.vue'
import { useFormat } from '@renderer/composables/useFormat'
import { usePlayerStore } from '@renderer/stores/usePlayerStore'
import { useGamblingStore } from '@renderer/stores/useGamblingStore'
import { D, ZERO, mul } from '@renderer/core/BigNum'
import type Decimal from 'break_infinity.js'
import { THEME } from '@renderer/assets/theme/colors'

const emit = defineEmits<{ back: [] }>()

const player = usePlayerStore()
const gambling = useGamblingStore()
const { formatCash } = useFormat()

// â”€â”€â”€ Symbol definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
interface SlotSymbol {
    id: string
    icon: string       // Iconify icon id
    label: string
    color: string
    weight: number
}

const SYMBOLS: SlotSymbol[] = [
    { id: 'cherry', icon: 'mdi:fruit-cherries', label: 'Cherry', color: THEME.danger, weight: 25 },
    { id: 'lemon', icon: 'mdi:fruit-citrus', label: 'Lemon', color: THEME.gold, weight: 22 },
    { id: 'orange', icon: 'mdi:food-apple', label: 'Orange', color: THEME.orange, weight: 20 },
    { id: 'grape', icon: 'mdi:fruit-grapes', label: 'Grape', color: THEME.purple, weight: 17 },
    { id: 'bell', icon: 'mdi:bell', label: 'Bell', color: THEME.warning, weight: 10 },
    { id: 'bar', icon: 'mdi:view-dashboard', label: 'BAR', color: THEME.blue, weight: 4 },
    { id: 'seven', icon: 'mdi:numeric-7-box', label: '7', color: THEME.danger, weight: 2 },
]

const TOTAL_WEIGHT = SYMBOLS.reduce((s, sym) => s + sym.weight, 0)

// â”€â”€â”€ Paytable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// New rules:
// - 2 horizontal match â†’ Ã—1
// - Pyramid (row 0+2 same + row 1 center same) â†’ Ã—2
// - 3 horizontal top/bottom or diagonal â†’ Ã—5
// - 3 horizontal center â†’ Ã—10
// - 777 horizontal center â†’ Ã—100
interface PaytableEntry {
    description: string
    multiplier: number
    pattern: string      // visual identifier for the paytable
}

const PAYTABLE: PaytableEntry[] = [
    { description: '777 on center row', multiplier: 100, pattern: '7-7-7 center' },
    { description: '3 match â€” center row', multiplier: 10, pattern: 'X-X-X center' },
    { description: '3 match â€” top/bottom row', multiplier: 5, pattern: 'X-X-X top/bottom' },
    { description: '3 match â€” diagonal', multiplier: 5, pattern: 'X-X-X diagonal' },
    { description: 'Pyramid (top+bottom & center match)', multiplier: 2, pattern: 'pyramid' },
    { description: '2 adjacent match â€” horizontal', multiplier: 1, pattern: 'X-X adjacent' },
]

// â”€â”€â”€ Reel configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const REEL_COUNT = 3
const VISIBLE_ROWS = 3
const REEL_SYMBOL_COUNT = 20
const SPIN_DURATION_BASE = 1200
const SPIN_STAGGER = 400

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const betAmount = ref(10)
const spinning = ref(false)
const autoSpin = ref(false)
const autoSpinCount = ref(0)

const reelStrips = ref<SlotSymbol[][]>([])
const reelPositions = ref<number[]>([0, 0, 0])
const reelStopped = ref<boolean[]>([true, true, true])

// Result state
const resultGrid = ref<SlotSymbol[][]>([[], [], []]) // 3 reels Ã— 3 visible rows
const winResult = ref<{ multiplier: number; description: string; payout: Decimal } | null>(null)
const showResult = ref(false)
const justWon = ref(false)
const luckyTriggered = ref(false)

// Winning cell coordinates: Set of "reel,row" strings
const winningCells = ref<Set<string>>(new Set())

// â”€â”€â”€ Build virtual reel strips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildReelStrip(): SlotSymbol[] {
    const strip: SlotSymbol[] = []
    for (const sym of SYMBOLS) {
        const count = Math.round((sym.weight / TOTAL_WEIGHT) * REEL_SYMBOL_COUNT)
        for (let i = 0; i < Math.max(1, count); i++) {
            strip.push(sym)
        }
    }
    for (let i = strip.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1))
            ;[strip[i], strip[j]] = [strip[j], strip[i]]
    }
    return strip
}

function initReels(): void {
    reelStrips.value = Array.from({ length: REEL_COUNT }, () => buildReelStrip())
    for (let r = 0; r < REEL_COUNT; r++) {
        reelPositions.value[r] = 0
        updateVisibleSymbols(r)
    }
}

function updateVisibleSymbols(reelIndex: number): void {
    const strip = reelStrips.value[reelIndex]
    if (!strip || strip.length === 0) return
    const pos = reelPositions.value[reelIndex]
    const visible: SlotSymbol[] = []
    for (let row = 0; row < VISIBLE_ROWS; row++) {
        visible.push(strip[(pos + row) % strip.length])
    }
    resultGrid.value[reelIndex] = visible
}

function pickSymbol(): SlotSymbol {
    let rand = Math.random() * TOTAL_WEIGHT
    for (const sym of SYMBOLS) {
        rand -= sym.weight
        if (rand <= 0) return sym
    }
    return SYMBOLS[0]
}

// â”€â”€â”€ Payline evaluation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// grid[reelIndex][rowIndex]
// Returns all winning lines with their contributing cells
interface WinLine {
    multiplier: number
    description: string
    cells: [number, number][] // [reel, row] pairs
}

function evaluateGrid(grid: SlotSymbol[][]): WinLine[] {
    const wins: WinLine[] = []

    // Helper: check if 3 symbols match
    const match3 = (a: SlotSymbol, b: SlotSymbol, c: SlotSymbol) => a.id === b.id && b.id === c.id
    // Helper: check if 2 ADJACENT symbols match (only pos 0-1 or 1-2, never 0-2)
    const match2adjacent = (syms: SlotSymbol[]): number[] => {
        if (syms[0].id === syms[1].id) return [0, 1]
        if (syms[1].id === syms[2].id) return [1, 2]
        return []
    }

    // â”€â”€ 1. 777 center row (Ã—100) â”€â”€
    const centerRow = [grid[0][1], grid[1][1], grid[2][1]]
    if (match3(centerRow[0], centerRow[1], centerRow[2]) && centerRow[0].id === 'seven') {
        wins.push({
            multiplier: 100,
            description: '777 JACKPOT!',
            cells: [[0, 1], [1, 1], [2, 1]],
        })
        return wins // Jackpot overrides everything
    }

    // â”€â”€ 2. 3 match center row (Ã—10) â”€â”€
    if (match3(centerRow[0], centerRow[1], centerRow[2])) {
        wins.push({
            multiplier: 10,
            description: `3x ${centerRow[0].label} â€” center`,
            cells: [[0, 1], [1, 1], [2, 1]],
        })
    }

    // â”€â”€ 3. 3 match top row (Ã—5) â”€â”€
    const topRow = [grid[0][0], grid[1][0], grid[2][0]]
    if (match3(topRow[0], topRow[1], topRow[2])) {
        wins.push({
            multiplier: 5,
            description: `3x ${topRow[0].label} â€” top`,
            cells: [[0, 0], [1, 0], [2, 0]],
        })
    }

    // â”€â”€ 4. 3 match bottom row (Ã—5) â”€â”€
    const bottomRow = [grid[0][2], grid[1][2], grid[2][2]]
    if (match3(bottomRow[0], bottomRow[1], bottomRow[2])) {
        wins.push({
            multiplier: 5,
            description: `3x ${bottomRow[0].label} â€” bottom`,
            cells: [[0, 2], [1, 2], [2, 2]],
        })
    }

    // â”€â”€ 5. Diagonal top-left â†’ bottom-right (Ã—5) â”€â”€
    const diag1 = [grid[0][0], grid[1][1], grid[2][2]]
    if (match3(diag1[0], diag1[1], diag1[2])) {
        wins.push({
            multiplier: 5,
            description: `3x ${diag1[0].label} â€” diagonal`,
            cells: [[0, 0], [1, 1], [2, 2]],
        })
    }

    // â”€â”€ 6. Diagonal bottom-left â†’ top-right (Ã—5) â”€â”€
    const diag2 = [grid[0][2], grid[1][1], grid[2][0]]
    if (match3(diag2[0], diag2[1], diag2[2])) {
        wins.push({
            multiplier: 5,
            description: `3x ${diag2[0].label} â€” diagonal`,
            cells: [[0, 2], [1, 1], [2, 0]],
        })
    }

    // â”€â”€ 7. Pyramid (Ã—2) â”€â”€
    // Center column center slot + two lateral slots from top or bottom row, all 3 equal
    // V-down: left-top [0,0], right-top [2,0], center [1,1]
    const vDown = [grid[0][0], grid[2][0], grid[1][1]]
    if (match3(vDown[0], vDown[1], vDown[2])) {
        wins.push({
            multiplier: 2,
            description: `Pyramid ${vDown[0].label}`,
            cells: [[0, 0], [2, 0], [1, 1]],
        })
    }
    // V-up: bottom-left, bottom-right, center = [0,2], [2,2], [1,1]
    const vUp = [grid[0][2], grid[2][2], grid[1][1]]
    if (match3(vUp[0], vUp[1], vUp[2])) {
        wins.push({
            multiplier: 2,
            description: `Pyramid ${vUp[0].label}`,
            cells: [[0, 2], [2, 2], [1, 1]],
        })
    }

    // â”€â”€ 8. 2 match horizontal â€” any row (Ã—1) â”€â”€
    // Only if no 3-match was found on that row
    const rows: { row: number; syms: SlotSymbol[] }[] = [
        { row: 0, syms: topRow },
        { row: 1, syms: centerRow },
        { row: 2, syms: bottomRow },
    ]
    for (const { row, syms } of rows) {
        // Skip if this row already has a 3-match win
        const has3 = wins.some(w =>
            w.cells.length === 3 &&
            w.cells.every(([, r]) => r === row) &&
            w.multiplier >= 5
        )
        if (has3) continue

        const pair = match2adjacent(syms)
        if (pair.length === 2) {
            wins.push({
                multiplier: 1,
                description: `2x ${syms[pair[0]].label}`,
                cells: pair.map(i => [i, row] as [number, number]),
            })
        }
    }

    return wins
}

// â”€â”€â”€ Spin logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function spin(): Promise<void> {
    const bet = D(betAmount.value)
    if (bet.lte(ZERO) || player.cash.lt(bet) || spinning.value) return
    if (!player.spendCash(bet)) return

    spinning.value = true
    showResult.value = false
    winResult.value = null
    justWon.value = false
    winningCells.value = new Set()
    reelStopped.value = [false, false, false]
    luckyTriggered.value = false

    // Determine final symbols for each reel (3 rows each)
    let finalGrid: SlotSymbol[][] = []
    for (let r = 0; r < REEL_COUNT; r++) {
        finalGrid.push([pickSymbol(), pickSymbol(), pickSymbol()])
    }

    // Luck gives second chance on loss
    let testWins = evaluateGrid(finalGrid)
    let luckyRespin = false
    if (testWins.length === 0) {
        const luckBonus = gambling.getLuckBonus()
        if (luckBonus > 0 && Math.random() < luckBonus) {
            luckyRespin = true
        }
    }

    if (luckyRespin) {
        // Show initial losing grid, then lucky banner, then re-spin
        const losingGrid = finalGrid

        // Animate to losing grid first
        const spinPromises1 = losingGrid.map((finalSymbols, reelIdx) =>
            animateReel(reelIdx, finalSymbols, SPIN_DURATION_BASE + reelIdx * SPIN_STAGGER)
        )
        await Promise.all(spinPromises1)
        resultGrid.value = losingGrid

        // Show lucky banner
        luckyTriggered.value = true
        await new Promise(resolve => setTimeout(resolve, 1400))
        luckyTriggered.value = false

        // Generate new re-roll grid
        finalGrid = []
        for (let r = 0; r < REEL_COUNT; r++) {
            finalGrid.push([pickSymbol(), pickSymbol(), pickSymbol()])
        }

        // Re-spin animation
        reelStopped.value = [false, false, false]
        const spinPromises2 = finalGrid.map((finalSymbols, reelIdx) =>
            animateReel(reelIdx, finalSymbols, SPIN_DURATION_BASE + reelIdx * SPIN_STAGGER)
        )
        await Promise.all(spinPromises2)
    } else {
        // Normal spin â€” animate to final grid
        const spinPromises = finalGrid.map((finalSymbols, reelIdx) =>
            animateReel(reelIdx, finalSymbols, SPIN_DURATION_BASE + reelIdx * SPIN_STAGGER)
        )
        await Promise.all(spinPromises)
    }

    // All reels stopped â€” evaluate
    resultGrid.value = finalGrid
    const winLines = evaluateGrid(finalGrid)

    if (winLines.length > 0) {
        const totalMultiplier = winLines.reduce((sum, w) => sum + w.multiplier, 0)
        const payout = mul(bet, totalMultiplier)

        // Collect all winning cells
        const cells = new Set<string>()
        for (const w of winLines) {
            for (const [reel, row] of w.cells) {
                cells.add(`${reel},${row}`)
            }
        }
        winningCells.value = cells

        player.earnCash(payout)
        gambling.recordWin('slots', bet, payout)

        const bestLine = winLines.reduce((best, w) => w.multiplier > best.multiplier ? w : best)
        winResult.value = {
            multiplier: totalMultiplier,
            description: winLines.length === 1
                ? bestLine.description
                : `${winLines.length} wins! Best: ${bestLine.description}`,
            payout,
        }
        justWon.value = true
    } else {
        gambling.recordLoss('slots', bet)
        winResult.value = null
    }

    showResult.value = true
    spinning.value = false

    // Continue auto-spin
    if (autoSpin.value) {
        autoSpinCount.value++
        if (player.cash.gte(bet)) {
            setTimeout(() => {
                if (autoSpin.value) spin()
            }, 800)
        } else {
            autoSpin.value = false
        }
    }
}

// â”€â”€â”€ Reel animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animateReel(reelIdx: number, finalSymbols: SlotSymbol[], duration: number): Promise<void> {
    return new Promise((resolve) => {
        const startTime = performance.now()
        const cycleInterval = 60

        function tick(): void {
            const elapsed = performance.now() - startTime
            const progress = Math.min(1, elapsed / duration)

            if (progress < 1) {
                const speed = cycleInterval + progress * 200
                const row: SlotSymbol[] = [pickSymbol(), pickSymbol(), pickSymbol()]
                resultGrid.value[reelIdx] = row
                setTimeout(tick, speed * (0.5 + progress * 0.5))
            } else {
                resultGrid.value[reelIdx] = finalSymbols
                reelStopped.value[reelIdx] = true
                resolve()
            }
        }

        tick()
    })
}

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function isWinningCell(reel: number, row: number): boolean {
    return winningCells.value.has(`${reel},${row}`)
}

function setBet(amount: number): void {
    betAmount.value = Math.max(1, Math.min(amount, player.cash.toNumber()))
}

function halfBet(): void {
    setBet(Math.max(1, Math.floor(betAmount.value / 2)))
}

function doubleBet(): void {
    setBet(betAmount.value * 2)
}

function maxBet(): void {
    setBet(player.cash.toNumber())
}

function toggleAutoSpin(): void {
    if (autoSpin.value) {
        autoSpin.value = false
    } else {
        autoSpinCount.value = 0
        autoSpin.value = true
        if (!spinning.value) spin()
    }
}

// â”€â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const stats = computed(() => gambling.getStats('slots'))
const canSpin = computed(() => !spinning.value && player.cash.gte(D(betAmount.value)) && betAmount.value > 0)
const showPaytable = ref(false)

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initReels()

watch(() => player.cash, (cash) => {
    if (autoSpin.value && cash.lt(D(betAmount.value))) {
        autoSpin.value = false
    }
})
</script>

<template>
    <div class="slot-machine">
        <!-- Header -->
        <div class="slot-header">
            <button class="back-btn" @click="$emit('back')">
                <AppIcon icon="mdi:arrow-left" /> {{ $t('gambling.back') }}
            </button>
            <h2 class="slot-title">
                <AppIcon icon="mdi:slot-machine" class="title-icon" />
                {{ $t('gambling.sl_title') }}
            </h2>
            <button class="paytable-toggle" @click="showPaytable = !showPaytable">
                <AppIcon icon="mdi:table" /> {{ showPaytable ? $t('gambling.hide') : $t('gambling.sl_paytable') }}
            </button>
        </div>

        <!-- Paytable (collapsible) -->
        <Transition name="slide">
            <div v-if="showPaytable" class="paytable-panel">
                <h3 class="paytable-title">{{ $t('gambling.sl_paytable_title') }}</h3>
                <div class="paytable-grid">
                    <div v-for="entry in PAYTABLE" :key="entry.description" class="paytable-entry">
                        <span class="pt-pattern">{{ entry.pattern }}</span>
                        <span class="pt-desc">{{ entry.description }}</span>
                        <span class="pt-multi">x{{ entry.multiplier }}</span>
                    </div>
                </div>
                <p class="paytable-note">{{ $t('gambling.sl_paytable_note') }}</p>
            </div>
        </Transition>

        <!-- Reel area + Lever -->
        <div class="machine-body">
            <div class="reels-frame">
                <div class="reels-container">
                    <div v-for="(reel, ri) in resultGrid" :key="ri" class="reel"
                        :class="{ spinning: !reelStopped[ri] && spinning }">
                        <div v-for="(sym, si) in reel" :key="si" class="reel-cell" :class="{
                            dim: spinning && !reelStopped[ri],
                            'win-cell': showResult && justWon && isWinningCell(ri, si),
                        }">
                            <AppIcon :icon="sym.icon" class="symbol-icon" :style="{ color: sym.color }"
                                :class="{ 'symbol-bounce': showResult && justWon && isWinningCell(ri, si) }" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lever -->
            <div class="lever-area">
                <SlotLever :disabled="!canSpin" :spinning="spinning" @pull="spin" />
            </div>
        </div>

        <!-- Result Banner -->
        <Transition name="fade">
            <div v-if="showResult" class="result-area">
                <div v-if="winResult" class="win-banner">
                    <AppIcon icon="mdi:trophy" class="win-icon" />
                    <div class="win-info">
                        <span class="win-desc">{{ winResult.description }}</span>
                        <span class="win-amount">{{ formatCash(winResult.payout) }}</span>
                        <span class="win-multi">x{{ winResult.multiplier }} {{ $t('gambling.sl_multiplier_suffix')
                        }}</span>
                    </div>
                </div>
                <div v-else class="lose-banner">
                    <AppIcon icon="mdi:emoticon-neutral" class="lose-icon" />
                    <span>{{ $t('gambling.sl_no_match') }}</span>
                </div>
            </div>
        </Transition>

        <!-- Lucky second chance banner -->
        <Transition name="lucky">
            <div v-if="luckyTriggered" class="lucky-banner">
                <AppIcon icon="mdi:clover" class="lucky-icon" />
                <span class="lucky-text">{{ $t('gambling.lucky_trigger') }}</span>
            </div>
        </Transition>

        <!-- Controls -->
        <div class="controls-area">
            <div class="bet-section">
                <label class="bet-label">{{ $t('gambling.bet') }}</label>
                <div class="bet-row">
                    <button class="bet-adj" @click="halfBet">1/2</button>
                    <div class="bet-display">
                        <input type="number" v-model.number="betAmount" :min="1" :max="player.cash.toNumber()"
                            class="bet-input" :disabled="spinning" />
                    </div>
                    <button class="bet-adj" @click="doubleBet">x2</button>
                </div>
                <div class="bet-presets">
                    <button v-for="pct in [10, 25, 50]" :key="pct" class="preset-btn"
                        @click="setBet(Math.floor(player.cash.toNumber() * pct / 100))" :disabled="spinning">
                        {{ pct }}%
                    </button>
                    <button class="preset-btn preset-max" @click="maxBet" :disabled="spinning">{{ $t('gambling.max')
                    }}</button>
                </div>
            </div>

            <button class="auto-btn" :class="{ active: autoSpin }" @click="toggleAutoSpin">
                <AppIcon icon="mdi:autorenew" :class="{ 'spin-icon': autoSpin }" />
                {{ autoSpin ? $t('gambling.sl_auto_count', { n: autoSpinCount }) : $t('gambling.sl_auto') }}
            </button>
        </div>

        <!-- Stats -->
        <div class="slot-stats">
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_spins') }}</span>
                <span class="stat-value">{{ stats.played }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_wins') }}</span>
                <span class="stat-value">{{ stats.won }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_win_rate') }}</span>
                <span class="stat-value">{{ stats.played > 0 ? Math.round(stats.won / stats.played * 100) : 0 }}%</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">{{ $t('gambling.stats_net') }}</span>
                <span class="stat-value" :class="stats.netProfit.gte(0) ? 'success' : 'danger'">
                    {{ formatCash(stats.netProfit) }}
                </span>
            </div>
        </div>
    </div>
</template>

<style scoped>
.slot-machine {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
    width: 100%;
    height: 100%;
    min-height: 0;
}

/* â”€â”€ Header â”€â”€ */
.slot-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--t-space-3);
}

.back-btn,
.paytable-toggle {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--t-transition-fast);
}

.back-btn:hover,
.paytable-toggle:hover {
    background: var(--t-bg-hover);
    color: var(--t-text);
}

.slot-title {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: 1.3rem;
    font-weight: 700;
}

.title-icon {
    font-size: 1.5rem;
    color: var(--t-accent);
}

/* â”€â”€ Paytable â”€â”€ */
.paytable-panel {
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-4);
}

.paytable-title {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: var(--t-space-3);
    color: var(--t-text-secondary);
}

.paytable-grid {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-1);
}

.paytable-entry {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-1) var(--t-space-2);
    border-radius: var(--t-radius-sm);
}

.paytable-entry:nth-child(odd) {
    background: var(--t-bg-muted);
}

.pt-pattern {
    font-family: var(--font-mono, monospace);
    font-size: 0.75rem;
    min-width: 110px;
    color: var(--t-text-muted);
}

.pt-desc {
    flex: 1;
    font-size: 0.85rem;
    color: var(--t-text-secondary);
}

.pt-multi {
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    color: var(--t-accent);
    font-size: 0.95rem;
}

.paytable-note {
    margin-top: var(--t-space-2);
    font-size: 0.75rem;
    color: var(--t-text-muted);
    font-style: italic;
}

/* â”€â”€ Machine Body (reels + lever) â”€â”€ */
.machine-body {
    flex: 1;
    min-height: 0;
    display: flex;
    gap: var(--t-space-3);
    align-items: stretch;
}

.lever-area {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--t-space-2) 0;
}

/* â”€â”€ Reels â”€â”€ */
.reels-frame {
    position: relative;
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-4);
    overflow: hidden;
}

.reels-container {
    flex: 1;
    display: flex;
    gap: var(--t-space-3);
    justify-content: center;
    align-items: stretch;
}

.reel {
    flex: 1;
    max-width: 200px;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    background: var(--t-bg-muted);
    border-radius: var(--t-radius-md);
    padding: var(--t-space-3);
    transition: background 0.2s;
}

.reel.spinning {
    background: var(--t-bg-muted);
}

.reel-cell {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 72px;
    border-radius: var(--t-radius-md);
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.reel-cell.dim {
    opacity: 0.5;
}

.reel-cell.win-cell {
    background: var(--t-success-muted);
    box-shadow: 0 0 16px var(--t-success-muted);
}

.symbol-icon {
    font-size: clamp(2rem, 4vw, 3.5rem);
    line-height: 1;
    user-select: none;
    transition: transform 0.2s;
}

.symbol-bounce {
    animation: bounce 0.5s ease;
}

@keyframes bounce {

    0%,
    100% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.3);
    }
}

/* â”€â”€ Result â”€â”€ */
.result-area {
    min-height: 60px;
}

.win-banner {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-success-muted);
    border: 1px solid var(--t-success);
    border-radius: var(--t-radius-lg);
    animation: bannerPop 0.3s ease;
}

.win-icon {
    font-size: 2rem;
    color: var(--t-success);
}

.win-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.win-desc {
    font-size: 0.85rem;
    color: var(--t-text-secondary);
}

.win-amount {
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--t-success);
    font-family: var(--font-mono, monospace);
}

.win-multi {
    font-size: 0.75rem;
    color: var(--t-text-muted);
}

.lose-banner {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    color: var(--t-text-muted);
    font-size: 0.9rem;
}

.lose-icon {
    font-size: 1.5rem;
}

@keyframes bannerPop {
    0% {
        transform: scale(0.95);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* â”€â”€ Controls â”€â”€ */
.controls-area {
    display: flex;
    gap: var(--t-space-3);
    align-items: center;
}

.bet-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-3);
    box-shadow: var(--t-shadow-sm);
}

.bet-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    color: var(--t-text-muted);
}

.bet-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.bet-adj {
    width: 36px;
    height: 36px;
    border-radius: var(--t-radius-md);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    color: var(--t-text);
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    transition: all var(--t-transition-fast);
}

.bet-adj:hover {
    background: var(--t-bg-hover);
}

.bet-display {
    flex: 1;
}

.bet-input {
    width: 100%;
    text-align: center;
    font-size: 1.1rem;
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    padding: var(--t-space-2);
    background: var(--t-bg-sunken, var(--t-bg-muted));
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text);
    outline: none;
}

.bet-presets {
    display: flex;
    gap: 4px;
}

.preset-btn {
    flex: 1;
    padding: var(--t-space-1) var(--t-space-2);
    font-size: 0.75rem;
    font-weight: 600;
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    color: var(--t-text-secondary);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.preset-btn:hover:not(:disabled) {
    background: var(--t-bg-hover);
}

.preset-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.preset-max {
    color: var(--t-accent);
    font-weight: 700;
}

.spin-icon {
    animation: spinAnim 1s linear infinite;
}

@keyframes spinAnim {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

.auto-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    color: var(--t-text-secondary);
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all var(--t-transition-fast);
}

.auto-btn:hover {
    background: var(--t-bg-hover);
}

.auto-btn.active {
    background: var(--t-accent-muted);
    color: var(--t-accent);
}

/* â”€â”€ Stats â”€â”€ */
.slot-stats {
    display: flex;
    gap: var(--t-space-4);
    justify-content: space-evenly;
    padding: var(--t-space-3) var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    box-shadow: var(--t-shadow-sm);
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.stat-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--t-text-muted);
}

.stat-value {
    font-family: var(--font-mono, monospace);
    font-weight: 700;
    font-size: 1rem;
}

.success {
    color: var(--t-success);
}

.danger {
    color: var(--t-danger);
}

/* â”€â”€ Transitions â”€â”€ */
.slide-enter-active,
.slide-leave-active {
    transition: all 0.3s ease;
    overflow: hidden;
}

.slide-enter-from,
.slide-leave-to {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
}

.slide-enter-to,
.slide-leave-from {
    max-height: 500px;
    opacity: 1;
}

.fade-enter-active,
.fade-leave-active {
    transition: opacity 0.3s;
}

.fade-enter-from,
.fade-leave-to {
    opacity: 0;
}

/* â”€â”€ Lucky banner â”€â”€ */
.lucky-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--t-space-3);
    padding: var(--t-space-3) var(--t-space-5);
    border-radius: var(--t-radius-lg);
    background: linear-gradient(135deg, color-mix(in srgb, var(--t-success) 15%, transparent), color-mix(in srgb, var(--t-success) 5%, transparent));
    border: 1px solid color-mix(in srgb, var(--t-success) 40%, transparent);
    box-shadow: 0 0 24px color-mix(in srgb, var(--t-success) 25%, transparent);
    animation: luckyPulse 0.8s ease infinite alternate;
}

.lucky-icon {
    font-size: 2rem;
    color: var(--t-success);
    animation: luckyCloverSpin 1s ease;
    filter: drop-shadow(0 0 6px color-mix(in srgb, var(--t-success) 50%, transparent));
}

.lucky-text {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--t-success);
    letter-spacing: 0.05em;
    text-shadow: 0 0 8px color-mix(in srgb, var(--t-success) 30%, transparent);
}

@keyframes luckyPulse {
    from {
        box-shadow: 0 0 16px color-mix(in srgb, var(--t-success) 20%, transparent);
    }

    to {
        box-shadow: 0 0 32px color-mix(in srgb, var(--t-success) 40%, transparent);
    }
}

@keyframes luckyCloverSpin {
    0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
    }

    50% {
        transform: scale(1.3) rotate(10deg);
        opacity: 1;
    }

    100% {
        transform: scale(1) rotate(0deg);
    }
}

.lucky-enter-active {
    animation: luckyIn 0.5s ease;
}

.lucky-leave-active {
    animation: luckyOut 0.3s ease;
}

@keyframes luckyIn {
    0% {
        transform: scale(0.5) translateY(-10px);
        opacity: 0;
    }

    60% {
        transform: scale(1.1) translateY(0);
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes luckyOut {
    to {
        transform: scale(0.8) translateY(10px);
        opacity: 0;
    }
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\storage\AppraiseDialog.vue ===
<script setup lang="ts">
/**
 * AppraiseDialog â€” Dialog to select an appraiser for item(s).
 * Shows available appraisers with costs and accuracy.
 */
import { computed } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import { useStorageStore } from '@renderer/stores/useStorageStore'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'

const props = defineProps<{
    /** Specific item ID or null for appraise-all */
    itemId: string | null
}>()

const emit = defineEmits<{ close: [] }>()

const storage = useStorageStore()
const { formatCash, formatPercent } = useFormat()
const { t } = useI18n()

const appraisers = computed(() => storage.unlockedAppraisers)

function selectAppraiser(appraiserId: string): void {
    if (props.itemId) {
        storage.appraiseItem(props.itemId, appraiserId)
    } else {
        storage.appraiseAll(appraiserId)
    }
    emit('close')
}
</script>

<template>
    <div class="appraise-overlay" @click.self="$emit('close')">
        <div class="appraise-dialog">
            <div class="dialog-header">
                <h3>
                    <AppIcon icon="mdi:magnify" />
                    {{ itemId ? t('storage.choose_appraiser') : t('storage.appraise_all_title') }}
                </h3>
                <button class="btn btn-text btn-sm" @click="$emit('close')"><i class="pi pi-times"></i></button>
            </div>

            <p class="dialog-desc">{{ t('storage.appraiser_desc') }}</p>

            <div class="appraiser-list">
                <div v-for="appraiser in appraisers" :key="appraiser.id" class="appraiser-card"
                    @click="selectAppraiser(appraiser.id)">
                    <AppIcon :icon="appraiser.icon" class="appraiser-icon" />
                    <div class="appraiser-info">
                        <span class="appraiser-name">{{ appraiser.name }}</span>
                        <span class="appraiser-tier">{{ appraiser.tier }}</span>
                        <span class="appraiser-desc">{{ appraiser.description }}</span>
                    </div>
                    <div class="appraiser-stats">
                        <div class="stat-row">
                            <span class="stat-label">{{ t('storage.cost') }}</span>
                            <span class="stat-value">{{ formatCash(appraiser.costPerItem) }}/{{ t('storage.per_item')
                                }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">{{ t('storage.accuracy') }}</span>
                            <span class="stat-value">{{ formatPercent(appraiser.accuracy) }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">{{ t('storage.bonus_chance') }}</span>
                            <span class="stat-value">{{ formatPercent(appraiser.bonusDiscoveryChance) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<style scoped>
.appraise-overlay {
    position: fixed;
    inset: 0;
    z-index: 100;
    background: var(--t-overlay);
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
}

.appraise-dialog {
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-lg);
    padding: var(--t-space-5);
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: var(--t-shadow-lg);
}

.dialog-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--t-space-2);
}

.dialog-header h3 {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    margin: 0;
    font-size: var(--t-font-size-lg);
    color: var(--t-text);
}

.dialog-desc {
    font-size: var(--t-font-size-sm);
    color: var(--t-text-muted);
    margin: 0 0 var(--t-space-3);
}

.appraiser-list {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
}

.appraiser-card {
    display: flex;
    gap: var(--t-space-3);
    padding: var(--t-space-3);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    cursor: pointer;
    transition: all var(--t-transition-fast);
}

.appraiser-card:hover {
    border-color: var(--t-accent);
    background: var(--t-bg-muted);
}

.appraiser-icon {
    font-size: 2rem;
    color: var(--t-accent);
    flex-shrink: 0;
}

.appraiser-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
}

.appraiser-name {
    font-weight: 700;
    color: var(--t-text);
}

.appraiser-tier {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
}

.appraiser-desc {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-secondary);
}

.appraiser-stats {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    flex-shrink: 0;
}

.stat-row {
    display: flex;
    gap: var(--t-space-2);
    align-items: center;
}

.stat-label {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    min-width: 60px;
}

.stat-value {
    font-size: var(--t-font-size-xs);
    font-weight: 600;
    color: var(--t-text);
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\storage\AuctionBidding.vue ===
<script setup lang="ts">
/**
 * AuctionBidding â€” Active auction bidding interface.
 * Shows the bidding war in real-time: hints, bidder avatars,
 * current bid, timer, and player bid controls.
 */
import { ref, computed } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import { useStorageStore } from '@renderer/stores/useStorageStore'
import { usePlayerStore } from '@renderer/stores/usePlayerStore'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'
import { D, add } from '@renderer/core/BigNum'
import { AUCTION_CONFIG } from '@renderer/data/storage'
import { rarityCssVar } from '@renderer/data/rarity'
import { resolveItemName } from '@renderer/data/storage/items'

defineEmits<{ back: [] }>()

const storage = useStorageStore()
const player = usePlayerStore()
const { formatCash } = useFormat()
const { t } = useI18n()

const auction = computed(() => storage.activeAuction)
const location = computed(() =>
    auction.value ? storage.getLocation(auction.value.locationId) : null
)

const bidMultipliers = [1, 2, 5, 10]
const selectedMultiplier = ref(1)

const bidAmount = computed(() => {
    if (!auction.value) return D(0)
    return add(auction.value.currentBid, auction.value.bidIncrement.mul(selectedMultiplier.value))
})

const canBid = computed(() => {
    return auction.value?.status === 'active' && player.cash.gte(bidAmount.value)
})

const isPlayerLeading = computed(() => auction.value?.currentBidder === 'player')

const roundProgress = computed(() => {
    if (!auction.value) return 0
    const maxTicks = auction.value.phase === 'bidding'
        ? AUCTION_CONFIG.ticksPerRound
        : AUCTION_CONFIG.ticksPerGoing
    return ((maxTicks - auction.value.roundTicksLeft) / maxTicks) * 100
})

/** Current auction phase label */
const auctionPhase = computed(() => auction.value?.phase ?? 'bidding')
const isGoingPhase = computed(() => auctionPhase.value !== 'bidding')
const phaseLabel = computed(() => {
    switch (auctionPhase.value) {
        case 'going_once': return t('storage.going_once')
        case 'going_twice': return t('storage.going_twice')
        case 'final_call': return t('storage.final_call')
        default: return ''
    }
})

function placeBid(): void {
    if (!canBid.value) return
    storage.placeBid(bidAmount.value)
}

function leave(): void {
    storage.leaveAuction()
}
</script>

<template>
    <div class="bidding-screen" v-if="auction">
        <!-- Header -->
        <div class="bidding-header">
            <div class="bidding-header__left">
                <button class="btn btn-text btn-sm" @click="leave"><i class="pi pi-arrow-left"></i></button>
                <AppIcon :icon="location?.icon ?? 'mdi:warehouse'" class="bidding-location-icon" />
                <div>
                    <h2 class="bidding-title">{{ location?.name }}</h2>
                    <span class="bidding-subtitle">{{ t('storage.auction_in_progress') }}</span>
                </div>
            </div>
            <div class="bidding-header__right">
                <span class="bidding-round">{{ t('storage.round_n', { n: auction.roundsElapsed }) }} / {{ 10 }}</span>
            </div>
        </div>

        <!-- Timer Bar -->
        <div class="timer-bar">
            <div class="timer-bar__fill" :class="{ 'timer-bar__fill--going': isGoingPhase }"
                :style="{ width: roundProgress + '%' }"></div>
        </div>

        <!-- Going Phase Banner -->
        <div v-if="isGoingPhase && auction.status === 'active'" class="going-phase-banner"
            :class="`going-phase-banner--${auctionPhase}`">
            <AppIcon icon="mdi:gavel" class="going-icon" />
            <span class="going-text">{{ phaseLabel }}</span>
        </div>

        <!-- Two-column layout: Auction info + Bidding controls -->
        <div class="bidding-body">
            <!-- Left: peek hints + bidders -->
            <div class="bidding-left">
                <!-- Peek Hints -->
                <div class="peek-section">
                    <h3 class="section-label">
                        <AppIcon icon="mdi:eye" /> {{ t('storage.peek_inside') }}
                    </h3>
                    <div class="peek-hints">
                        <p v-for="(hint, i) in auction.peekHints" :key="i" class="peek-hint">
                            {{ hint }}
                        </p>
                    </div>
                </div>

                <!-- Bidders -->
                <div class="bidders-section">
                    <h3 class="section-label">
                        <AppIcon icon="mdi:account-group" /> {{ t('storage.competitors') }}
                    </h3>
                    <div class="bidder-list">
                        <div v-for="bidder in auction.bidders" :key="bidder.id" class="bidder-chip"
                            :class="{ 'bidder-chip--dropped': bidder.droppedOut, 'bidder-chip--leading': auction.currentBidder === bidder.id }">
                            <AppIcon :icon="bidder.avatar" class="bidder-avatar" />
                            <div class="bidder-info">
                                <span class="bidder-name">{{ bidder.name }}</span>
                                <span class="bidder-status" v-if="bidder.droppedOut">{{ t('storage.dropped_out')
                                    }}</span>
                                <span class="bidder-status bidder-status--leading"
                                    v-else-if="auction.currentBidder === bidder.id">{{ t('storage.leading') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Current bid + Controls -->
            <div class="bidding-right">
                <!-- Current Bid Display -->
                <div class="current-bid-display">
                    <span class="bid-label">{{ t('storage.current_bid') }}</span>
                    <span class="bid-amount" :class="{ 'bid-amount--player': isPlayerLeading }">
                        {{ formatCash(auction.currentBid) }}
                    </span>
                    <span class="bid-holder" :class="{ 'positive': isPlayerLeading }">
                        {{ isPlayerLeading ? t('storage.you_lead') : t('storage.outbid') }}
                    </span>
                </div>

                <!-- Bid Controls -->
                <div class="bid-controls" v-if="auction.status === 'active'">
                    <div class="bid-multiplier-row">
                        <button v-for="m in bidMultipliers" :key="m" class="btn btn-sm"
                            :class="{ 'btn-primary': selectedMultiplier === m, 'btn-ghost': selectedMultiplier !== m }"
                            @click="selectedMultiplier = m">{{ m }}Ã—</button>
                    </div>

                    <div class="bid-preview">
                        <span class="bid-preview-label">{{ t('storage.your_bid') }}</span>
                        <span class="bid-preview-value">{{ formatCash(bidAmount) }}</span>
                    </div>

                    <button class="btn btn-primary btn-lg bid-button" :disabled="!canBid" @click="placeBid"><i
                            class="pi pi-dollar"></i> {{ t('storage.place_bid') }}</button>

                    <button class="btn btn-text btn-sm leave-button" @click="leave">{{ t('storage.leave_auction')
                        }}</button>
                </div>

                <!-- Auction Result -->
                <div v-else class="auction-result">
                    <div v-if="auction.status === 'won'" class="result-banner result-banner--won">
                        <AppIcon icon="mdi:trophy" class="result-icon" />
                        <span>{{ t('storage.you_won') }}</span>
                        <span class="result-price">{{ formatCash(auction.currentBid) }}</span>
                    </div>
                    <div v-else class="result-banner result-banner--lost">
                        <AppIcon icon="mdi:emoticon-sad" class="result-icon" />
                        <span>{{ t('storage.auction_lost') }}</span>
                    </div>
                </div>

                <!-- Balance -->
                <div class="balance-row">
                    <AppIcon icon="mdi:wallet" />
                    <span>{{ formatCash(player.cash) }}</span>
                </div>
            </div>
        </div>

        <!-- Won Items (if auction is won) -->
        <div v-if="auction.status === 'won'" class="won-items">
            <h3 class="section-label">
                <AppIcon icon="mdi:package-variant" /> {{ t('storage.items_found') }}
            </h3>
            <div class="items-grid">
                <div v-for="item in auction.items" :key="item.id" class="found-item"
                    :style="{ borderColor: rarityCssVar(item.rarity) }">
                    <AppIcon :icon="item.icon" class="found-item__icon" :style="{ color: rarityCssVar(item.rarity) }" />
                    <span class="found-item__name">{{ resolveItemName(item, t) }}</span>
                    <span class="found-item__rarity" :style="{ color: rarityCssVar(item.rarity) }">{{ item.rarity
                        }}</span>
                </div>
            </div>
            <button class="btn btn-primary" @click="$emit('back')"><i class="pi pi-check"></i> {{
                t('storage.collect_items') }}</button>
        </div>
    </div>
</template>

<style scoped>
.bidding-screen {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-4);
}

.bidding-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.bidding-header__left {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
}

.bidding-location-icon {
    font-size: 1.5rem;
    color: var(--t-warning);
}

.bidding-title {
    font-size: var(--t-font-size-lg);
    font-weight: 700;
    margin: 0;
    color: var(--t-text);
}

.bidding-subtitle {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
}

.bidding-round {
    font-size: var(--t-font-size-sm);
    color: var(--t-text-muted);
    background: var(--t-bg-muted);
    padding: 0.3rem 0.75rem;
    border-radius: var(--t-radius-sm);
}

/* Timer */
.timer-bar {
    height: 4px;
    background: var(--t-bg-muted);
    border-radius: 2px;
    overflow: hidden;
}

.timer-bar__fill {
    height: 100%;
    background: var(--t-warning);
    transition: width 0.3s linear;
    border-radius: 2px;
}

.timer-bar__fill--going {
    background: var(--t-danger);
    animation: pulse-bar 0.8s ease-in-out infinite;
}

@keyframes pulse-bar {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.6;
    }
}

/* Going Phase Banner */
.going-phase-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
    padding: 0.6rem 1rem;
    border-radius: var(--t-radius-md);
    font-weight: 800;
    font-size: var(--t-font-size-lg);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    animation: phase-pulse 1s ease-in-out infinite;
}

.going-phase-banner--going_once {
    background: color-mix(in srgb, var(--t-warning) 13%, transparent);
    border: 2px solid var(--t-warning);
    color: var(--t-warning);
}

.going-phase-banner--going_twice {
    background: color-mix(in srgb, var(--t-orange) 13%, transparent);
    border: 2px solid var(--t-orange);
    color: var(--t-orange);
}

.going-phase-banner--final_call {
    background: color-mix(in srgb, var(--t-danger) 13%, transparent);
    border: 2px solid var(--t-danger);
    color: var(--t-danger);
}

.going-icon {
    font-size: 1.4rem;
}

.going-text {
    white-space: nowrap;
}

@keyframes phase-pulse {

    0%,
    100% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.02);
    }
}

/* Body */
.bidding-body {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--t-space-5);
}

.section-label {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: var(--t-font-size-sm);
    font-weight: 600;
    color: var(--t-text);
    margin: 0 0 var(--t-space-2);
}

/* Peek */
.peek-section,
.bidders-section {
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    padding: var(--t-space-3);
}

.peek-hints {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
}

.peek-hint {
    font-size: var(--t-font-size-sm);
    color: var(--t-text-secondary);
    font-style: italic;
    margin: 0;
    padding-left: var(--t-space-2);
    border-left: 2px solid color-mix(in srgb, var(--t-warning) 20%, transparent);
}

/* Bidders */
.bidder-list {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
}

.bidder-chip {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    padding: 0.4rem 0.6rem;
    background: var(--t-bg-muted);
    border-radius: var(--t-radius-sm);
    transition: opacity 0.3s;
}

.bidder-chip--dropped {
    opacity: 0.4;
}

.bidder-chip--leading {
    border: 1px solid var(--t-danger);
    background: color-mix(in srgb, var(--t-danger) 6%, transparent);
}

.bidder-avatar {
    font-size: 1.2rem;
    color: var(--t-text-muted);
}

.bidder-info {
    display: flex;
    flex-direction: column;
}

.bidder-name {
    font-size: var(--t-font-size-sm);
    font-weight: 500;
    color: var(--t-text);
}

.bidder-status {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
}

.bidder-status--leading {
    color: var(--t-danger);
    font-weight: 600;
}

/* Right column */
.bidding-right {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
}

.bidding-left {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
}

.current-bid-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    text-align: center;
}

.bid-label {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
}

.bid-amount {
    font-size: 2rem;
    font-weight: 800;
    color: var(--t-text);
    margin: 0.25rem 0;
}

.bid-amount--player {
    color: var(--t-success);
}

.bid-holder {
    font-size: var(--t-font-size-sm);
    color: var(--t-danger);
    font-weight: 600;
}

.bid-holder.positive {
    color: var(--t-success);
}

/* Bid controls */
.bid-controls {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
}

.bid-multiplier-row {
    display: flex;
    gap: var(--t-space-2);
}

.bid-preview {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--t-space-2) var(--t-space-3);
    background: var(--t-bg-muted);
    border-radius: var(--t-radius-sm);
}

.bid-preview-label {
    font-size: var(--t-font-size-sm);
    color: var(--t-text-muted);
}

.bid-preview-value {
    font-weight: 700;
    color: var(--t-text);
}

.bid-button {
    width: 100%;
}

.leave-button {
    width: 100%;
}

/* Result */
.result-banner {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: var(--t-space-4);
    border-radius: var(--t-radius-md);
    text-align: center;
    font-weight: 700;
    font-size: var(--t-font-size-lg);
}

.result-banner--won {
    background: color-mix(in srgb, var(--t-success) 8%, transparent);
    border: 1px solid var(--t-success);
    color: var(--t-success);
}

.result-banner--lost {
    background: color-mix(in srgb, var(--t-danger) 8%, transparent);
    border: 1px solid var(--t-danger);
    color: var(--t-danger);
}

.result-icon {
    font-size: 2rem;
}

.result-price {
    font-size: var(--t-font-size-sm);
    opacity: 0.8;
}

/* Balance */
.balance-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    font-size: var(--t-font-size-sm);
    color: var(--t-text-muted);
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border-radius: var(--t-radius-sm);
}

/* Won items */
.won-items {
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    padding: var(--t-space-4);
}

.items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: var(--t-space-2);
    margin-bottom: var(--t-space-3);
}

.found-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.3rem;
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-sm);
    text-align: center;
}

.found-item__icon {
    font-size: 1.5rem;
}

.found-item__name {
    font-size: var(--t-font-size-xs);
    font-weight: 600;
    color: var(--t-text);
}

.found-item__rarity {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\storage\AuctionCard.vue ===
<script setup lang="ts">
/**
 * AuctionCard â€” Displays an available auction in the lobby grid.
 * Shows location, peek hints, bidder count, starting bid.
 */
import AppIcon from '@renderer/components/AppIcon.vue'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'
import { useStorageStore } from '@renderer/stores/useStorageStore'
import type { StorageAuction } from '@renderer/data/storage'

const props = defineProps<{
    auction: StorageAuction
}>()

defineEmits<{ bid: [auctionId: string] }>()

const { formatCash } = useFormat()
const { t } = useI18n()
const storage = useStorageStore()

const location = storage.getLocation(props.auction.locationId)
</script>

<template>
    <div class="auction-card" :style="{ '--_accent': 'var(--t-warning)' }">
        <!-- Head -->
        <div class="auction-card__head">
            <AppIcon :icon="location?.icon ?? 'mdi:warehouse'" class="auction-card__icon" />
            <div class="auction-card__identity">
                <span class="auction-card__name">{{ location?.name ?? t('storage.unknown_location') }}</span>
                <span class="auction-card__tier">{{ location?.tier?.toUpperCase() }}</span>
            </div>
            <span class="auction-card__badge">
                <AppIcon icon="mdi:account-group" />
                {{ auction.bidders.length }} {{ t('storage.bidders') }}
            </span>
        </div>

        <!-- Peek Hints -->
        <div class="auction-card__hints">
            <AppIcon icon="mdi:eye" class="hint-icon" />
            <div class="hint-list">
                <span v-for="(hint, i) in auction.peekHints" :key="i" class="hint-text">{{ hint }}</span>
            </div>
        </div>

        <!-- Stats -->
        <div class="auction-card__stats">
            <div class="auction-card__kpi">
                <span class="auction-card__kpi-label">{{ t('storage.starting_bid') }}</span>
                <span class="auction-card__kpi-value">{{ formatCash(auction.currentBid) }}</span>
            </div>
            <div class="auction-card__kpi">
                <span class="auction-card__kpi-label">{{ t('storage.items_inside') }}</span>
                <span class="auction-card__kpi-value">{{ t('storage.unknown_items') }}</span>
            </div>
        </div>

        <!-- Actions -->
        <div class="auction-card__actions">
            <button class="btn btn-primary btn-sm auction-card__btn" @click="$emit('bid', auction.id)"><i
                    class="pi pi-sign-in"></i> {{ t('storage.enter_auction') }}</button>
        </div>
    </div>
</template>

<style scoped>
.auction-card {
    --_accent: var(--t-warning);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    gap: var(--t-space-3);
    padding: var(--t-space-4);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    box-shadow: var(--t-shadow-sm);
    transition: border-color var(--t-transition-normal), box-shadow var(--t-transition-normal);
}

.auction-card:hover {
    border-color: var(--t-border-hover);
}

.auction-card__head {
    display: flex;
    align-items: center;
    gap: var(--t-space-3);
}

.auction-card__icon {
    font-size: 1.5rem;
    color: var(--_accent);
    flex-shrink: 0;
}

.auction-card__identity {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
}

.auction-card__name {
    font-weight: 600;
    font-size: var(--t-font-size-base);
    color: var(--t-text);
}

.auction-card__tier {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    letter-spacing: 0.08em;
    font-weight: 600;
}

.auction-card__badge {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    background: var(--t-bg-muted);
    padding: 0.25rem 0.5rem;
    border-radius: var(--t-radius-sm);
}

.auction-card__hints {
    display: flex;
    gap: var(--t-space-2);
    padding: var(--t-space-2);
    background: var(--t-bg-muted);
    border-radius: var(--t-radius-sm);
}

.hint-icon {
    font-size: 1rem;
    color: var(--t-text-muted);
    flex-shrink: 0;
    margin-top: 2px;
}

.hint-list {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
}

.hint-text {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-secondary);
    font-style: italic;
}

.auction-card__stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--t-space-2);
}

.auction-card__kpi {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
}

.auction-card__kpi-label {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.auction-card__kpi-value {
    font-weight: 600;
    font-size: var(--t-font-size-sm);
    color: var(--t-text);
}

.auction-card__actions {
    display: flex;
    justify-content: flex-end;
}

.auction-card__btn {
    width: 100%;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\storage\index.ts ===
export { default as AuctionCard } from './AuctionCard.vue'
export { default as AuctionBidding } from './AuctionBidding.vue'
export { default as InventoryPanel } from './InventoryPanel.vue'
export { default as InventoryItem } from './InventoryItem.vue'
export { default as AppraiseDialog } from './AppraiseDialog.vue'
export { default as StorageStats } from './StorageStats.vue'
export { default as SessionPnL } from './SessionPnL.vue'

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\storage\InventoryItem.vue ===
<script setup lang="ts">
/**
 * InventoryItem â€” Displays a single item in the inventory.
 * Shows rarity-colored border, appraisal status, value, and action buttons.
 */
import AppIcon from '@renderer/components/AppIcon.vue'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'
import { rarityCssVar } from '@renderer/data/rarity'
import { resolveItemName, resolveItemDescription } from '@renderer/data/storage/items'
import { CONDITION_ICONS, CONDITION_COLORS } from '@renderer/data/shop/restoration'
import type { InventoryItem as InventoryItemType } from '@renderer/stores/useStorageStore'

defineProps<{
    item: InventoryItemType
}>()

defineEmits<{
    appraise: [itemId: string]
    sell: [itemId: string]
}>()

const { formatCash } = useFormat()
const { t } = useI18n()
</script>

<template>
    <div class="inv-item" :style="{ '--_rarity': rarityCssVar(item.rarity) }">
        <div class="inv-item__header">
            <AppIcon :icon="item.icon" class="inv-item__icon" :style="{ color: rarityCssVar(item.rarity) }" />
            <div class="inv-item__info">
                <span class="inv-item__name">{{ resolveItemName(item, t) }}</span>
                <span class="inv-item__rarity" :style="{ color: rarityCssVar(item.rarity) }">{{ item.rarity }}</span>
            </div>
        </div>

        <p class="inv-item__desc">{{ resolveItemDescription(item, t) }}</p>

        <div class="inv-item__value-row">
            <span class="inv-item__category">{{ item.category }}</span>
            <div v-if="item.appraised && item.condition" class="inv-item__condition"
                :style="{ color: CONDITION_COLORS[item.condition] }">
                <AppIcon :icon="CONDITION_ICONS[item.condition]" />
                {{ t(`items.condition.${item.condition}`) }}
            </div>
            <div v-else-if="!item.appraised && item.condition" class="inv-item__condition inv-item__condition--hidden">
                <AppIcon icon="mdi:help-circle-outline" />
                {{ t('storage.condition_unknown') }}
            </div>
            <div class="inv-item__value">
                <template v-if="item.appraised">
                    <AppIcon icon="mdi:check-circle" class="appraised-icon" />
                    <span class="value-text value-text--appraised">{{ formatCash(item.appraisedValue!) }}</span>
                </template>
                <template v-else>
                    <AppIcon icon="mdi:help-circle" class="unappraised-icon" />
                    <span class="value-text value-text--unknown">{{ t('storage.not_appraised') }}</span>
                </template>
            </div>
        </div>

        <div class="inv-item__actions">
            <button v-if="!item.appraised" class="btn btn-ghost btn-sm" @click="$emit('appraise', item.id)"><i
                    class="pi pi-search"></i> {{ t('storage.appraise') }}</button>
            <button class="btn btn-primary btn-sm" @click="$emit('sell', item.id)"><i class="pi pi-dollar"></i> {{
                t('storage.sell_item') }}</button>
        </div>
    </div>
</template>

<style scoped>
.inv-item {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    padding: var(--t-space-3);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-left: 3px solid var(--_rarity, var(--t-border));
    border-radius: var(--t-radius-md);
    transition: border-color var(--t-transition-normal);
}

.inv-item:hover {
    border-color: var(--t-border-hover);
}

.inv-item__header {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
}

.inv-item__icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.inv-item__info {
    display: flex;
    flex-direction: column;
}

.inv-item__name {
    font-weight: 600;
    font-size: var(--t-font-size-sm);
    color: var(--t-text);
}

.inv-item__rarity {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
}

.inv-item__desc {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    margin: 0;
    line-height: 1.4;
}

.inv-item__value-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--t-space-1);
}

.inv-item__condition {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: var(--t-font-size-xs);
    font-weight: 600;
    text-transform: capitalize;
}

.inv-item__condition--hidden {
    color: var(--t-text-muted);
    font-style: italic;
}

.inv-item__category {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    text-transform: capitalize;
    background: var(--t-bg-muted);
    padding: 0.15rem 0.5rem;
    border-radius: var(--t-radius-sm);
}

.inv-item__value {
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.appraised-icon {
    color: var(--t-success);
    font-size: 0.9rem;
}

.unappraised-icon {
    color: var(--t-text-muted);
    font-size: 0.9rem;
}

.value-text {
    font-size: var(--t-font-size-sm);
    font-weight: 600;
}

.value-text--appraised {
    color: var(--t-success);
}

.value-text--unknown {
    color: var(--t-text-muted);
    font-style: italic;
}

.inv-item__actions {
    display: flex;
    gap: var(--t-space-2);
    justify-content: flex-end;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\storage\InventoryPanel.vue ===
<script setup lang="ts">
/**
 * InventoryPanel â€” Displays all items in the player's storage inventory.
 * Supports filtering, bulk operations, and appraisal selection.
 */
import { ref, computed } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import InventoryItem from './InventoryItem.vue'
import AppraiseDialog from './AppraiseDialog.vue'
import { useStorageStore } from '@renderer/stores/useStorageStore'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'

const storage = useStorageStore()
const { formatCash } = useFormat()
const { t } = useI18n()

const filterCategory = ref<string>('all')
const showAppraiseDialog = ref(false)
const appraiseTargetId = ref<string | null>(null)

const categories = computed(() => {
    const cats = new Set(storage.inventory.map(i => i.category))
    return ['all', ...Array.from(cats).sort()]
})

const filteredItems = computed(() => {
    if (filterCategory.value === 'all') return storage.inventory
    return storage.inventory.filter(i => i.category === filterCategory.value)
})

const unappraisedCount = computed(() => storage.inventory.filter(i => !i.appraised).length)

function onAppraise(itemId: string): void {
    appraiseTargetId.value = itemId
    showAppraiseDialog.value = true
}

function onSell(itemId: string): void {
    storage.sellItem(itemId)
}

function sellAllItems(): void {
    storage.sellAll()
}
</script>

<template>
    <div class="inventory-panel">
        <!-- Header -->
        <div class="inventory-header">
            <h3 class="inventory-title">
                <AppIcon icon="mdi:package-variant" />
                {{ t('storage.inventory') }}
                <span class="inventory-count">({{ storage.inventoryCount }})</span>
            </h3>
            <div class="inventory-value">
                <span class="inv-val-label">{{ t('storage.est_value') }}</span>
                <span class="inv-val-amount">{{ formatCash(storage.inventoryValue) }}</span>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="inventory-toolbar" v-if="storage.inventoryCount > 0">
            <div class="filter-row">
                <button v-for="cat in categories" :key="cat" class="btn btn-sm"
                    :class="{ 'btn-primary': filterCategory === cat, 'btn-ghost': filterCategory !== cat }"
                    @click="filterCategory = cat">{{ cat === 'all' ? t('common.all') : cat }}</button>
            </div>
            <div class="bulk-actions">
                <button v-if="unappraisedCount > 0" class="btn btn-ghost btn-sm"
                    @click="showAppraiseDialog = true; appraiseTargetId = null"><i class="pi pi-search"></i> {{
                        t('storage.appraise_all', { n: unappraisedCount }) }}</button>
                <button class="btn btn-warning btn-sm" @click="sellAllItems"><i class="pi pi-dollar"></i> {{
                    t('storage.sell_all') }}</button>
            </div>
        </div>

        <!-- Items Grid -->
        <div v-if="filteredItems.length > 0" class="inventory-grid">
            <InventoryItem v-for="item in filteredItems" :key="item.id" :item="item" @appraise="onAppraise"
                @sell="onSell" />
        </div>

        <!-- Empty State -->
        <div v-else class="inventory-empty">
            <AppIcon icon="mdi:package-variant-closed" class="empty-icon" />
            <p>{{ t('storage.inventory_empty') }}</p>
        </div>

        <!-- Appraise Dialog -->
        <AppraiseDialog v-if="showAppraiseDialog" :item-id="appraiseTargetId" @close="showAppraiseDialog = false" />
    </div>
</template>

<style scoped>
.inventory-panel {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-3);
}

.inventory-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--t-space-3);
}

.inventory-title {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: var(--t-font-size-base);
    font-weight: 700;
    margin: 0;
    color: var(--t-text);
}

.inventory-count {
    color: var(--t-text-muted);
    font-weight: 400;
}

.inventory-value {
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.inv-val-label {
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.inv-val-amount {
    font-weight: 700;
    color: var(--t-success);
}

.inventory-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--t-space-2);
}

.filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
}

.bulk-actions {
    display: flex;
    gap: var(--t-space-2);
}

.inventory-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: var(--t-space-3);
}

.inventory-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--t-space-2);
    padding: var(--t-space-6);
    color: var(--t-text-muted);
}

.empty-icon {
    font-size: 3rem;
    opacity: 0.3;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\storage\SessionPnL.vue ===
<script setup lang="ts">
/**
 * SessionPnL â€” Per-session profit & loss breakdown panel.
 *
 * Shows a real-time breakdown of costs (entry fees, bids, appraisals,
 * storage fees) vs. revenue for the current play session. Resets on
 * page reload or manual reset.
 */
import { computed } from 'vue'
import AppIcon from '@renderer/components/AppIcon.vue'
import { useStorageStore } from '@renderer/stores/useStorageStore'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'
import { ZERO } from '@renderer/core/BigNum'

const storage = useStorageStore()
const { formatCash, formatNumber } = useFormat()
const { t } = useI18n()

const s = computed(() => storage.session)
const net = computed(() => storage.sessionNet)
const totalCost = computed(() => storage.sessionTotalCost)
const isPositive = computed(() => net.value.gte(ZERO))

const costRows = computed(() => [
    { label: t('storage.session_entry_fees'), value: s.value.entryFees, icon: 'mdi:ticket' },
    { label: t('storage.session_bids'), value: s.value.bidSpend, icon: 'mdi:gavel' },
    { label: t('storage.session_appraisals'), value: s.value.appraisalSpend, icon: 'mdi:magnify' },
    { label: t('storage.session_storage_fees'), value: s.value.storageFees, icon: 'mdi:warehouse' },
])

const hasActivity = computed(() =>
    s.value.auctionsEntered > 0 || s.value.itemsSold > 0
)
</script>

<template>
    <div class="session-pnl" :class="{ 'session-pnl--positive': isPositive, 'session-pnl--negative': !isPositive }">
        <div class="session-pnl__header">
            <div class="session-pnl__title">
                <AppIcon icon="mdi:chart-box" />
                <span>{{ t('storage.session_pnl_title') }}</span>
            </div>
            <button v-if="hasActivity" class="btn btn-text btn-sm" @click="storage.resetSession()"><i
                    class="pi pi-refresh"></i> {{ t('storage.session_reset') }}</button>
        </div>

        <template v-if="hasActivity">
            <!-- Activity row -->
            <div class="session-pnl__activity">
                <span class="activity-chip">
                    <AppIcon icon="mdi:gavel" />
                    {{ formatNumber(s.auctionsEntered) }} {{ t('storage.session_entered') }}
                </span>
                <span class="activity-chip">
                    <AppIcon icon="mdi:trophy" />
                    {{ formatNumber(s.auctionsWon) }} {{ t('storage.session_won') }}
                </span>
                <span class="activity-chip">
                    <AppIcon icon="mdi:tag-check" />
                    {{ formatNumber(s.itemsSold) }} {{ t('storage.session_sold') }}
                </span>
            </div>

            <!-- Cost breakdown -->
            <div class="session-pnl__costs">
                <div v-for="row in costRows" :key="row.label" class="cost-row">
                    <AppIcon :icon="row.icon" class="cost-icon" />
                    <span class="cost-label">{{ row.label }}</span>
                    <span class="cost-value negative">-{{ formatCash(row.value) }}</span>
                </div>
                <div class="cost-row cost-row--total">
                    <AppIcon icon="mdi:minus-circle" class="cost-icon" />
                    <span class="cost-label">{{ t('storage.session_total_cost') }}</span>
                    <span class="cost-value negative">-{{ formatCash(totalCost) }}</span>
                </div>
            </div>

            <!-- Revenue -->
            <div class="session-pnl__revenue">
                <AppIcon icon="mdi:cash-multiple" class="cost-icon" />
                <span class="cost-label">{{ t('storage.session_revenue') }}</span>
                <span class="cost-value positive">+{{ formatCash(s.saleRevenue) }}</span>
            </div>

            <!-- Net P&L -->
            <div class="session-pnl__net" :class="isPositive ? 'positive' : 'negative'">
                <AppIcon :icon="isPositive ? 'mdi:trending-up' : 'mdi:trending-down'" />
                <span class="net-label">{{ t('storage.session_net') }}</span>
                <span class="net-value">{{ isPositive ? '+' : '' }}{{ formatCash(net) }}</span>
            </div>
        </template>

        <!-- No activity yet -->
        <div v-else class="session-pnl__empty">
            <AppIcon icon="mdi:chart-line" class="empty-icon" />
            <span>{{ t('storage.session_empty') }}</span>
        </div>
    </div>
</template>

<style scoped>
.session-pnl {
    display: flex;
    flex-direction: column;
    gap: var(--t-space-2);
    padding: var(--t-space-3);
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    box-shadow: var(--t-shadow-sm);
}

.session-pnl__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.session-pnl__title {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-weight: 700;
    font-size: var(--t-font-size-sm);
    color: var(--t-text);
}

.session-pnl__activity {
    display: flex;
    flex-wrap: wrap;
    gap: var(--t-space-2);
}

.activity-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    font-size: var(--t-font-size-xs);
    color: var(--t-text-muted);
    background: var(--t-bg-muted);
    padding: 0.2rem 0.5rem;
    border-radius: var(--t-radius-sm);
}

.session-pnl__costs {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.cost-row {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: var(--t-font-size-xs);
}

.cost-row--total {
    border-top: 1px solid var(--t-border);
    padding-top: 0.3rem;
    margin-top: 0.15rem;
    font-weight: 600;
}

.cost-icon {
    font-size: 0.9rem;
    color: var(--t-text-muted);
    flex-shrink: 0;
}

.cost-label {
    flex: 1;
    color: var(--t-text-secondary);
}

.cost-value {
    font-weight: 600;
    font-variant-numeric: tabular-nums;
}

.cost-value.negative {
    color: var(--t-danger);
}

.cost-value.positive {
    color: var(--t-success);
}

.session-pnl__revenue {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    font-size: var(--t-font-size-xs);
    padding-top: 0.3rem;
    border-top: 1px solid var(--t-border);
}

.session-pnl__net {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: var(--t-space-2);
    border-radius: var(--t-radius-sm);
    font-weight: 700;
    font-size: var(--t-font-size-sm);
}

.session-pnl__net.positive {
    background: color-mix(in srgb, var(--t-success) 10%, transparent);
    color: var(--t-success);
}

.session-pnl__net.negative {
    background: color-mix(in srgb, var(--t-danger) 10%, transparent);
    color: var(--t-danger);
}

.net-label {
    flex: 1;
}

.net-value {
    font-variant-numeric: tabular-nums;
}

.session-pnl__empty {
    display: flex;
    align-items: center;
    gap: var(--t-space-2);
    color: var(--t-text-muted);
    font-size: var(--t-font-size-xs);
    padding: var(--t-space-2) 0;
}

.empty-icon {
    opacity: 0.3;
}
</style>

=== END FILE ===

=== FILE: C:\Users\zagor\Desktop\--\business-tycoon\src\renderer\src\components\storage\StorageStats.vue ===
<script setup lang="ts">
/**
 * StorageStats â€” Statistics ribbon for storage wars.
 */
import AppIcon from '@renderer/components/AppIcon.vue'
import { useStorageStore } from '@renderer/stores/useStorageStore'
import { useFormat } from '@renderer/composables/useFormat'
import { useI18n } from 'vue-i18n'
import { computed } from 'vue'

const storage = useStorageStore()
const { formatCash, formatNumber } = useFormat()
const { t } = useI18n()

const stats = computed(() => [
    { label: t('storage.auctions_won'), value: formatNumber(storage.totalAuctionsWon), icon: 'mdi:trophy', colorClass: 'positive' },
    { label: t('storage.items_sold'), value: formatNumber(storage.totalItemsSold), icon: 'mdi:tag-check' },
    { label: t('storage.revenue'), value: formatCash(storage.totalSaleRevenue), icon: 'mdi:cash-multiple', colorClass: 'positive' },
    { label: t('storage.total_spent'), value: formatCash(storage.totalSpentOnAuctions.add(storage.totalSpentOnAppraisals).add(storage.totalSpentOnEntryFees).add(storage.totalSpentOnStorageFees)), icon: 'mdi:cash-minus', colorClass: 'negative' },
    { label: t('storage.net_profit_label'), value: formatCash(storage.netProfit), icon: 'mdi:chart-line', colorClass: storage.netProfit.gte(0) ? 'positive' : 'negative' },
    { label: t('storage.sell_tax_label'), value: `${storage.sellTaxPercent}%`, icon: 'mdi:percent' },
    { label: t('storage.biggest_flip'), value: formatCash(storage.biggestFlip), icon: 'mdi:star-shooting' },
])
</script>

<template>
    <div class="stats-bar">
        <div v-for="stat in stats" :key="stat.label" class="stat-chip">
            <AppIcon :icon="stat.icon" class="stat-chip-icon" />
            <span class="stat-chip-label">{{ stat.label }}</span>
            <span class="stat-chip-value" :class="stat.colorClass">{{ stat.value }}</span>
        </div>
    </div>
</template>

<style scoped>
.stats-bar {
    display: flex;
    flex-wrap: wrap;
    gap: var(--t-space-3);
}

.stat-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.5rem 0.85rem;
    background: var(--t-bg-card);
    border: 1px solid var(--t-border);
    border-radius: var(--t-radius-md);
    font-size: var(--t-font-size-sm);
    transition: border-color var(--t-transition-normal);
}

.stat-chip:hover {
    border-color: var(--t-border-hover);
}

.stat-chip-icon {
    font-size: 1rem;
    color: var(--t-text-muted);
}

.stat-chip-label {
    color: var(--t-text-muted);
    font-size: var(--t-font-size-xs);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.stat-chip-value {
    font-weight: 600;
    color: var(--t-text);
}

.stat-chip-value.positive {
    color: var(--t-success);
}

.stat-chip-value.negative {
    color: var(--t-danger);
}
</style>

=== END FILE ===


